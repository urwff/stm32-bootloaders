[
    {
        "type": "text",
        "text": "25 Serial peripheral interface (SPI) ",
        "text_level": 1,
        "bbox": [
            107,
            104,
            606,
            127
        ],
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "Low-density devices are STM32F101xx, STM32F102xx and STM32F103xx microcontrollers where the Flash memory density ranges between 16 and 32 Kbytes. ",
        "bbox": [
            205,
            152,
            835,
            181
        ],
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "Medium-density devices are STM32F101xx, STM32F102xx and STM32F103xx microcontrollers where the Flash memory density ranges between 64 and 128 Kbytes. ",
        "bbox": [
            206,
            187,
            847,
            217
        ],
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "High-density devices are STM32F101xx and STM32F103xx microcontrollers where the Flash memory density ranges between 256 and 512 Kbytes. ",
        "bbox": [
            206,
            224,
            865,
            252
        ],
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "XL-density devices are STM32F101xx and STM32F103xx microcontrollers where the Flash memory density ranges between 768 Kbytes and 1 Mbyte. ",
        "bbox": [
            205,
            258,
            855,
            288
        ],
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "Connectivity line devices are STM32F105xx and STM32F107xx microcontrollers. ",
        "bbox": [
            206,
            294,
            825,
            309
        ],
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "25.1 SPI introduction ",
        "text_level": 1,
        "bbox": [
            110,
            337,
            389,
            356
        ],
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "In high-density, XL-density and connectivity line devices, the SPI interface provides two main functions, supporting either the SPI protocol or the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ audio protocol. By default, it is the SPI function that is selected. It is possible to switch the interface from SPI to ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ by software. ",
        "bbox": [
            205,
            365,
            882,
            421
        ],
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "In Cat.1 and Cat.2 devices, the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ protocol is not available. ",
        "bbox": [
            205,
            422,
            650,
            437
        ],
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "The serial peripheral interface (SPI) allows half/ full-duplex, synchronous, serial communication with external devices. The interface can be configured as the master and in this case it provides the communication clock (SCK) to the external slave device. The interface is also capable of operating in multimaster configuration. ",
        "bbox": [
            205,
            444,
            884,
            501
        ],
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "It may be used for a variety of purposes, including simplex synchronous transfers on two lines with a possible bidirectional data line or reliable communication using CRC checking. ",
        "bbox": [
            206,
            508,
            877,
            536
        ],
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "The ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ is also a synchronous serial communication interface. It can address four different audio standards including the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ Philips standard, the MSB- and LSB-justified standards, and the PCM standard. It can operate as a slave or a master device in full-duplex mode (using 4 pins) or in half-duplex mode (using 6 pins). Master clock can be provided by the interface to an external slave component when the $^ { 1 2 } \\mathsf { S }$ is configured as the communication master. ",
        "bbox": [
            205,
            542,
            880,
            629
        ],
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "Warning: ",
        "text_level": 1,
        "bbox": [
            252,
            661,
            327,
            674
        ],
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "Since some SPI3/I2S3 pins are shared with JTAG pins (SPI3_NSS/I2S3_WS with JTDI and SPI3_SCK/I2S3_CK with JTDO), they are not controlled by the IO controller and are reserved for JTAG usage (after each Reset). For this purpose, prior to configure the SPI3/I2S3 pins, the user has to disable the JTAG and use the SWD interface (when debugging the application), or disable both JTAG/SWD interfaces (for standalone applications). For more information on the configuration of JTAG/SWD interface pins refer to Section 9.3.5: JTAG/SWD alternate function remapping. ",
        "bbox": [
            342,
            660,
            836,
            818
        ],
        "page_idx": 0
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            68,
            887,
            83
        ],
        "page_idx": 0
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 0
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            68,
            176,
            81
        ],
        "page_idx": 0
    },
    {
        "type": "discarded",
        "text": "699/1136 ",
        "bbox": [
            821,
            882,
            887,
            894
        ],
        "page_idx": 0
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            117,
            874,
            164,
            893
        ],
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "25.2 SPI and $1 ^ { 2 } S$ main features ",
        "text_level": 1,
        "bbox": [
            109,
            102,
            494,
            124
        ],
        "page_idx": 1
    },
    {
        "type": "text",
        "text": "25.2.1 SPI features ",
        "text_level": 1,
        "bbox": [
            109,
            140,
            324,
            157
        ],
        "page_idx": 1
    },
    {
        "type": "text",
        "text": " Full-duplex synchronous transfers on three lines   \n Simplex synchronous transfers on two lines with or without a bidirectional data line   \n 8- or 16-bit transfer frame format selection   \n Master or slave operation   \n Multimaster mode capability   \n 8 master mode baud rate prescalers (fPCLK/2 max.)   \n Slave mode frequency $( \\mathsf { f } _ { \\mathsf { P C L K } } / 2 \\mathsf { m a x } )$   \n Faster communication for both master and slave   \n NSS management by hardware or software for both master and slave: dynamic change of master/slave operations Programmable clock polarity and phase   \n Programmable data order with MSB-first or LSB-first shifting   \n Dedicated transmission and reception flags with interrupt capability   \n SPI bus busy status flag   \n Hardware CRC feature for reliable communication: CRC value can be transmitted as last byte in Tx mode – Automatic CRC error checking for last received byte   \n Master mode fault, overrun and CRC error flags with interrupt capability   \n 1-byte transmission and reception buffer with DMA capability: Tx and Rx requests ",
        "bbox": [
            194,
            166,
            887,
            503
        ],
        "page_idx": 1
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 1
    },
    {
        "type": "discarded",
        "text": "700/1136 ",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 1
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            110,
            68,
            363,
            83
        ],
        "page_idx": 1
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            833,
            874,
            880,
            893
        ],
        "page_idx": 1
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            820,
            68,
            887,
            81
        ],
        "page_idx": 1
    },
    {
        "type": "text",
        "text": "25.2.2 I2S features ",
        "text_level": 1,
        "bbox": [
            110,
            106,
            319,
            125
        ],
        "page_idx": 2
    },
    {
        "type": "text",
        "text": " Half-duplex communication (only transmitter or receiver)   \n Master or slave operations   \n 8-bit programmable linear prescaler to reach accurate audio sample frequencies (from 8 kHz to $1 9 2 \\mathsf { k H z }$ )   \n Data format may be 16-bit, 24-bit or 32-bit   \n Packet frame is fixed to 16-bit (16-bit data frame) or 32-bit (16-bit, 24-bit, 32-bit data frame) by audio channel Programmable clock polarity (steady state) Underrun flag in slave transmission mode and Overrun flag in reception mode (master and slave) 16-bit register for transmission and reception with one data register for both channel sides ",
        "bbox": [
            196,
            135,
            885,
            331
        ],
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "Supported $^ { 1 2 } \\mathsf { S }$ protocols: ",
        "bbox": [
            205,
            333,
            426,
            349
        ],
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "$^ { 1 2 } \\mathsf { S }$ Phillps standard   \nMSB-justified standard (left-justified)   \nLSB-justified standard (right-justified)   \nPCM standard (with short and long frame synchronization on 16-bit channel frame   \nor 16-bit data frame extended to 32-bit channel frame) ",
        "bbox": [
            236,
            352,
            885,
            434
        ],
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "Data direction is always MSB first ",
        "bbox": [
            205,
            438,
            494,
            451
        ],
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "DMA capability for transmission and reception (16-bit wide) ",
        "bbox": [
            200,
            456,
            689,
            470
        ],
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "Master clock may be output to drive an external audio component. Ratio is fixed at $2 5 6 \\times \\mathsf { F } _ { \\mathsf { S } }$ (where $\\mathsf { F } _ { \\mathsf { S } }$ is the audio sampling frequency) ",
        "bbox": [
            203,
            473,
            858,
            502
        ],
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "In connectivity line devices, both ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ (I2S2 and I2S3) have a dedicated PLL (PLL3) to generate an even more accurate clock. ",
        "bbox": [
            205,
            504,
            875,
            534
        ],
        "page_idx": 2
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            68,
            887,
            83
        ],
        "page_idx": 2
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 2
    },
    {
        "type": "discarded",
        "text": "701/1136 ",
        "bbox": [
            823,
            882,
            887,
            894
        ],
        "page_idx": 2
    },
    {
        "type": "discarded",
        "text": "5 ",
        "bbox": [
            117,
            874,
            164,
            893
        ],
        "page_idx": 2
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            68,
            176,
            81
        ],
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "25.3 SPI functional description ",
        "text_level": 1,
        "bbox": [
            109,
            104,
            499,
            124
        ],
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "25.3.1 General description ",
        "text_level": 1,
        "bbox": [
            109,
            140,
            398,
            157
        ],
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "The block diagram of the SPI is shown in Figure 238. ",
        "bbox": [
            206,
            166,
            600,
            180
        ],
        "page_idx": 3
    },
    {
        "type": "image",
        "img_path": "images/cbfc93dcd53a75b6baf0e6ca2ab7c9abc6ccde6d400450cc279bb61865bb029b.jpg",
        "image_caption": [
            "Figure 238. SPI block diagram "
        ],
        "image_footnote": [],
        "bbox": [
            206,
            214,
            878,
            559
        ],
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "MS51604V1 ",
        "bbox": [
            823,
            553,
            880,
            564
        ],
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "Usually, the SPI is connected to external devices through four pins: ",
        "bbox": [
            203,
            572,
            705,
            587
        ],
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "MISO: Master In / Slave Out data. This pin can be used to transmit data in slave mode and receive data in master mode. MOSI: Master Out / Slave In data. This pin can be used to transmit data in master mode and receive data in slave mode.  SCK: Serial Clock output for SPI masters and input for SPI slaves. NSS: Slave select. This is an optional pin to select a slave device. This pin acts as a ‘chip select’ to let the SPI master communicate with slaves individually and to avoid contention on the data lines. Slave NSS inputs can be driven by standard IO ports on the master device. The NSS pin may also be used as an output if enabled (SSOE bit) and driven low if the SPI is in master configuration. In this manner, all NSS pins from devices connected to the Master NSS pin see a low level and become slaves when they are configured in NSS hardware mode. When configured in master mode with NSS configured as an input (MSTR $= 1$ and ${ \\mathsf { S S O E } } { = } 0$ ) and if NSS is pulled low, the SPI enters the master mode fault state: the MSTR bit is automatically cleared and the device is configured in slave mode (refer to Section 25.3.10). ",
        "bbox": [
            203,
            591,
            884,
            815
        ],
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "A basic example of interconnections between a single master and a single slave is illustrated in Figure 239. ",
        "bbox": [
            201,
            823,
            820,
            850
        ],
        "page_idx": 3
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 3
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            110,
            70,
            363,
            83
        ],
        "page_idx": 3
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            821,
            68,
            887,
            81
        ],
        "page_idx": 3
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            833,
            874,
            880,
            893
        ],
        "page_idx": 3
    },
    {
        "type": "discarded",
        "text": "702/1136 ",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 3
    },
    {
        "type": "image",
        "img_path": "images/0f4077adab55bb4bf46a66dc2972687044c2a9a71c71b3c8e2ce902a754baeaa.jpg",
        "image_caption": [
            "Figure 239. Single master/ single slave application "
        ],
        "image_footnote": [],
        "bbox": [
            225,
            123,
            853,
            307
        ],
        "page_idx": 4
    },
    {
        "type": "text",
        "text": "ai14745 ",
        "bbox": [
            838,
            298,
            878,
            307
        ],
        "page_idx": 4
    },
    {
        "type": "text",
        "text": "1. Here, the NSS pin is configured as an input. ",
        "bbox": [
            205,
            312,
            492,
            325
        ],
        "page_idx": 4
    },
    {
        "type": "text",
        "text": "The MOSI pins are connected together and the MISO pins are connected together. In this way data is transferred serially between master and slave (most significant bit first). ",
        "bbox": [
            203,
            330,
            873,
            358
        ],
        "page_idx": 4
    },
    {
        "type": "text",
        "text": "The communication is always initiated by the master. When the master device transmits data to a slave device via the MOSI pin, the slave device responds via the MISO pin. This implies full-duplex communication with both data out and data in synchronized with the same clock signal (which is provided by the master device via the SCK pin). ",
        "bbox": [
            205,
            364,
            873,
            422
        ],
        "page_idx": 4
    },
    {
        "type": "text",
        "text": "Slave select (NSS) pin management ",
        "text_level": 1,
        "bbox": [
            205,
            433,
            521,
            450
        ],
        "page_idx": 4
    },
    {
        "type": "text",
        "text": "Hardware or software slave select management can be set using the SSM bit in the SPI_CR1 register. ",
        "bbox": [
            205,
            457,
            831,
            486
        ],
        "page_idx": 4
    },
    {
        "type": "text",
        "text": "Software NSS management $( \\mathsf { S S M } = 1$ )   \nThe slave select information is driven internally by the value of the SSI bit in the   \nSPI_CR1 register. The external NSS pin remains free for other application uses.   \nHardware NSS management $( \\mathsf { S S M } = 0$ )   \nTwo configurations are possible depending on the NSS output configuration (SSOE bit   \nin register SPI_CR2). NSS output enabled $( \\mathsf { S S M } = 0 , \\mathsf { S S O E } = 1 )$ This configuration is used only when the device operates in master mode. The NSS signal is driven low when the master starts the communication and is kept low until the SPI is disabled. NSS output disabled $S S M = 0$ , ${ \\mathsf { S S O E } } = 0$ ) This configuration allows multimaster capability for devices operating in master mode. For devices set as slave, the NSS pin acts as a classical NSS input: the slave is selected when NSS is low and deselected when NSS high. ",
        "bbox": [
            201,
            489,
            885,
            714
        ],
        "page_idx": 4
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 4
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            70,
            885,
            83
        ],
        "page_idx": 4
    },
    {
        "type": "discarded",
        "text": "703/1136 ",
        "bbox": [
            823,
            882,
            887,
            894
        ],
        "page_idx": 4
    },
    {
        "type": "discarded",
        "text": "5 ",
        "bbox": [
            117,
            874,
            164,
            893
        ],
        "page_idx": 4
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            70,
            174,
            80
        ],
        "page_idx": 4
    },
    {
        "type": "text",
        "text": "Clock phase and clock polarity ",
        "text_level": 1,
        "bbox": [
            206,
            105,
            477,
            121
        ],
        "page_idx": 5
    },
    {
        "type": "text",
        "text": "Four possible timing relationships may be chosen by software, using the CPOL and CPHA bits in the SPI_CR1 register. The CPOL (clock polarity) bit controls the steady state value of the clock when no data is being transferred. This bit affects both master and slave modes. If CPOL is reset, the SCK pin has a low-level idle state. If CPOL is set, the SCK pin has a high-level idle state. ",
        "bbox": [
            206,
            129,
            885,
            200
        ],
        "page_idx": 5
    },
    {
        "type": "text",
        "text": "If the CPHA (clock phase) bit is set, the second edge on the SCK pin (falling edge if the CPOL bit is reset, rising edge if the CPOL bit is set) is the MSBit capture strobe. Data are latched on the occurrence of the second clock transition. If the CPHA bit is reset, the first edge on the SCK pin (falling edge if CPOL bit is set, rising edge if CPOL bit is reset) is the MSBit capture strobe. Data are latched on the occurrence of the first clock transition. ",
        "bbox": [
            205,
            207,
            878,
            279
        ],
        "page_idx": 5
    },
    {
        "type": "text",
        "text": "The combination of the CPOL (clock polarity) and CPHA (clock phase) bits selects the data capture clock edge. ",
        "bbox": [
            206,
            286,
            882,
            314
        ],
        "page_idx": 5
    },
    {
        "type": "text",
        "text": "Figure 240, shows an SPI transfer with the four combinations of the CPHA and CPOL bits. The diagram may be interpreted as a master or slave timing diagram where the SCK pin, the MISO pin, the MOSI pin are directly connected between the master and the slave device. ",
        "bbox": [
            205,
            321,
            877,
            378
        ],
        "page_idx": 5
    },
    {
        "type": "text",
        "text": "Note: ",
        "text_level": 1,
        "bbox": [
            110,
            387,
            152,
            400
        ],
        "page_idx": 5
    },
    {
        "type": "text",
        "text": "Prior to changing the CPOL/CPHA bits the SPI must be disabled by resetting the SPE bit. ",
        "bbox": [
            198,
            385,
            870,
            400
        ],
        "page_idx": 5
    },
    {
        "type": "text",
        "text": "Master and slave must be programmed with the same timing mode. ",
        "bbox": [
            206,
            404,
            719,
            419
        ],
        "page_idx": 5
    },
    {
        "type": "text",
        "text": "The idle state of SCK must correspond to the polarity selected in the SPI_CR1 register (by pulling up SCK if CPOL=1 or pulling down SCK if CPOL ${ \\boldsymbol { \\mathsf { \\Pi } } } = 0 { \\mathrm { \\Omega } } ,$ ). ",
        "bbox": [
            206,
            423,
            878,
            452
        ],
        "page_idx": 5
    },
    {
        "type": "text",
        "text": "The Data Frame Format (8- or 16-bit) is selected through the DFF bit in SPI_CR1 register, and determines the data length during transmission/reception. ",
        "bbox": [
            205,
            457,
            875,
            486
        ],
        "page_idx": 5
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 5
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            821,
            70,
            885,
            80
        ],
        "page_idx": 5
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            109,
            70,
            361,
            81
        ],
        "page_idx": 5
    },
    {
        "type": "discarded",
        "text": "704/1136 ",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 5
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            833,
            874,
            880,
            893
        ],
        "page_idx": 5
    },
    {
        "type": "image",
        "img_path": "images/4794d75cfc8a51acf384234e1a0e7cbe53c1bfe7d02ff3a896a9ae57dc0fb8f1.jpg",
        "image_caption": [
            "Figure 240. Data clock timing diagram "
        ],
        "image_footnote": [],
        "bbox": [
            206,
            124,
            884,
            615
        ],
        "page_idx": 6
    },
    {
        "type": "text",
        "text": "",
        "bbox": [
            825,
            606,
            870,
            617
        ],
        "page_idx": 6
    },
    {
        "type": "text",
        "text": "1. These timings are shown with the LSBFIRST bit reset in the SPI_CR1 register. ",
        "bbox": [
            205,
            627,
            699,
            640
        ],
        "page_idx": 6
    },
    {
        "type": "text",
        "text": "Data frame format ",
        "text_level": 1,
        "bbox": [
            205,
            648,
            366,
            663
        ],
        "page_idx": 6
    },
    {
        "type": "text",
        "text": "Data can be shifted out either MSB-first or LSB-first depending on the value of the LSBFIRST bit in the SPI_CR1 register. ",
        "bbox": [
            205,
            672,
            816,
            700
        ],
        "page_idx": 6
    },
    {
        "type": "text",
        "text": "Each data frame is 8 or 16 bits long depending on the size of the data programmed using the DFF bit in the SPI_CR1 register. The selected data frame format is applicable for transmission and/or reception. ",
        "bbox": [
            205,
            707,
            872,
            750
        ],
        "page_idx": 6
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 6
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            70,
            885,
            83
        ],
        "page_idx": 6
    },
    {
        "type": "discarded",
        "text": "705/1136 ",
        "bbox": [
            823,
            882,
            887,
            894
        ],
        "page_idx": 6
    },
    {
        "type": "discarded",
        "text": "5 ",
        "bbox": [
            117,
            874,
            164,
            893
        ],
        "page_idx": 6
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            70,
            174,
            80
        ],
        "page_idx": 6
    },
    {
        "type": "text",
        "text": "25.3.2 Configuring the SPI in slave mode ",
        "text_level": 1,
        "bbox": [
            112,
            104,
            534,
            122
        ],
        "page_idx": 7
    },
    {
        "type": "text",
        "text": "In the slave configuration, the serial clock is received on the SCK pin from the master device. The value set in the BR[2:0] bits in the SPI_CR1 register, does not affect the data transfer rate. ",
        "bbox": [
            205,
            130,
            872,
            173
        ],
        "page_idx": 7
    },
    {
        "type": "text",
        "text": "Note: ",
        "text_level": 1,
        "bbox": [
            110,
            181,
            152,
            193
        ],
        "page_idx": 7
    },
    {
        "type": "text",
        "text": "It is recommended to enable the SPI slave before the master sends the clock. If not, undesired data transmission might occur. The data register of the slave needs to be ready before the first edge of the communication clock or before the end of the ongoing communication. It is mandatory to have the polarity of the communication clock set to the steady state value before the slave and the master are enabled. ",
        "bbox": [
            206,
            179,
            875,
            251
        ],
        "page_idx": 7
    },
    {
        "type": "text",
        "text": "Follow the procedure below to configure the SPI in slave mode: ",
        "bbox": [
            206,
            258,
            677,
            273
        ],
        "page_idx": 7
    },
    {
        "type": "text",
        "text": "Procedure ",
        "text_level": 1,
        "bbox": [
            205,
            285,
            299,
            300
        ],
        "page_idx": 7
    },
    {
        "type": "text",
        "text": "1. Set the DFF bit to define 8- or 16-bit data frame format   \n2. Select the CPOL and CPHA bits to define one of the four relationships between the data transfer and the serial clock (see Figure 240). For correct data transfer, the CPOL and CPHA bits must be configured in the same way in the slave device and the master device.   \n3. The frame format (MSB-first or LSB-first depending on the value of the LSBFIRST bit in the SPI_CR1 register) must be the same as the master device.   \n4. In Hardware mode (refer to Slave select (NSS) pin management), the NSS pin must be connected to a low level signal during the complete byte transmit sequence. In NSS software mode, set the SSM bit and clear the SSI bit in the SPI_CR1 register.   \n5. Clear the MSTR bit and set the SPE bit (both in the SPI_CR1 register) to assign the pins to alternate functions. ",
        "bbox": [
            205,
            308,
            887,
            494
        ],
        "page_idx": 7
    },
    {
        "type": "text",
        "text": "In this configuration the MOSI pin is a data input and the MISO pin is a data output. ",
        "bbox": [
            203,
            501,
            825,
            515
        ],
        "page_idx": 7
    },
    {
        "type": "text",
        "text": "Transmit sequence ",
        "text_level": 1,
        "bbox": [
            206,
            527,
            374,
            542
        ],
        "page_idx": 7
    },
    {
        "type": "text",
        "text": "The data byte is parallel-loaded into the Tx buffer during a write cycle. ",
        "bbox": [
            206,
            551,
            722,
            565
        ],
        "page_idx": 7
    },
    {
        "type": "text",
        "text": "The transmit sequence begins when the slave device receives the clock signal and the most significant bit of the data on its MOSI pin. The remaining bits (the 7 bits in 8-bit data frame format, and the 15 bits in 16-bit data frame format) are loaded into the shift-register. The TXE flag in the SPI_SR register is set on the transfer of data from the Tx Buffer to the shift register and an interrupt is generated if the TXEIE bit in the SPI_CR2 register is set. ",
        "bbox": [
            205,
            572,
            885,
            643
        ],
        "page_idx": 7
    },
    {
        "type": "text",
        "text": "Receive sequence ",
        "text_level": 1,
        "bbox": [
            205,
            655,
            368,
            671
        ],
        "page_idx": 7
    },
    {
        "type": "text",
        "text": "For the receiver, when data transfer is complete: ",
        "bbox": [
            206,
            679,
            564,
            693
        ],
        "page_idx": 7
    },
    {
        "type": "text",
        "text": "The Data in shift register is transferred to Rx Buffer and the RXNE flag (SPI_SR register) is set An Interrupt is generated if the RXNEIE bit is set in the SPI_CR2 register. ",
        "bbox": [
            205,
            697,
            838,
            744
        ],
        "page_idx": 7
    },
    {
        "type": "text",
        "text": "After the last sampling clock edge the RXNE bit is set, a copy of the data byte received in the shift register is moved to the Rx buffer. When the SPI_DR register is read, the SPI peripheral returns this buffered value. ",
        "bbox": [
            203,
            750,
            875,
            793
        ],
        "page_idx": 7
    },
    {
        "type": "text",
        "text": "Clearing of the RXNE bit is performed by reading the SPI_DR register. ",
        "bbox": [
            205,
            800,
            729,
            814
        ],
        "page_idx": 7
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 7
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            110,
            70,
            363,
            83
        ],
        "page_idx": 7
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            821,
            70,
            885,
            81
        ],
        "page_idx": 7
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            833,
            874,
            880,
            893
        ],
        "page_idx": 7
    },
    {
        "type": "discarded",
        "text": "706/1136 ",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 7
    },
    {
        "type": "text",
        "text": "25.3.3 Configuring the SPI in master mode ",
        "text_level": 1,
        "bbox": [
            112,
            104,
            551,
            123
        ],
        "page_idx": 8
    },
    {
        "type": "text",
        "text": "In the master configuration, the serial clock is generated on the SCK pin. ",
        "bbox": [
            206,
            130,
            746,
            146
        ],
        "page_idx": 8
    },
    {
        "type": "text",
        "text": "Procedure ",
        "text_level": 1,
        "bbox": [
            205,
            156,
            299,
            172
        ],
        "page_idx": 8
    },
    {
        "type": "text",
        "text": "1. Select the BR[2:0] bits to define the serial clock baud rate (see SPI_CR1 register).   \n2. Select the CPOL and CPHA bits to define one of the four relationships between the data transfer and the serial clock (see Figure 240).   \n3. Set the DFF bit to define 8- or 16-bit data frame format   \n4. Configure the LSBFIRST bit in the SPI_CR1 register to define the frame format.   \n5. If the NSS pin is required in input mode, in hardware mode, connect the NSS pin to a high-level signal during the complete byte transmit sequence. In NSS software mode, set the SSM and SSI bits in the SPI_CR1 register. If the NSS pin is required in output mode, the SSOE bit only should be set.   \n6. The MSTR and SPE bits must be set (they remain set only if the NSS pin is connected to a high-level signal). ",
        "bbox": [
            203,
            180,
            877,
            355
        ],
        "page_idx": 8
    },
    {
        "type": "text",
        "text": "In this configuration the MOSI pin is a data output and the MISO pin is a data input. ",
        "bbox": [
            205,
            362,
            825,
            376
        ],
        "page_idx": 8
    },
    {
        "type": "text",
        "text": "Transmit sequence ",
        "text_level": 1,
        "bbox": [
            206,
            388,
            374,
            403
        ],
        "page_idx": 8
    },
    {
        "type": "text",
        "text": "The transmit sequence begins when a byte is written in the Tx Buffer. ",
        "bbox": [
            206,
            412,
            721,
            426
        ],
        "page_idx": 8
    },
    {
        "type": "text",
        "text": "The data byte is parallel-loaded into the shift register (from the internal bus) during the first bit transmission and then shifted out serially to the MOSI pin MSB first or LSB first depending on the LSBFIRST bit in the SPI_CR1 register. The TXE flag is set on the transfer of data from the Tx Buffer to the shift register and an interrupt is generated if the TXEIE bit in the SPI_CR2 register is set. ",
        "bbox": [
            205,
            433,
            884,
            504
        ],
        "page_idx": 8
    },
    {
        "type": "text",
        "text": "Receive sequence ",
        "text_level": 1,
        "bbox": [
            205,
            516,
            368,
            532
        ],
        "page_idx": 8
    },
    {
        "type": "text",
        "text": "For the receiver, when data transfer is complete: ",
        "bbox": [
            205,
            540,
            568,
            554
        ],
        "page_idx": 8
    },
    {
        "type": "text",
        "text": "The data in the shift register is transferred to the RX Buffer and the RXNE flag is set An interrupt is generated if the RXNEIE bit is set in the SPI_CR2 register ",
        "bbox": [
            205,
            558,
            872,
            590
        ],
        "page_idx": 8
    },
    {
        "type": "text",
        "text": "At the last sampling clock edge the RXNE bit is set, a copy of the data byte received in the shift register is moved to the Rx buffer. When the SPI_DR register is read, the SPI peripheral returns this buffered value. ",
        "bbox": [
            205,
            596,
            877,
            640
        ],
        "page_idx": 8
    },
    {
        "type": "text",
        "text": "Clearing the RXNE bit is performed by reading the SPI_DR register. ",
        "bbox": [
            205,
            647,
            710,
            662
        ],
        "page_idx": 8
    },
    {
        "type": "text",
        "text": "A continuous transmit stream can be maintained if the next data to be transmitted is put in the Tx buffer once the transmission is started. Note that TXE flag should be ‘1 before any attempt to write the Tx buffer is made. ",
        "bbox": [
            205,
            668,
            878,
            711
        ],
        "page_idx": 8
    },
    {
        "type": "text",
        "text": "Note: ",
        "text_level": 1,
        "bbox": [
            110,
            719,
            152,
            732
        ],
        "page_idx": 8
    },
    {
        "type": "text",
        "text": "When a master is communicating with SPI slaves which need to be de-selected between transmissions, the NSS pin must be configured as GPIO or another GPIO must be used and toggled by software. ",
        "bbox": [
            205,
            718,
            885,
            761
        ],
        "page_idx": 8
    },
    {
        "type": "text",
        "text": "25.3.4 Configuring the SPI for half-duplex communication ",
        "text_level": 1,
        "bbox": [
            117,
            776,
            695,
            794
        ],
        "page_idx": 8
    },
    {
        "type": "text",
        "text": "The SPI is capable of operating in half-duplex mode in 2 configurations. ",
        "bbox": [
            205,
            802,
            736,
            818
        ],
        "page_idx": 8
    },
    {
        "type": "text",
        "text": "1 clock and 1 bidirectional data wire   \n1 clock and 1 data wire (receive-only or transmit-only) ",
        "bbox": [
            205,
            820,
            643,
            852
        ],
        "page_idx": 8
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            68,
            887,
            83
        ],
        "page_idx": 8
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 8
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            68,
            176,
            81
        ],
        "page_idx": 8
    },
    {
        "type": "discarded",
        "text": "707/1136 ",
        "bbox": [
            823,
            882,
            887,
            894
        ],
        "page_idx": 8
    },
    {
        "type": "discarded",
        "text": "5T ",
        "bbox": [
            117,
            874,
            164,
            894
        ],
        "page_idx": 8
    },
    {
        "type": "text",
        "text": "1 clock and 1 bidirectional data wire (BIDIMODE $= \\uparrow$ 1) ",
        "text_level": 1,
        "bbox": [
            205,
            104,
            665,
            121
        ],
        "page_idx": 9
    },
    {
        "type": "text",
        "text": "This mode is enabled by setting the BIDIMODE bit in the SPI_CR1 register. In this mode SCK is used for the clock and MOSI in master or MISO in slave mode is used for data communication. The transfer direction (Input/Output) is selected by the BIDIOE bit in the SPI_CR1 register. When this bit is 1, the data line is output otherwise it is input. ",
        "bbox": [
            206,
            129,
            863,
            186
        ],
        "page_idx": 9
    },
    {
        "type": "text",
        "text": "1 clock and 1 unidirectional data wire (BIDIMODE $\\mathbf { \\mu } = \\mathbf { 0 }$ ) ",
        "text_level": 1,
        "bbox": [
            206,
            198,
            677,
            213
        ],
        "page_idx": 9
    },
    {
        "type": "text",
        "text": "In this mode, the application can use the SPI either in transmit-only mode or in receive-only mode. ",
        "bbox": [
            203,
            222,
            885,
            250
        ],
        "page_idx": 9
    },
    {
        "type": "text",
        "text": "Transmit-only mode is similar to full-duplex mode (BIDIMODE $\\mathtt { = 0 }$ , ${ \\sf R X O N L Y } = 0$ ): the data are transmitted on the transmit pin (MOSI in master mode or MISO in slave mode) and the receive pin (MISO in master mode or MOSI in slave mode) can be used as a general-purpose IO. In this case, the application just needs to ignore the Rx buffer (if the data register is read, it does not contain the received value). In receive-only mode, the application can disable the SPI output function by setting the RXONLY bit in the SPI_CR1 register. In this case, it frees the transmit IO pin (MOSI in master mode or MISO in slave mode), so it can be used for other purposes. ",
        "bbox": [
            201,
            254,
            885,
            371
        ],
        "page_idx": 9
    },
    {
        "type": "text",
        "text": "To start the communication in receive-only mode, configure and enable the SPI: ",
        "bbox": [
            205,
            378,
            800,
            393
        ],
        "page_idx": 9
    },
    {
        "type": "text",
        "text": "In master mode, the communication starts immediately and stops when the SPE bit is cleared and the current reception stops. There is no need to read the BSY flag in this mode. It is always set when an SPI communication is ongoing. In slave mode, the SPI continues to receive as long as the NSS is pulled down (or the SSI bit is cleared in NSS software mode) and the SCK is running. ",
        "bbox": [
            205,
            396,
            880,
            472
        ],
        "page_idx": 9
    },
    {
        "type": "text",
        "text": "25.3.5 Data transmission and reception procedures ",
        "text_level": 1,
        "bbox": [
            109,
            488,
            633,
            504
        ],
        "page_idx": 9
    },
    {
        "type": "text",
        "text": "Rx and Tx buffers ",
        "text_level": 1,
        "bbox": [
            205,
            515,
            364,
            532
        ],
        "page_idx": 9
    },
    {
        "type": "text",
        "text": "In reception, data are received and then stored into an internal Rx buffer while In transmission, data are first stored into an internal Tx buffer before being transmitted. ",
        "bbox": [
            205,
            540,
            830,
            568
        ],
        "page_idx": 9
    },
    {
        "type": "text",
        "text": "A read access of the SPI_DR register returns the Rx buffered value whereas a write access to the SPI_DR stores the written data into the Tx buffer. ",
        "bbox": [
            205,
            574,
            885,
            604
        ],
        "page_idx": 9
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 9
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            109,
            70,
            363,
            83
        ],
        "page_idx": 9
    },
    {
        "type": "discarded",
        "text": "708/1136 ",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 9
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            821,
            70,
            885,
            81
        ],
        "page_idx": 9
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            833,
            874,
            880,
            893
        ],
        "page_idx": 9
    },
    {
        "type": "text",
        "text": "Start sequence in master mode ",
        "text_level": 1,
        "bbox": [
            205,
            105,
            480,
            121
        ],
        "page_idx": 10
    },
    {
        "type": "text",
        "text": "In full-duplex (BIDIMODE $\\mathtt { = 0 }$ and ${ \\sf R X O N L Y } = 0 $ ) ",
        "bbox": [
            205,
            129,
            581,
            143
        ],
        "page_idx": 10
    },
    {
        "type": "text",
        "text": "The sequence begins when data are written into the SPI_DR register (Tx buffer). The data are then parallel loaded from the Tx buffer into the 8-bit shift register during the first bit transmission and then shifted out serially to the MOSI pin. At the same time, the received data on the MISO pin is shifted in serially to the 8- bit shift register and then parallel loaded into the SPI_DR register (Rx buffer). ",
        "bbox": [
            238,
            147,
            880,
            226
        ],
        "page_idx": 10
    },
    {
        "type": "text",
        "text": "In unidirectional receive-only mode (BIDIMODE $\\mathtt { = 0 }$ and RXONLY $^ { \\prime } { = } 1$ ) ",
        "bbox": [
            200,
            229,
            749,
            243
        ],
        "page_idx": 10
    },
    {
        "type": "text",
        "text": "The sequence begins as soon as SPE $= 1$   \nOnly the receiver is activated and the received data on the MISO pin are shifted in serially to the 8-bit shift register and then parallel loaded into the SPI_DR register (Rx buffer). ",
        "bbox": [
            238,
            244,
            884,
            307
        ],
        "page_idx": 10
    },
    {
        "type": "text",
        "text": "In bidirectional mode, when transmitting (BIDIMODE $^ { = 1 }$ and $\\mathsf { B } | \\mathsf { D } | \\mathsf { O E } = 1$ ) ",
        "bbox": [
            201,
            311,
            774,
            326
        ],
        "page_idx": 10
    },
    {
        "type": "text",
        "text": "The sequence begins when data are written into the SPI_DR register (Tx buffer). The data are then parallel loaded from the Tx buffer into the 8-bit shift register during the first bit transmission and then shifted out serially to the MOSI pin. No data are received. ",
        "bbox": [
            238,
            328,
            877,
            393
        ],
        "page_idx": 10
    },
    {
        "type": "text",
        "text": "In bidirectional mode, when receiving (BIDIMODE $: 1$ and BIDIOE $\\mathtt { = 0 }$ ) ",
        "bbox": [
            200,
            396,
            752,
            412
        ],
        "page_idx": 10
    },
    {
        "type": "text",
        "text": "The sequence begins as soon as $\\tt S P E { = } 1$ and BIDIOE $\\mathtt { = 0 }$ .   \nThe received data on the MOSI pin are shifted in serially to the 8-bit shift register and then parallel loaded into the SPI_DR register (Rx buffer).   \nThe transmitter is not activated and no data are shifted out serially to the MOSI pin. ",
        "bbox": [
            238,
            414,
            878,
            494
        ],
        "page_idx": 10
    },
    {
        "type": "text",
        "text": "Start sequence in slave mode ",
        "text_level": 1,
        "bbox": [
            205,
            504,
            467,
            520
        ],
        "page_idx": 10
    },
    {
        "type": "text",
        "text": "In full-duplex mode (BIDIMODE $\\mathtt { = 0 }$ and ${ \\sf R X O N L Y } = 0 $ ) ",
        "bbox": [
            205,
            527,
            628,
            542
        ],
        "page_idx": 10
    },
    {
        "type": "text",
        "text": "The sequence begins when the slave device receives the clock signal and the first bit of the data on its MOSI pin. The 7 remaining bits are loaded into the shift register.   \nAt the same time, the data are parallel loaded from the Tx buffer into the 8-bit shift register during the first bit transmission, and then shifted out serially to the MISO pin. The software must have written the data to be sent before the SPI master device initiates the transfer. ",
        "bbox": [
            228,
            546,
            887,
            649
        ],
        "page_idx": 10
    },
    {
        "type": "text",
        "text": "In unidirectional receive-only mode (BIDIMODE $\\mathtt { = 0 }$ and ${ \\mathsf { R X O N L Y } } = 1 $ ) ",
        "bbox": [
            200,
            653,
            747,
            668
        ],
        "page_idx": 10
    },
    {
        "type": "text",
        "text": "The sequence begins when the slave device receives the clock signal and the first bit of the data on its MOSI pin. The 7 remaining bits are loaded into the shift register.   \nThe transmitter is not activated and no data are shifted out serially to the MISO pin. ",
        "bbox": [
            236,
            671,
            884,
            745
        ],
        "page_idx": 10
    },
    {
        "type": "text",
        "text": "In bidirectional mode, when transmitting (BIDIMODE $^ { = 1 }$ and $\\mathsf { B } | \\mathsf { D } | \\mathsf { O E } = 1$ ) ",
        "bbox": [
            200,
            749,
            774,
            764
        ],
        "page_idx": 10
    },
    {
        "type": "text",
        "text": "The sequence begins when the slave device receives the clock signal and the first bit in the Tx buffer is transmitted on the MISO pin. The data are then parallel loaded from the Tx buffer into the 8-bit shift register during the first bit transmission and then shifted out serially to the MISO pin. The ",
        "bbox": [
            238,
            767,
            882,
            828
        ],
        "page_idx": 10
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            70,
            887,
            83
        ],
        "page_idx": 10
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 10
    },
    {
        "type": "discarded",
        "text": "709/1136 ",
        "bbox": [
            823,
            882,
            887,
            894
        ],
        "page_idx": 10
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            68,
            176,
            81
        ],
        "page_idx": 10
    },
    {
        "type": "discarded",
        "text": "5 ",
        "bbox": [
            117,
            874,
            164,
            893
        ],
        "page_idx": 10
    },
    {
        "type": "text",
        "text": "software must have written the data to be sent before the SPI master device initiates the transfer.   \nNo data are received. ",
        "bbox": [
            240,
            105,
            847,
            152
        ],
        "page_idx": 11
    },
    {
        "type": "text",
        "text": "In bidirectional mode, when receiving (BIDIMODE $: 1$ and ${ \\mathsf { B } } { \\mathsf { I D } } { \\mathsf { I O E } } { = } 0 _ { . }$ ) ",
        "bbox": [
            203,
            155,
            752,
            171
        ],
        "page_idx": 11
    },
    {
        "type": "text",
        "text": "The sequence begins when the slave device receives the clock signal and the first bit of the data on its MISO pin.   \nThe received data on the MISO pin are shifted in serially to the 8-bit shift register and then parallel loaded into the SPI_DR register (Rx buffer).   \nThe transmitter is not activated and no data are shifted out serially to the MISO pin. ",
        "bbox": [
            238,
            173,
            884,
            267
        ],
        "page_idx": 11
    },
    {
        "type": "text",
        "text": "Handling data transmission and reception ",
        "text_level": 1,
        "bbox": [
            205,
            277,
            576,
            293
        ],
        "page_idx": 11
    },
    {
        "type": "text",
        "text": "The TXE flag (Tx buffer empty) is set when the data are transferred from the Tx buffer to the shift register. It indicates that the internal $\\mathsf { T x }$ buffer is ready to be loaded with the next data. An interrupt can be generated if the TXEIE bit in the SPI_CR2 register is set. Clearing the TXE bit is performed by writing to the SPI_DR register. ",
        "bbox": [
            205,
            301,
            882,
            359
        ],
        "page_idx": 11
    },
    {
        "type": "text",
        "text": "The software must ensure that the TXE flag is set to 1 before attempting to write to the $\\tau _ { x }$ buffer. Otherwise, it overwrites the data previously written to the Tx buffer. ",
        "bbox": [
            201,
            365,
            873,
            394
        ],
        "page_idx": 11
    },
    {
        "type": "text",
        "text": "The RXNE flag (Rx buffer not empty) is set on the last sampling clock edge, when the data are transferred from the shift register to the Rx buffer. It indicates that data are ready to be read from the SPI_DR register. An interrupt can be generated if the RXNEIE bit in the SPI_CR2 register is set. Clearing the RXNE bit is performed by reading the SPI_DR register. ",
        "bbox": [
            205,
            401,
            880,
            472
        ],
        "page_idx": 11
    },
    {
        "type": "text",
        "text": "For some configurations, the BSY flag can be used during the last data transfer to wait until the completion of the transfer. ",
        "bbox": [
            203,
            478,
            882,
            508
        ],
        "page_idx": 11
    },
    {
        "type": "text",
        "text": "Full-duplex transmit and receive procedure in master or slave mode (BIDIMODE $\\mathtt { = 0 }$ and RXONLY $\\mathtt { = 0 }$ ) ",
        "bbox": [
            203,
            515,
            858,
            545
        ],
        "page_idx": 11
    },
    {
        "type": "text",
        "text": "The software has to follow this procedure to transmit and receive data (see Figure 241 and Figure 242): ",
        "bbox": [
            206,
            551,
            884,
            579
        ],
        "page_idx": 11
    },
    {
        "type": "text",
        "text": "1. Enable the SPI by setting the SPE bit to 1.   \n2. Write the first data item to be transmitted into the SPI_DR register (this clears the TXE flag).   \n3. Wait until $\\mathsf { T X E } = 1$ and write the second data item to be transmitted. Then wait until RXNE $= 1$ and read the SPI_DR to get the first received data item (this clears the RXNE bit). Repeat this operation for each data item to be transmitted/received until the n–1 received data.   \n4. Wait until $\\mathsf { R X N E } = 1$ and read the last received data.   \n5. Wait until $\\mathsf { T X E } = 1$ and then wait until ${ \\mathsf { B } } { \\mathsf { S Y } } { = } 0$ before disabling the SPI. ",
        "bbox": [
            205,
            583,
            885,
            726
        ],
        "page_idx": 11
    },
    {
        "type": "text",
        "text": "This procedure can also be implemented using dedicated interrupt subroutines launched at each rising edges of the RXNE or TXE flag. ",
        "bbox": [
            203,
            732,
            882,
            761
        ],
        "page_idx": 11
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 11
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            109,
            70,
            363,
            83
        ],
        "page_idx": 11
    },
    {
        "type": "discarded",
        "text": "710/1136 ",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 11
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            821,
            70,
            887,
            81
        ],
        "page_idx": 11
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            833,
            874,
            880,
            893
        ],
        "page_idx": 11
    },
    {
        "type": "discarded",
        "text": "Note: ",
        "bbox": [
            109,
            366,
            152,
            380
        ],
        "page_idx": 11
    },
    {
        "type": "image",
        "img_path": "images/2ff92eb33bd1d6a1478b6f57767cec5b48aa0d6eb66280f4ff41df1e43a7421e.jpg",
        "image_caption": [
            "Figure 241. TXE/RXNE/BSY behavior in Master / full-duplex mode (BIDIMODE $ 0$ and RXONLY=0) in case of continuous transfers "
        ],
        "image_footnote": [],
        "bbox": [
            110,
            137,
            884,
            467
        ],
        "page_idx": 12
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            70,
            887,
            81
        ],
        "page_idx": 12
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            70,
            174,
            80
        ],
        "page_idx": 12
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 12
    },
    {
        "type": "discarded",
        "text": "5 ",
        "bbox": [
            117,
            874,
            164,
            893
        ],
        "page_idx": 12
    },
    {
        "type": "discarded",
        "text": "711/1136 ",
        "bbox": [
            823,
            882,
            887,
            894
        ],
        "page_idx": 12
    },
    {
        "type": "image",
        "img_path": "images/1f5e9556337a9ba41162a372954e802490c86138c6a5e7b1c06206ad647757d8.jpg",
        "image_caption": [
            "Figure 242. TXE/RXNE/BSY behavior in Slave / full-duplex mode (BIDIMODE $\\bf {  \\equiv 0 }$ , RXONLY=0) in case of continuous transfers "
        ],
        "image_footnote": [],
        "bbox": [
            110,
            140,
            880,
            484
        ],
        "page_idx": 13
    },
    {
        "type": "text",
        "text": "Transmit-only procedure (BIDIMODE $\\bf {  \\equiv 0 }$ RXONLY=0) ",
        "text_level": 1,
        "bbox": [
            203,
            501,
            658,
            519
        ],
        "page_idx": 13
    },
    {
        "type": "text",
        "text": "In this mode, the procedure can be reduced as described below and the BSY bit can be used to wait until the completion of the transmission (see Figure 243 and Figure 244). ",
        "bbox": [
            203,
            526,
            858,
            555
        ],
        "page_idx": 13
    },
    {
        "type": "text",
        "text": "1. Enable the SPI by setting the SPE bit to 1.   \n2. Write the first data item to send into the SPI_DR register (this clears the TXE bit).   \n3. Wait until $\\mathsf { T X E } = 1$ and write the next data item to be transmitted. Repeat this step for each data item to be transmitted.   \n4. After writing the last data item into the SPI_DR register, wait until $\\mathsf { T X E } = 1$ , then wait until ${ \\mathsf { B } } { \\mathsf { S Y } } { = } 0$ , this indicates that the transmission of the last data is complete. ",
        "bbox": [
            203,
            558,
            884,
            654
        ],
        "page_idx": 13
    },
    {
        "type": "text",
        "text": "This procedure can be also implemented using dedicated interrupt subroutines launched at each rising edge of the TXE flag. ",
        "bbox": [
            205,
            661,
            884,
            691
        ],
        "page_idx": 13
    },
    {
        "type": "text",
        "text": "Note: ",
        "text_level": 1,
        "bbox": [
            109,
            698,
            152,
            711
        ],
        "page_idx": 13
    },
    {
        "type": "text",
        "text": "During discontinuous communications, there is a 2 APB clock period delay between the write operation to SPI_DR and the BSY bit setting. As a consequence, in transmit-only mode, it is mandatory to wait first until TXE is set and then until BSY is cleared after writing the last data. ",
        "bbox": [
            205,
            697,
            884,
            754
        ],
        "page_idx": 13
    },
    {
        "type": "text",
        "text": "After transmitting two data items in transmit-only mode, the OVR flag is set in the SPI_SR register since the received data are never read. ",
        "bbox": [
            201,
            758,
            877,
            787
        ],
        "page_idx": 13
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 13
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            109,
            70,
            363,
            81
        ],
        "page_idx": 13
    },
    {
        "type": "discarded",
        "text": "712/1136 ",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 13
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            821,
            70,
            885,
            80
        ],
        "page_idx": 13
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            833,
            874,
            880,
            893
        ],
        "page_idx": 13
    },
    {
        "type": "image",
        "img_path": "images/ad295cc8021c4b607bec6d85e05bb7e4dd08eb6b78397c3e40b70b38e1adee90.jpg",
        "image_caption": [
            "Figure 243. TXE/BSY behavior in Master transmit-only mode (BIDIMODE $\\tt { \\tt = 0 }$ and RXONLY $\\mathbf { = 0 }$ ) in case of continuous transfers "
        ],
        "image_footnote": [],
        "bbox": [
            114,
            136,
            884,
            380
        ],
        "page_idx": 14
    },
    {
        "type": "image",
        "img_path": "images/101af65480b3909a7c8df11e5a1f9fc1e729833c3853e4582c8633c785df6035.jpg",
        "image_caption": [
            "Figure 244. TXE/BSY in Slave transmit-only mode (BIDIMODE $\\bf { \\tt = 0 }$ and RXONLY $\\mathtt  \\mathtt  \\mathtt  \\mathtt  \\mathtt  \\mathtt  \\mathtt  \\mathtt \\mathtt  \\mathtt  \\mathtt \\mathtt  \\mathtt \\mathtt  \\mathtt \\mathtt  \\mathtt \\mathtt  \\mathtt \\mathtt  \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt $ ) in case of continuous transfers "
        ],
        "image_footnote": [],
        "bbox": [
            114,
            427,
            885,
            662
        ],
        "page_idx": 14
    },
    {
        "type": "text",
        "text": "Bidirectional transmit procedure (BIDIMODE $\\bullet \\bullet$ and BIDIOE $: = 1$ ) ",
        "text_level": 1,
        "bbox": [
            206,
            673,
            752,
            690
        ],
        "page_idx": 14
    },
    {
        "type": "text",
        "text": "In this mode, the procedure is similar to the procedure in Transmit-only mode except that the BIDIMODE and BIDIOE bits both have to be set in the SPI_CR2 register before enabling the SPI. ",
        "bbox": [
            203,
            698,
            885,
            741
        ],
        "page_idx": 14
    },
    {
        "type": "text",
        "text": "Unidirectional receive-only procedure (BIDIMODE $\\bf {  \\equiv 0 }$ and RXONLY $^ { \\prime = 1 }$ ) ",
        "text_level": 1,
        "bbox": [
            205,
            751,
            810,
            769
        ],
        "page_idx": 14
    },
    {
        "type": "text",
        "text": "In this mode, the procedure can be reduced as described below (see Figure 245): ",
        "bbox": [
            205,
            776,
            813,
            790
        ],
        "page_idx": 14
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 14
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            70,
            885,
            81
        ],
        "page_idx": 14
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            70,
            174,
            80
        ],
        "page_idx": 14
    },
    {
        "type": "discarded",
        "text": "713/1136 ",
        "bbox": [
            823,
            882,
            887,
            894
        ],
        "page_idx": 14
    },
    {
        "type": "discarded",
        "text": "5 ",
        "bbox": [
            117,
            874,
            164,
            893
        ],
        "page_idx": 14
    },
    {
        "type": "text",
        "text": "1. Set the RXONLY bit in the SPI_CR1 register. ",
        "bbox": [
            208,
            104,
            576,
            119
        ],
        "page_idx": 15
    },
    {
        "type": "text",
        "text": "2. Enable the SPI by setting the SPE bit to 1: ",
        "bbox": [
            203,
            123,
            556,
            138
        ],
        "page_idx": 15
    },
    {
        "type": "text",
        "text": "a) In master mode, this immediately activates the generation of the SCK clock, and data are serially received until the SPI is disabled $( { \\mathsf { S P E } } { = } 0 )$ ).   \nb) In slave mode, data are received when the SPI master device drives NSS low and generates the SCK clock. ",
        "bbox": [
            238,
            141,
            882,
            201
        ],
        "page_idx": 15
    },
    {
        "type": "text",
        "text": "3. Wait until RXNE $= 1$ and read the SPI_DR register to get the received data (this clears the RXNE bit). Repeat this operation for each data item to be received. ",
        "bbox": [
            203,
            205,
            875,
            233
        ],
        "page_idx": 15
    },
    {
        "type": "text",
        "text": "This procedure can also be implemented using dedicated interrupt subroutines launched at each rising edge of the RXNE flag. ",
        "bbox": [
            203,
            241,
            884,
            269
        ],
        "page_idx": 15
    },
    {
        "type": "text",
        "text": "Note: ",
        "bbox": [
            109,
            276,
            152,
            289
        ],
        "page_idx": 15
    },
    {
        "type": "text",
        "text": "If it is required to disable the SPI after the last transfer, follow the recommendation described in Section 25.3.8. ",
        "bbox": [
            201,
            276,
            818,
            305
        ],
        "page_idx": 15
    },
    {
        "type": "image",
        "img_path": "images/4fa2da6d7d725cecd58e85854fb3831dd07bbad7763dea34de554f410de82136.jpg",
        "image_caption": [
            "Figure 245. RXNE behavior in receive-only mode (BIDIRMODE $\\left[ \\mathbf { = 0 } \\right]$ and RXONLY=1) in case of continuous transfers "
        ],
        "image_footnote": [],
        "bbox": [
            110,
            350,
            880,
            568
        ],
        "page_idx": 15
    },
    {
        "type": "text",
        "text": "Bidirectional receive procedure (BIDIMODE $\\mathop { : = } 1$ and BIDIOE $\\bf { : = 0 }$ ) ",
        "text_level": 1,
        "bbox": [
            206,
            579,
            742,
            596
        ],
        "page_idx": 15
    },
    {
        "type": "text",
        "text": "In this mode, the procedure is similar to the Receive-only mode procedure except that the BIDIMODE bit has to be set and the BIDIOE bit cleared in the SPI_CR2 register before enabling the SPI. ",
        "bbox": [
            205,
            604,
            877,
            647
        ],
        "page_idx": 15
    },
    {
        "type": "text",
        "text": "Continuous and discontinuous transfers ",
        "text_level": 1,
        "bbox": [
            205,
            659,
            564,
            674
        ],
        "page_idx": 15
    },
    {
        "type": "text",
        "text": "When transmitting data in master mode, if the software is fast enough to detect each rising edge of TXE (or TXE interrupt) and to immediately write to the SPI_DR register before the ongoing data transfer is complete, the communication is said to be continuous. In this case, there is no discontinuity in the generation of the SPI clock between each data item and the BSY bit is never cleared between each data transfer. ",
        "bbox": [
            205,
            681,
            880,
            754
        ],
        "page_idx": 15
    },
    {
        "type": "text",
        "text": "On the contrary, if the software is not fast enough, this can lead to some discontinuities in the communication. In this case, the BSY bit is cleared between each data transmission (see Figure 246). ",
        "bbox": [
            205,
            761,
            872,
            804
        ],
        "page_idx": 15
    },
    {
        "type": "text",
        "text": "In Master receive-only mode $( \\mathsf { R } \\mathsf { X O N L Y } = 1 $ ), the communication is always continuous and the BSY flag is always read at 1. ",
        "bbox": [
            205,
            809,
            867,
            839
        ],
        "page_idx": 15
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 15
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            109,
            68,
            363,
            83
        ],
        "page_idx": 15
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            821,
            70,
            887,
            81
        ],
        "page_idx": 15
    },
    {
        "type": "discarded",
        "text": "714/1136 ",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 15
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            833,
            874,
            880,
            893
        ],
        "page_idx": 15
    },
    {
        "type": "text",
        "text": "In slave mode, the continuity of the communication is decided by the SPI master device. In any case, even if the communication is continuous, the BSY flag goes low between each transfer for a minimum duration of one SPI clock cycle (see Figure 244). ",
        "bbox": [
            203,
            105,
            882,
            148
        ],
        "page_idx": 16
    },
    {
        "type": "image",
        "img_path": "images/ce4f6afa83fd56e54a84b9f24c89a47f4bde3f39344534e61a70676917436df5.jpg",
        "image_caption": [
            "Figure 246. TXE/BSY behavior when transmitting (BIDIRMODE $\\mathtt { \\mathtt { = 0 } }$ and RXONLY $\\mathtt  \\mathtt  \\mathtt  \\mathtt  \\mathtt  \\mathtt  \\mathtt  \\mathtt \\mathtt  \\mathtt  \\mathtt \\mathtt  \\mathtt \\mathtt  \\mathtt \\mathtt  \\mathtt \\mathtt  \\mathtt \\mathtt  \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt  \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt \\mathtt $ ) in case of discontinuous transfers "
        ],
        "image_footnote": [],
        "bbox": [
            110,
            192,
            882,
            446
        ],
        "page_idx": 16
    },
    {
        "type": "text",
        "text": "25.3.6 CRC calculation ",
        "text_level": 1,
        "bbox": [
            110,
            465,
            363,
            482
        ],
        "page_idx": 16
    },
    {
        "type": "text",
        "text": "A CRC calculator has been implemented for communication reliability. Separate CRC calculators are implemented for transmitted data and received data. The CRC is calculated using a programmable polynomial serially on each bit. It is calculated on the sampling clock edge defined by the CPHA and CPOL bits in the SPI_CR1 register. ",
        "bbox": [
            205,
            490,
            884,
            547
        ],
        "page_idx": 16
    },
    {
        "type": "text",
        "text": "Note: ",
        "text_level": 1,
        "bbox": [
            109,
            555,
            152,
            568
        ],
        "page_idx": 16
    },
    {
        "type": "text",
        "text": "This SPI offers two kinds of CRC calculation standard which depend directly on the data frame format selected for the transmission and/or reception: 8-bit data (CR8) and 16-bit data (CRC16). ",
        "bbox": [
            205,
            554,
            884,
            597
        ],
        "page_idx": 16
    },
    {
        "type": "text",
        "text": "CRC calculation is enabled by setting the CRCEN bit in the SPI_CR1 register. This action resets the CRC registers (SPI_RXCRCR and SPI_TXCRCR). In full duplex or transmitter only mode, when the transfers are managed by the software (CPU mode), it is necessary to write the bit CRCNEXT immediately after the last data to be transferred is written to the SPI_DR. At the end of this last data transfer, the SPI_TXCRCR value is transmitted. ",
        "bbox": [
            205,
            604,
            885,
            676
        ],
        "page_idx": 16
    },
    {
        "type": "text",
        "text": "In receive only mode and when the transfers are managed by software (CPU mode), it is necessary to write the CRCNEXT bit after the second last data has been received. The CRC is received just after the last data reception and the CRC check is then performed. ",
        "bbox": [
            205,
            682,
            885,
            726
        ],
        "page_idx": 16
    },
    {
        "type": "text",
        "text": "At the end of data and CRC transfers, the CRCERR flag in the SPI_SR register is set if corruption occurs during the transfer. ",
        "bbox": [
            206,
            732,
            857,
            761
        ],
        "page_idx": 16
    },
    {
        "type": "text",
        "text": "If data are present in the TX buffer, the CRC value is transmitted only after the transmission of the data byte. During CRC transmission, the CRC calculator is switched off and the register value remains unchanged. ",
        "bbox": [
            205,
            768,
            884,
            812
        ],
        "page_idx": 16
    },
    {
        "type": "text",
        "text": "SPI communication using the CRC is possible through the following procedure: ",
        "bbox": [
            203,
            818,
            793,
            833
        ],
        "page_idx": 16
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            70,
            885,
            83
        ],
        "page_idx": 16
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 16
    },
    {
        "type": "discarded",
        "text": "715/1136 ",
        "bbox": [
            823,
            882,
            887,
            894
        ],
        "page_idx": 16
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            70,
            174,
            81
        ],
        "page_idx": 16
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            117,
            874,
            164,
            893
        ],
        "page_idx": 16
    },
    {
        "type": "text",
        "text": "1. Program the CPOL, CPHA, LSBFirst, BR, SSM, SSI and MSTR values. ",
        "bbox": [
            200,
            104,
            773,
            119
        ],
        "page_idx": 17
    },
    {
        "type": "text",
        "text": "2. Program the polynomial in the SPI_CRCPR register. ",
        "bbox": [
            205,
            123,
            635,
            138
        ],
        "page_idx": 17
    },
    {
        "type": "text",
        "text": "3. Enable the CRC calculation by setting the CRCEN bit in the SPI_CR1 register. This also clears the SPI_RXCRCR and SPI_TXCRCR registers. ",
        "bbox": [
            205,
            141,
            863,
            171
        ],
        "page_idx": 17
    },
    {
        "type": "text",
        "text": "4. Enable the SPI by setting the SPE bit in the SPI_CR1 register. ",
        "bbox": [
            203,
            173,
            707,
            188
        ],
        "page_idx": 17
    },
    {
        "type": "text",
        "text": "5. Start the communication and sustain the communication until all but one byte or halfword have been transmitted or received. ",
        "bbox": [
            205,
            191,
            870,
            219
        ],
        "page_idx": 17
    },
    {
        "type": "text",
        "text": "In full duplex or transmitter-only mode, when the transfers are managed by software, when writing the last byte or half word to the Tx buffer, set the CRCNEXT bit in the SPI_CR1 register to indicate that the CRC will be transmitted after the transmission of the last byte. In receiver only mode, set the bit CRCNEXT just after the reception of the second to last data to prepare the SPI to enter in CRC Phase at the end of the reception of the last data. CRC calculation is frozen during the CRC transfer. ",
        "bbox": [
            238,
            223,
            885,
            326
        ],
        "page_idx": 17
    },
    {
        "type": "text",
        "text": "6. After the transfer of the last byte or half word, the SPI enters the CRC transfer and check phase. In full duplex mode or receiver-only mode, the received CRC is compared to the SPI_RXCRCR value. If the value does not match, the CRCERR flag in SPI_SR is set and an interrupt can be generated when the ERRIE bit in the SPI_CR2 register is set. ",
        "bbox": [
            205,
            330,
            885,
            401
        ],
        "page_idx": 17
    },
    {
        "type": "text",
        "text": "Note: ",
        "bbox": [
            109,
            409,
            152,
            422
        ],
        "page_idx": 17
    },
    {
        "type": "text",
        "text": "When the SPI is in slave mode, be careful to enable CRC calculation only when the clock is stable, that is, when the clock is in the steady state. If not, a wrong CRC calculation may be done. In fact, the CRC is sensitive to the SCK slave input clock as soon as CRCEN is set, and this, whatever the value of the SPE bit. ",
        "bbox": [
            205,
            408,
            885,
            465
        ],
        "page_idx": 17
    },
    {
        "type": "text",
        "text": "With high bitrate frequencies, be careful when transmitting the CRC. As the number of used CPU cycles has to be as low as possible in the CRC transfer phase, it is forbidden to call software functions in the CRC transmission sequence to avoid errors in the last data and CRC reception. In fact, CRCNEXT bit has to be written before the end of the transmission/reception of the last data. ",
        "bbox": [
            205,
            470,
            885,
            541
        ],
        "page_idx": 17
    },
    {
        "type": "text",
        "text": "For high bit rate frequencies, it is advised to use the DMA mode to avoid the degradation of the SPI speed performance due to CPU accesses impacting the SPI bandwidth. ",
        "bbox": [
            205,
            546,
            885,
            574
        ],
        "page_idx": 17
    },
    {
        "type": "text",
        "text": "When the devices are configured as slaves and the NSS hardware mode is used, the NSS pin needs to be kept low between the data phase and the CRC phase. ",
        "bbox": [
            201,
            579,
            880,
            608
        ],
        "page_idx": 17
    },
    {
        "type": "text",
        "text": "When the SPI is configured in slave mode with the CRC feature enabled, CRC calculation takes place even if a high level is applied on the NSS pin. This may happen for example in case of a multislave environment where the communication master addresses slaves alternately. ",
        "bbox": [
            205,
            615,
            878,
            672
        ],
        "page_idx": 17
    },
    {
        "type": "text",
        "text": "Between a slave deselection (high level on NSS) and a new slave selection (low level on NSS), the CRC value should be cleared on both master and slave sides in order to resynchronize the master and slave for their respective CRC calculation. ",
        "bbox": [
            205,
            679,
            870,
            722
        ],
        "page_idx": 17
    },
    {
        "type": "text",
        "text": "To clear the CRC, follow the procedure below: ",
        "bbox": [
            206,
            729,
            547,
            743
        ],
        "page_idx": 17
    },
    {
        "type": "text",
        "text": "1. Disable SPI $( \\mathsf { S P E } = 0$ )   \n2. Clear the CRCEN bit   \n3. Set the CRCEN bit   \n4. Enable the SPI $( \\mathsf { S P E } = 1 ) ,$ ",
        "bbox": [
            205,
            747,
            435,
            815
        ],
        "page_idx": 17
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 17
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            109,
            68,
            363,
            83
        ],
        "page_idx": 17
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            833,
            874,
            880,
            893
        ],
        "page_idx": 17
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            821,
            68,
            887,
            81
        ],
        "page_idx": 17
    },
    {
        "type": "discarded",
        "text": "716/1136 ",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 17
    },
    {
        "type": "text",
        "text": "25.3.7 Status flags ",
        "text_level": 1,
        "bbox": [
            110,
            105,
            322,
            122
        ],
        "page_idx": 18
    },
    {
        "type": "text",
        "text": "Four status flags are provided for the application to completely monitor the state of the SPI bus. ",
        "bbox": [
            201,
            130,
            880,
            159
        ],
        "page_idx": 18
    },
    {
        "type": "text",
        "text": "Tx buffer empty flag (TXE) ",
        "text_level": 1,
        "bbox": [
            206,
            169,
            438,
            187
        ],
        "page_idx": 18
    },
    {
        "type": "text",
        "text": "When it is set, this flag indicates that the Tx buffer is empty and the next data to be transmitted can be loaded into the buffer. The TXE flag is cleared when writing to the SPI_DR register. ",
        "bbox": [
            205,
            194,
            836,
            237
        ],
        "page_idx": 18
    },
    {
        "type": "text",
        "text": "Rx buffer not empty (RXNE) ",
        "text_level": 1,
        "bbox": [
            206,
            248,
            452,
            264
        ],
        "page_idx": 18
    },
    {
        "type": "text",
        "text": "When set, this flag indicates that there are valid received data in the Rx buffer. It is cleared when SPI_DR is read. ",
        "bbox": [
            203,
            273,
            880,
            301
        ],
        "page_idx": 18
    },
    {
        "type": "text",
        "text": "BUSY flag ",
        "text_level": 1,
        "bbox": [
            205,
            312,
            297,
            328
        ],
        "page_idx": 18
    },
    {
        "type": "text",
        "text": "This BSY flag is set and cleared by hardware (writing to this flag has no effect). The BSY flag indicates the state of the communication layer of the SPI. ",
        "bbox": [
            206,
            337,
            867,
            365
        ],
        "page_idx": 18
    },
    {
        "type": "text",
        "text": "When BSY is set, it indicates that the SPI is busy communicating. There is one exception in master mode / bidirectional receive mode (MSTR $^ { = 1 }$ and BDM $= 1$ and BDOE $\\mathtt { = 0 }$ ) where the BSY flag is kept low during reception. ",
        "bbox": [
            205,
            371,
            882,
            415
        ],
        "page_idx": 18
    },
    {
        "type": "text",
        "text": "The BSY flag is useful to detect the end of a transfer if the software wants to disable the SPI and enter Halt mode (or disable the peripheral clock). This avoids corrupting the last transfer. For this, the procedure described below must be strictly respected. ",
        "bbox": [
            205,
            422,
            884,
            465
        ],
        "page_idx": 18
    },
    {
        "type": "text",
        "text": "The BSY flag is also useful to avoid write collisions in a multimaster system. ",
        "bbox": [
            206,
            472,
            769,
            486
        ],
        "page_idx": 18
    },
    {
        "type": "text",
        "text": "The BSY flag is set when a transfer starts, with the exception of master mode / bidirectional receive mode (MSTR $^ { = 1 }$ and BDM $| = 1$ and ${ \\mathsf { B D O E } } { = } { 0 } )$ ). ",
        "bbox": [
            205,
            494,
            880,
            522
        ],
        "page_idx": 18
    },
    {
        "type": "text",
        "text": "It is cleared: ",
        "bbox": [
            205,
            529,
            297,
            543
        ],
        "page_idx": 18
    },
    {
        "type": "text",
        "text": " when a transfer is finished (except in master mode if the communication is continuous)   \n when the SPI is disabled   \n when a master mode fault occurs $( M O D F = 1$ ) ",
        "bbox": [
            205,
            547,
            885,
            598
        ],
        "page_idx": 18
    },
    {
        "type": "text",
        "text": "When communication is not continuous, the BSY flag is low between each communication. ",
        "bbox": [
            198,
            604,
            882,
            619
        ],
        "page_idx": 18
    },
    {
        "type": "text",
        "text": "When communication is continuous: ",
        "bbox": [
            205,
            625,
            477,
            640
        ],
        "page_idx": 18
    },
    {
        "type": "text",
        "text": " in master mode, the BSY flag is kept high during all the transfers in slave mode, the BSY flag goes low for one SPI clock cycle between each transfer ",
        "bbox": [
            205,
            643,
            872,
            675
        ],
        "page_idx": 18
    },
    {
        "type": "text",
        "text": "Note: ",
        "bbox": [
            109,
            684,
            152,
            695
        ],
        "page_idx": 18
    },
    {
        "type": "text",
        "text": "Do not use the BSY flag to handle each data transmission or reception. It is better to use the TXE and RXNE flags instead. ",
        "bbox": [
            201,
            681,
            885,
            712
        ],
        "page_idx": 18
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            70,
            885,
            83
        ],
        "page_idx": 18
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 18
    },
    {
        "type": "discarded",
        "text": "717/1136 ",
        "bbox": [
            823,
            882,
            887,
            894
        ],
        "page_idx": 18
    },
    {
        "type": "discarded",
        "text": "5 ",
        "bbox": [
            117,
            874,
            164,
            893
        ],
        "page_idx": 18
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            68,
            176,
            81
        ],
        "page_idx": 18
    },
    {
        "type": "text",
        "text": "25.3.8 Disabling the SPI ",
        "text_level": 1,
        "bbox": [
            110,
            104,
            373,
            122
        ],
        "page_idx": 19
    },
    {
        "type": "text",
        "text": "When a transfer is terminated, the application can stop the communication by disabling the SPI peripheral. This is done by clearing the SPE bit. ",
        "bbox": [
            201,
            130,
            882,
            159
        ],
        "page_idx": 19
    },
    {
        "type": "text",
        "text": "For some configurations, disabling the SPI and entering the Halt mode while a transfer is ongoing can cause the current transfer to be corrupted and/or the BSY flag might become unreliable. ",
        "bbox": [
            205,
            166,
            873,
            209
        ],
        "page_idx": 19
    },
    {
        "type": "text",
        "text": "To avoid any of those effects, it is recommended to respect the following procedure when disabling the SPI: ",
        "bbox": [
            201,
            216,
            870,
            244
        ],
        "page_idx": 19
    },
    {
        "type": "text",
        "text": "In master or slave full-duplex mode (BIDIMODE $\\mathbf { \\lambda } = \\mathbf { 0 }$ , RXONLY $\\bf { \\bar { = } 0 }$ ) ",
        "text_level": 1,
        "bbox": [
            206,
            256,
            756,
            273
        ],
        "page_idx": 19
    },
    {
        "type": "text",
        "text": "1. Wait until RXNE $: 1$ to receive the last data   \n2. Wait until $\\mathsf { T X E } = 1$   \n3. Then wait until ${ \\mathsf { B } } { \\mathsf { S Y } } { = } 0$   \n4. Disable the SPI $( \\mathsf { S P E = } 0 )$ ) and, eventually, enter the Halt mode (or disable the peripheral   \nclock) ",
        "bbox": [
            203,
            280,
            885,
            363
        ],
        "page_idx": 19
    },
    {
        "type": "text",
        "text": "In master or slave unidirectional transmit-only mode (BIDIMODE $\\bf {  \\equiv 0 }$ , RXONLY $\\bf { \\bar { = } 0 }$ ) or bidirectional transmit mode (BIDIMODE $^ { = 1 }$ , BIDIOE $\\mathop { : = } 1$ ",
        "bbox": [
            201,
            374,
            803,
            404
        ],
        "page_idx": 19
    },
    {
        "type": "text",
        "text": "After the last data is written into the SPI_DR register: ",
        "bbox": [
            205,
            413,
            601,
            428
        ],
        "page_idx": 19
    },
    {
        "type": "text",
        "text": "1. Wait until $\\mathsf { T X E } = 1$   \n2. Then wait until ${ \\mathsf { B } } { \\mathsf { S Y } } { = } 0$   \n3. Disable the SPI $( \\mathsf { S P E = } 0 )$ ) and, eventually, enter the Halt mode (or disable the peripheral clock) ",
        "bbox": [
            205,
            431,
            885,
            495
        ],
        "page_idx": 19
    },
    {
        "type": "text",
        "text": "In master unidirectional receive-only mode (MSTR $^ { \\prime = 4 }$ , BIDIMODE $\\bf {  \\equiv 0 }$ , $\\scriptstyle \\mathsf { R X O N L Y } = 1 _ { }$ ) or bidirectional receive mode $\\scriptstyle ( 1 + \\ldots + 1 + \\ldots )$ , BIDIMODE $\\mathop { : = } 1$ , BIDIOE $\\bf { \\delta } = 0$ ) ",
        "bbox": [
            201,
            507,
            884,
            538
        ],
        "page_idx": 19
    },
    {
        "type": "text",
        "text": "This case must be managed in a particular way to ensure that the SPI does not initiate a new transfer: ",
        "bbox": [
            205,
            546,
            868,
            574
        ],
        "page_idx": 19
    },
    {
        "type": "text",
        "text": "1. Wait for the second to last occurrence of RXNE $= 1$ (n–1)   \n2. Then wait for one SPI clock cycle (using a software loop) before disabling the SPI $( { \\mathsf { S P E } } { = } 0 )$   \n3. Then wait for the last RXNE $= 1$ before entering the Halt mode (or disabling the peripheral clock) ",
        "bbox": [
            203,
            578,
            857,
            657
        ],
        "page_idx": 19
    },
    {
        "type": "text",
        "text": "Note: ",
        "bbox": [
            109,
            665,
            152,
            676
        ],
        "page_idx": 19
    },
    {
        "type": "text",
        "text": "In master bidirectional receive mode $( M S T R = 1$ and BDM=1 and $B D O E = O ,$ ), the BSY flag is kept low during transfers. ",
        "bbox": [
            201,
            663,
            878,
            692
        ],
        "page_idx": 19
    },
    {
        "type": "text",
        "text": "In slave receive-only mode (MSTR $\\bf { \\left. \\ m \\right| = 0 }$ , BIDIMODE $\\bf { \\Lambda } = 0$ , RXONLY $\\mathop {  }$ 1) or bidirectional receive mode $\\scriptstyle ( \\mathbf { M } \\leq \\mathbf { T } \\mathbf { R } = \\mathbf { 0 }$ , BIDIMODE $\\bullet \\bullet$ , BIDOE $\\bf {  \\equiv 0 }$ ) ",
        "bbox": [
            203,
            703,
            788,
            735
        ],
        "page_idx": 19
    },
    {
        "type": "text",
        "text": "1. You can disable the SPI (write $\\tt S P E { = } 1$ ) at any time: the current transfer will complete before the SPI is effectively disabled   \n2. Then, if you want to enter the Halt mode, you must first wait until ${ \\mathsf { B S Y } } = 0$ before entering the Halt mode (or disabling the peripheral clock). ",
        "bbox": [
            205,
            743,
            870,
            805
        ],
        "page_idx": 19
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 19
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            110,
            68,
            363,
            83
        ],
        "page_idx": 19
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            821,
            68,
            887,
            81
        ],
        "page_idx": 19
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            833,
            874,
            880,
            893
        ],
        "page_idx": 19
    },
    {
        "type": "discarded",
        "text": "718/1136 ",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 19
    },
    {
        "type": "text",
        "text": "25.3.9 SPI communication using DMA (direct memory addressing) ",
        "text_level": 1,
        "bbox": [
            110,
            104,
            778,
            123
        ],
        "page_idx": 20
    },
    {
        "type": "text",
        "text": "To operate at its maximum speed, the SPI needs to be fed with the data for transmission and the data received on the Rx buffer should be read to avoid overrun. To facilitate the transfers, the SPI features a DMA capability implementing a simple request/acknowledge protocol. ",
        "bbox": [
            205,
            130,
            868,
            187
        ],
        "page_idx": 20
    },
    {
        "type": "text",
        "text": "A DMA access is requested when the enable bit in the SPI_CR2 register is enabled. Separate requests must be issued to the Tx and Rx buffers (see Figure 247 and Figure 248): ",
        "bbox": [
            206,
            194,
            833,
            237
        ],
        "page_idx": 20
    },
    {
        "type": "text",
        "text": "In transmission, a DMA request is issued each time TXE is set to 1. The DMA then writes to the SPI_DR register (this clears the TXE flag).   \nIn reception, a DMA request is issued each time RXNE is set to 1. The DMA then reads the SPI_DR register (this clears the RXNE flag). ",
        "bbox": [
            205,
            241,
            887,
            301
        ],
        "page_idx": 20
    },
    {
        "type": "text",
        "text": "When the SPI is used only to transmit data, it is possible to enable only the SPI Tx DMA channel. In this case, the OVR flag is set because the data received are not read. ",
        "bbox": [
            205,
            308,
            867,
            337
        ],
        "page_idx": 20
    },
    {
        "type": "text",
        "text": "When the SPI is used only to receive data, it is possible to enable only the SPI Rx DMA channel. ",
        "bbox": [
            201,
            344,
            858,
            372
        ],
        "page_idx": 20
    },
    {
        "type": "text",
        "text": "In transmission mode, when the DMA has written all the data to be transmitted (flag TCIF is set in the DMA_ISR register), the BSY flag can be monitored to ensure that the SPI communication is complete. This is required to avoid corrupting the last transmission before disabling the SPI or entering the Stop mode. The software must first wait until $\\mathsf { T X E } = 1$ and then until ${ \\mathsf { B } } { \\mathsf { S Y } } { = } 0$ . ",
        "bbox": [
            206,
            380,
            884,
            451
        ],
        "page_idx": 20
    },
    {
        "type": "text",
        "text": "Note: ",
        "text_level": 1,
        "bbox": [
            110,
            459,
            152,
            471
        ],
        "page_idx": 20
    },
    {
        "type": "text",
        "text": "During discontinuous communications, there is a 2 APB clock period delay between the write operation to SPI_DR and the BSY bit setting. As a consequence, it is mandatory to wait first until $\\scriptscriptstyle T X E = 1$ and then until $B S Y = 0$ after writing the last data. ",
        "bbox": [
            206,
            458,
            865,
            502
        ],
        "page_idx": 20
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            70,
            887,
            83
        ],
        "page_idx": 20
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 20
    },
    {
        "type": "discarded",
        "text": "719/1136 ",
        "bbox": [
            823,
            882,
            887,
            894
        ],
        "page_idx": 20
    },
    {
        "type": "discarded",
        "text": "5 ",
        "bbox": [
            117,
            874,
            164,
            893
        ],
        "page_idx": 20
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            68,
            176,
            81
        ],
        "page_idx": 20
    },
    {
        "type": "image",
        "img_path": "images/79b761f7178927d70045ce152fa76056cdf5253bc8f4c1af80778f52a5fa7923.jpg",
        "image_caption": [
            "Figure 247. Transmission using DMA "
        ],
        "image_footnote": [],
        "bbox": [
            110,
            124,
            885,
            466
        ],
        "page_idx": 21
    },
    {
        "type": "image",
        "img_path": "images/98bbce66d39c8e98cb29f72a07f38febe1ce86d7ef95771708a14ac364ab8596.jpg",
        "image_caption": [
            "Figure 248. Reception using DMA "
        ],
        "image_footnote": [],
        "bbox": [
            109,
            500,
            878,
            813
        ],
        "page_idx": 21
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 21
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            110,
            70,
            363,
            81
        ],
        "page_idx": 21
    },
    {
        "type": "discarded",
        "text": "720/1136 ",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 21
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            821,
            70,
            885,
            80
        ],
        "page_idx": 21
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            833,
            874,
            880,
            893
        ],
        "page_idx": 21
    },
    {
        "type": "discarded",
        "text": "",
        "bbox": [
            843,
            804,
            882,
            813
        ],
        "page_idx": 21
    },
    {
        "type": "text",
        "text": "DMA capability with CRC ",
        "text_level": 1,
        "bbox": [
            205,
            104,
            426,
            121
        ],
        "page_idx": 22
    },
    {
        "type": "text",
        "text": "When SPI communication is enabled with CRC communication and DMA mode, the transmission and reception of the CRC at the end of communication are automatic that is without using the bit CRCNEXT. After the CRC reception, the CRC must be read in the SPI_DR register to clear the RXNE flag. ",
        "bbox": [
            205,
            129,
            868,
            186
        ],
        "page_idx": 22
    },
    {
        "type": "text",
        "text": "At the end of data and CRC transfers, the CRCERR flag in SPI_SR is set if corruption occurs during the transfer. ",
        "bbox": [
            203,
            192,
            843,
            222
        ],
        "page_idx": 22
    },
    {
        "type": "text",
        "text": "25.3.10 Error flags ",
        "text_level": 1,
        "bbox": [
            110,
            237,
            309,
            255
        ],
        "page_idx": 22
    },
    {
        "type": "text",
        "text": "Master mode fault (MODF) ",
        "text_level": 1,
        "bbox": [
            205,
            267,
            438,
            282
        ],
        "page_idx": 22
    },
    {
        "type": "text",
        "text": "Master mode fault occurs when the master device has its NSS pin pulled low (in NSS hardware mode) or SSI bit low (in NSS software mode), this automatically sets the MODF bit. Master mode fault affects the SPI peripheral in the following ways: ",
        "bbox": [
            205,
            290,
            875,
            333
        ],
        "page_idx": 22
    },
    {
        "type": "text",
        "text": " The MODF bit is set and an SPI interrupt is generated if the ERRIE bit is set.  The SPE bit is cleared. This blocks all output from the device and disables the SPI interface.  The MSTR bit is cleared, thus forcing the device into slave mode. ",
        "bbox": [
            205,
            337,
            855,
            402
        ],
        "page_idx": 22
    },
    {
        "type": "text",
        "text": "Use the following software sequence to clear the MODF bit: ",
        "bbox": [
            203,
            408,
            652,
            422
        ],
        "page_idx": 22
    },
    {
        "type": "text",
        "text": "1. Make a read or write access to the SPI_SR register while the MODF bit is set.   \n2. Then write to the SPI_CR1 register. ",
        "bbox": [
            206,
            426,
            821,
            459
        ],
        "page_idx": 22
    },
    {
        "type": "text",
        "text": "To avoid any multiple slave conflicts in a system comprising several MCUs, the NSS pin must be pulled high during the MODF bit clearing sequence. The SPE and MSTR bits can be restored to their original state after this clearing sequence. ",
        "bbox": [
            205,
            465,
            877,
            508
        ],
        "page_idx": 22
    },
    {
        "type": "text",
        "text": "As a security, hardware does not allow the setting of the SPE and MSTR bits while the MODF bit is set. ",
        "bbox": [
            205,
            515,
            848,
            543
        ],
        "page_idx": 22
    },
    {
        "type": "text",
        "text": "In a slave device the MODF bit cannot be set. However, in a multimaster configuration, the device can be in slave mode with this MODF bit set. In this case, the MODF bit indicates that there might have been a multimaster conflict for system control. An interrupt routine can be used to recover cleanly from this state by performing a reset or returning to a default state. ",
        "bbox": [
            205,
            551,
            884,
            622
        ],
        "page_idx": 22
    },
    {
        "type": "text",
        "text": "Overrun condition ",
        "text_level": 1,
        "bbox": [
            205,
            634,
            368,
            649
        ],
        "page_idx": 22
    },
    {
        "type": "text",
        "text": "An overrun condition occurs when the master device has sent data bytes and the slave device has not cleared the RXNE bit resulting from the previous data byte transmitted. When an overrun condition occurs: ",
        "bbox": [
            205,
            657,
            855,
            700
        ],
        "page_idx": 22
    },
    {
        "type": "text",
        "text": "the OVR bit is set and an interrupt is generated if the ERRIE bit is set. ",
        "bbox": [
            205,
            703,
            763,
            718
        ],
        "page_idx": 22
    },
    {
        "type": "text",
        "text": "In this case, the receiver buffer contents will not be updated with the newly received data from the master device. A read from the SPI_DR register returns this byte. All other subsequently transmitted bytes are lost. ",
        "bbox": [
            205,
            724,
            868,
            768
        ],
        "page_idx": 22
    },
    {
        "type": "text",
        "text": "Clearing the OVR bit is done by a read from the SPI_DR register followed by a read access to the SPI_SR register. ",
        "bbox": [
            203,
            775,
            884,
            805
        ],
        "page_idx": 22
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            70,
            887,
            83
        ],
        "page_idx": 22
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 22
    },
    {
        "type": "discarded",
        "text": "721/1136 ",
        "bbox": [
            823,
            882,
            887,
            894
        ],
        "page_idx": 22
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            68,
            176,
            81
        ],
        "page_idx": 22
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            117,
            874,
            164,
            893
        ],
        "page_idx": 22
    },
    {
        "type": "text",
        "text": "CRC error ",
        "text_level": 1,
        "bbox": [
            205,
            104,
            297,
            121
        ],
        "page_idx": 23
    },
    {
        "type": "text",
        "text": "This flag is used to verify the validity of the value received when the CRCEN bit in the SPI_CR1 register is set. The CRCERR flag in the SPI_SR register is set if the value received in the shift register does not match the receiver SPI_RXCRCR value. ",
        "bbox": [
            206,
            129,
            842,
            173
        ],
        "page_idx": 23
    },
    {
        "type": "text",
        "text": "25.3.11 SPI interrupts ",
        "text_level": 1,
        "bbox": [
            109,
            187,
            341,
            206
        ],
        "page_idx": 23
    },
    {
        "type": "table",
        "img_path": "images/ddf7fc57be1dd770234cbb4f2bf5eabb4121b8a81cfa425790e56a73230e6e1a.jpg",
        "table_caption": [
            "Table 182. SPI interrupt requests "
        ],
        "table_footnote": [],
        "table_body": "<table><tr><td rowspan=1 colspan=1>Interrupt event</td><td rowspan=1 colspan=1>Event flag</td><td rowspan=1 colspan=1>Enable Control bit</td></tr><tr><td rowspan=1 colspan=1>Transmit buffer empty flag</td><td rowspan=1 colspan=1>TXE</td><td rowspan=1 colspan=1>TXEIE</td></tr><tr><td rowspan=1 colspan=1>Receive buffer not empty flag</td><td rowspan=1 colspan=1>RXNE</td><td rowspan=1 colspan=1>RXNEIE</td></tr><tr><td rowspan=1 colspan=1>Master Mode fault event</td><td rowspan=1 colspan=1>MODF</td><td rowspan=3 colspan=1>ERRIE</td></tr><tr><td rowspan=1 colspan=1>Overrun error</td><td rowspan=1 colspan=1>OVR</td></tr><tr><td rowspan=1 colspan=1>CRC error flag</td><td rowspan=1 colspan=1>CRCERR</td></tr></table>",
        "bbox": [
            205,
            235,
            887,
            363
        ],
        "page_idx": 23
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            109,
            68,
            363,
            83
        ],
        "page_idx": 23
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 23
    },
    {
        "type": "discarded",
        "text": "722/1136 ",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 23
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            821,
            68,
            887,
            81
        ],
        "page_idx": 23
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            833,
            874,
            880,
            893
        ],
        "page_idx": 23
    },
    {
        "type": "text",
        "text": "25.4 $1 ^ { 2 } S$ functional description ",
        "text_level": 1,
        "bbox": [
            110,
            103,
            494,
            124
        ],
        "page_idx": 24
    },
    {
        "type": "text",
        "text": "The ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ audio protocol is not available in low- and medium-density devices. This section concerns only high-density, XL-density and connectivity line devices. ",
        "bbox": [
            201,
            133,
            862,
            162
        ],
        "page_idx": 24
    },
    {
        "type": "text",
        "text": "25.4.1 $1 ^ { 2 } S$ general description ",
        "text_level": 1,
        "bbox": [
            109,
            179,
            428,
            199
        ],
        "page_idx": 24
    },
    {
        "type": "text",
        "text": "The block diagram of the $^ { 1 2 } \\mathsf { S }$ is shown in Figure 249. ",
        "bbox": [
            205,
            205,
            598,
            222
        ],
        "page_idx": 24
    },
    {
        "type": "image",
        "img_path": "images/9cf191a09108545bea418aadeeb95c13c546268779e04a61215cf8d37a72cd4c.jpg",
        "image_caption": [
            "Figure 249. $1 ^ { 2 } \\thinspace \\thinspace \\mathsf { S }$ block diagram "
        ],
        "image_footnote": [],
        "bbox": [
            112,
            252,
            848,
            824
        ],
        "page_idx": 24
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            68,
            887,
            83
        ],
        "page_idx": 24
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 24
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            68,
            176,
            81
        ],
        "page_idx": 24
    },
    {
        "type": "discarded",
        "text": "723/1136 ",
        "bbox": [
            821,
            882,
            887,
            894
        ],
        "page_idx": 24
    },
    {
        "type": "discarded",
        "text": "5 ",
        "bbox": [
            117,
            872,
            166,
            894
        ],
        "page_idx": 24
    },
    {
        "type": "discarded",
        "text": "ai14748 ",
        "bbox": [
            838,
            815,
            878,
            826
        ],
        "page_idx": 24
    },
    {
        "type": "text",
        "text": "The SPI could function as an audio $^ { 1 2 } \\mathsf { S }$ interface when the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ capability is enabled (by setting the I2SMOD bit in the SPI_I2SCFGR register). This interface uses almost the same pins, flags and interrupts as the SPI. ",
        "bbox": [
            205,
            104,
            882,
            148
        ],
        "page_idx": 25
    },
    {
        "type": "text",
        "text": "The ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ shares three common pins with the SPI: ",
        "bbox": [
            206,
            155,
            566,
            169
        ],
        "page_idx": 25
    },
    {
        "type": "text",
        "text": "SD: Serial Data (mapped on the MOSI pin) to transmit or receive the two timemultiplexed data channels (in half-duplex mode only).   \nWS: Word Select (mapped on the NSS pin) is the data control signal output in master mode and input in slave mode.   \nCK: Serial Clock (mapped on the SCK pin) is the serial clock output in master mode and serial clock input in slave mode. ",
        "bbox": [
            205,
            173,
            878,
            267
        ],
        "page_idx": 25
    },
    {
        "type": "text",
        "text": "An additional pin could be used when a master clock output is needed for some external audio devices: ",
        "bbox": [
            203,
            273,
            868,
            300
        ],
        "page_idx": 25
    },
    {
        "type": "text",
        "text": "MCK: Master Clock (mapped separately) is used, when the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ is configured in master mode (and when the MCKOE bit in the SPI_I2SPR register is set), to output this additional clock generated at a preconfigured frequency rate equal to $2 5 6 \\times \\mathsf { F } _ { \\mathsf { S } }$ , where $\\mathsf { F } _ { \\mathsf { S } }$ is the audio sampling frequency. ",
        "bbox": [
            205,
            304,
            882,
            362
        ],
        "page_idx": 25
    },
    {
        "type": "text",
        "text": "The ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ uses its own clock generator to produce the communication clock when it is set in master mode. This clock generator is also the source of the master clock output. Two additional registers are available in ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ mode. One is linked to the clock generator configuration SPI_I2SPR and the other one is a generic ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ configuration register SPI_I2SCFGR (audio standard, slave/master mode, data format, packet frame, clock polarity, etc.). ",
        "bbox": [
            205,
            369,
            877,
            456
        ],
        "page_idx": 25
    },
    {
        "type": "text",
        "text": "The SPI_CR1 register and all CRC registers are not used in the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ mode. Likewise, the SSOE bit in the SPI_CR2 register and the MODF and CRCERR bits in the SPI_SR are not used. ",
        "bbox": [
            205,
            460,
            882,
            504
        ],
        "page_idx": 25
    },
    {
        "type": "text",
        "text": "The ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ uses the same SPI register for data transfer (SPI_DR) in 16-bit wide mode. ",
        "bbox": [
            205,
            510,
            825,
            526
        ],
        "page_idx": 25
    },
    {
        "type": "text",
        "text": "25.4.2 Supported audio protocols ",
        "text_level": 1,
        "bbox": [
            109,
            542,
            465,
            559
        ],
        "page_idx": 25
    },
    {
        "type": "text",
        "text": "The three-line bus has to handle only audio data generally time-multiplexed on two channels: the right channel and the left channel. However there is only one 16-bit register for the transmission and the reception. So, it is up to the software to write into the data register the adequate value corresponding to the considered channel side, or to read the data from the data register and to identify the corresponding channel by checking the CHSIDE bit in the SPI_SR register. Channel Left is always sent first followed by the channel right (CHSIDE has no meaning for the PCM protocol). ",
        "bbox": [
            205,
            567,
            884,
            668
        ],
        "page_idx": 25
    },
    {
        "type": "text",
        "text": "Four data and packet frames are available. Data may be sent with a format of: ",
        "bbox": [
            205,
            674,
            788,
            690
        ],
        "page_idx": 25
    },
    {
        "type": "text",
        "text": " 16-bit data packed in 16-bit frame  16-bit data packed in 32-bit frame  24-bit data packed in 32-bit frame  32-bit data packed in 32-bit frame ",
        "bbox": [
            205,
            692,
            495,
            760
        ],
        "page_idx": 25
    },
    {
        "type": "text",
        "text": "When using 16-bit data extended on 32-bit packet, the first 16 bits (MSB) are the significant bits, the 16-bit LSB is forced to 0 without any need for software action or DMA request (only one read/write operation). ",
        "bbox": [
            205,
            767,
            882,
            809
        ],
        "page_idx": 25
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 25
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            109,
            70,
            361,
            83
        ],
        "page_idx": 25
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            821,
            70,
            887,
            81
        ],
        "page_idx": 25
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            833,
            874,
            880,
            893
        ],
        "page_idx": 25
    },
    {
        "type": "discarded",
        "text": "724/1136 ",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 25
    },
    {
        "type": "text",
        "text": "The 24-bit and 32-bit data frames need two CPU read or write operations to/from the SPI_DR or two DMA operations if the DMA is preferred for the application. For 24-bit data frame specifically, the 8 nonsignificant bits are extended to 32 bits with 0-bits (by hardware). ",
        "bbox": [
            205,
            104,
            885,
            148
        ],
        "page_idx": 26
    },
    {
        "type": "text",
        "text": "For all data formats and communication standards, the most significant bit is always sent first (MSB first). ",
        "bbox": [
            201,
            155,
            868,
            184
        ],
        "page_idx": 26
    },
    {
        "type": "text",
        "text": "The ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ interface supports four audio standards, configurable using the I2SSTD[1:0] and PCMSYNC bits in the SPI_I2SCFGR register. ",
        "bbox": [
            203,
            190,
            865,
            220
        ],
        "page_idx": 26
    },
    {
        "type": "text",
        "text": "I 2S Philips standard ",
        "text_level": 1,
        "bbox": [
            205,
            230,
            383,
            247
        ],
        "page_idx": 26
    },
    {
        "type": "text",
        "text": "For this standard, the WS signal is used to indicate which channel is being transmitted. It is activated one CK clock cycle before the first bit (MSB) is available. ",
        "bbox": [
            203,
            255,
            882,
            285
        ],
        "page_idx": 26
    },
    {
        "type": "image",
        "img_path": "images/6a4d67fe07d499752ca89819dcf6ea66e2a71eaf13d516bd4b1a7d6f0b8b8270.jpg",
        "image_caption": [
            "Figure 250. $1 ^ { 2 } \\thinspace \\thinspace \\mathsf { S }$ Philips protocol waveforms (16/32-bit full accuracy, CPOL = 0) "
        ],
        "image_footnote": [],
        "bbox": [
            297,
            320,
            801,
            508
        ],
        "page_idx": 26
    },
    {
        "type": "text",
        "text": "MS19591V1 ",
        "bbox": [
            818,
            495,
            878,
            505
        ],
        "page_idx": 26
    },
    {
        "type": "text",
        "text": "Data are latched on the falling edge of CK (for the transmitter) and are read on the rising edge (for the receiver). The WS signal is also latched on the falling edge of CK. ",
        "bbox": [
            201,
            515,
            865,
            546
        ],
        "page_idx": 26
    },
    {
        "type": "image",
        "img_path": "images/b3e4aa21f931314d6a1153398ca10be9560d7b0e8fad84e99b14929604262aa1.jpg",
        "image_caption": [
            "Figure 251. I2S Philips standard waveforms (24-bit frame with $\\mathsf { C P O L } = \\mathsf { 0 } )$ "
        ],
        "image_footnote": [],
        "bbox": [
            248,
            581,
            779,
            733
        ],
        "page_idx": 26
    },
    {
        "type": "text",
        "text": "MS19592V1 ",
        "bbox": [
            821,
            724,
            880,
            733
        ],
        "page_idx": 26
    },
    {
        "type": "text",
        "text": "This mode needs two write or read operations to/from the SPI_DR. ",
        "bbox": [
            203,
            742,
            704,
            757
        ],
        "page_idx": 26
    },
    {
        "type": "text",
        "text": "In transmission mode: if 0x8EAA33 has to be sent (24-bit): ",
        "bbox": [
            206,
            761,
            509,
            793
        ],
        "page_idx": 26
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            70,
            885,
            83
        ],
        "page_idx": 26
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 26
    },
    {
        "type": "discarded",
        "text": "725/1136 ",
        "bbox": [
            823,
            882,
            887,
            894
        ],
        "page_idx": 26
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            68,
            174,
            81
        ],
        "page_idx": 26
    },
    {
        "type": "discarded",
        "text": "5 ",
        "bbox": [
            117,
            874,
            164,
            893
        ],
        "page_idx": 26
    },
    {
        "type": "image",
        "img_path": "images/2b6869612ee52a3edfc95210f8bd8d3ede31ca7f45378b68c0b8fca744a92fec.jpg",
        "image_caption": [
            "Figure 252. Transmitting 0x8EAA33 "
        ],
        "image_footnote": [],
        "bbox": [
            205,
            122,
            885,
            256
        ],
        "page_idx": 27
    },
    {
        "type": "text",
        "text": "In reception mode: if data 0x8EAA33 is received: ",
        "bbox": [
            205,
            258,
            463,
            290
        ],
        "page_idx": 27
    },
    {
        "type": "image",
        "img_path": "images/9b7094a9a14b6556af198e3d0a567e3e1de266d4d865d6e000036bb462080349.jpg",
        "image_caption": [
            "Figure 253. Receiving 0x8EAA33 "
        ],
        "image_footnote": [],
        "bbox": [
            205,
            321,
            887,
            444
        ],
        "page_idx": 27
    },
    {
        "type": "image",
        "img_path": "images/d6b98929988988bb58f627039592bb717a4e4778965d809da6458edd838d8412.jpg",
        "image_caption": [
            "Figure 254. I2S Philips standard (16-bit extended to 32-bit packet frame with CPOL $\\mathbf { \\lambda } = \\pmb { 0 }$ ) "
        ],
        "image_footnote": [],
        "bbox": [
            218,
            489,
            847,
            662
        ],
        "page_idx": 27
    },
    {
        "type": "text",
        "text": "MS19599V1 ",
        "bbox": [
            816,
            647,
            875,
            659
        ],
        "page_idx": 27
    },
    {
        "type": "text",
        "text": "When 16-bit data frame extended to 32-bit channel frame is selected during the I2S configuration phase, only one access to SPI_DR is required. The 16 remaining bits are forced by hardware to $0 \\times 0 0 0 0$ to extend the data to 32-bit format. ",
        "bbox": [
            205,
            669,
            852,
            712
        ],
        "page_idx": 27
    },
    {
        "type": "text",
        "text": "If the data to transmit or the received data are 0x76A3 (0x76A30000 extended to 32-bit), the operation shown in Figure 255 is required. ",
        "bbox": [
            205,
            719,
            882,
            749
        ],
        "page_idx": 27
    },
    {
        "type": "image",
        "img_path": "images/8b21f3ee86a360ca0f4c6259c96831b4a8abd15523811d174d9c57feab3ce57a.jpg",
        "image_caption": [
            "Figure 255. Example "
        ],
        "image_footnote": [],
        "bbox": [
            205,
            779,
            885,
            858
        ],
        "page_idx": 27
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            109,
            70,
            363,
            81
        ],
        "page_idx": 27
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 27
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            821,
            70,
            885,
            81
        ],
        "page_idx": 27
    },
    {
        "type": "discarded",
        "text": "5 ",
        "bbox": [
            831,
            872,
            880,
            894
        ],
        "page_idx": 27
    },
    {
        "type": "discarded",
        "text": "726/1136 ",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 27
    },
    {
        "type": "text",
        "text": "For transmission, each time an MSB is written to SPI_DR, the TXE flag is set and its interrupt, if allowed, is generated to load SPI_DR with the new value to send. This takes place even if $0 \\times 0 0 0 0$ have not yet been sent because it is done by hardware. ",
        "bbox": [
            205,
            104,
            863,
            148
        ],
        "page_idx": 28
    },
    {
        "type": "text",
        "text": "For reception, the RXNE flag is set and its interrupt, if allowed, is generated when the first 16 MSB half-word is received. ",
        "bbox": [
            201,
            155,
            872,
            184
        ],
        "page_idx": 28
    },
    {
        "type": "text",
        "text": "In this way, more time is provided between two write or read operations, which prevents underrun or overrun conditions (depending on the direction of the data transfer). ",
        "bbox": [
            205,
            191,
            858,
            220
        ],
        "page_idx": 28
    },
    {
        "type": "text",
        "text": "MSB justified standard ",
        "text_level": 1,
        "bbox": [
            206,
            231,
            408,
            247
        ],
        "page_idx": 28
    },
    {
        "type": "text",
        "text": "For this standard, the WS signal is generated at the same time as the first data bit, which is the MSBit. ",
        "bbox": [
            201,
            255,
            884,
            283
        ],
        "page_idx": 28
    },
    {
        "type": "image",
        "img_path": "images/4bfbf00f7271a8b58af81fb953ce1f9744670d588b3f5905fe3d98a852f15643.jpg",
        "image_caption": [
            "Figure 256. MSB justified 16-bit or 32-bit full-accuracy length with $\\mathsf { C P O L } = \\mathsf { 0 }$ "
        ],
        "image_footnote": [],
        "bbox": [
            289,
            318,
            885,
            461
        ],
        "page_idx": 28
    },
    {
        "type": "text",
        "text": "Data are latched on the falling edge of CK (for transmitter) and are read on the rising edge (for the receiver). ",
        "bbox": [
            201,
            470,
            878,
            500
        ],
        "page_idx": 28
    },
    {
        "type": "image",
        "img_path": "images/c9c5e20edeb73bc5c4fa4f79000c9fd46439ae58e231dfcbb1c3515c1d2c9d72.jpg",
        "image_caption": [
            "Figure 257. MSB justified 24-bit frame length with CPOL ${ \\bf \\beta } = { \\bf 0 }$ "
        ],
        "image_footnote": [],
        "bbox": [
            230,
            534,
            781,
            667
        ],
        "page_idx": 28
    },
    {
        "type": "text",
        "text": "MS30101V1 ",
        "bbox": [
            818,
            667,
            877,
            678
        ],
        "page_idx": 28
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            70,
            887,
            83
        ],
        "page_idx": 28
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 28
    },
    {
        "type": "discarded",
        "text": "727/1136 ",
        "bbox": [
            823,
            882,
            887,
            894
        ],
        "page_idx": 28
    },
    {
        "type": "discarded",
        "text": "5 ",
        "bbox": [
            117,
            874,
            164,
            893
        ],
        "page_idx": 28
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            68,
            174,
            81
        ],
        "page_idx": 28
    },
    {
        "type": "image",
        "img_path": "images/27aa785754a2f83a65ccee32af9f2c11e19044a712ac2fe50873e4be86a7d834.jpg",
        "image_caption": [
            "Figure 258. MSB justified 16-bit extended to 32-bit packet frame with $\\mathsf { C P O L } = \\mathsf { 0 }$ "
        ],
        "image_footnote": [],
        "bbox": [
            242,
            125,
            791,
            281
        ],
        "page_idx": 29
    },
    {
        "type": "text",
        "text": "MS30102V1 ",
        "bbox": [
            821,
            273,
            880,
            283
        ],
        "page_idx": 29
    },
    {
        "type": "text",
        "text": "LSB justified standard ",
        "text_level": 1,
        "bbox": [
            205,
            295,
            403,
            312
        ],
        "page_idx": 29
    },
    {
        "type": "text",
        "text": "This standard is similar to the MSB justified standard (no difference for the 16-bit and 32-bit full-accuracy frame formats). ",
        "bbox": [
            205,
            320,
            884,
            350
        ],
        "page_idx": 29
    },
    {
        "type": "image",
        "img_path": "images/69edf8b1dd793e594a6c1fa21f651f30b8a7485eefd0fb70adb74e3eb1775cb0.jpg",
        "image_caption": [
            "Figure 259. LSB justified 16-bit or 32-bit full-accuracy with CPOL = 0 "
        ],
        "image_footnote": [],
        "bbox": [
            263,
            385,
            887,
            526
        ],
        "page_idx": 29
    },
    {
        "type": "image",
        "img_path": "images/28c1902d046816bfb36ae3fbc92aa520053c6cf68b327c86d2d476627e2de167.jpg",
        "image_caption": [
            "Figure 260. LSB justified 24-bit frame length with CPOL = 0 "
        ],
        "image_footnote": [],
        "bbox": [
            238,
            568,
            766,
            710
        ],
        "page_idx": 29
    },
    {
        "type": "text",
        "text": "MS30104V1 ",
        "bbox": [
            820,
            697,
            878,
            707
        ],
        "page_idx": 29
    },
    {
        "type": "text",
        "text": "In transmission mode: If data $0 { \\times } 3 4 7 8 { \\sf A E }$ have to be transmitted, two write operations to the SPI_DR register are required from software or by DMA. The operations are shown below. ",
        "bbox": [
            205,
            717,
            877,
            763
        ],
        "page_idx": 29
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 29
    },
    {
        "type": "discarded",
        "text": "728/1136 ",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 29
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            821,
            68,
            887,
            81
        ],
        "page_idx": 29
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            109,
            70,
            363,
            81
        ],
        "page_idx": 29
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            833,
            874,
            880,
            893
        ],
        "page_idx": 29
    },
    {
        "type": "image",
        "img_path": "images/497435b615801fd1533f992e17ffec4b2598de1ff6303128169bcf055926de89.jpg",
        "image_caption": [
            "Figure 261. Operations required to transmit 0x3478AE "
        ],
        "image_footnote": [],
        "bbox": [
            205,
            121,
            889,
            252
        ],
        "page_idx": 30
    },
    {
        "type": "text",
        "text": "In reception mode:   \nIf data 0x3478AE are received, two successive read operations from SPI_DR are required on each RXNE event. ",
        "bbox": [
            206,
            255,
            850,
            301
        ],
        "page_idx": 30
    },
    {
        "type": "image",
        "img_path": "images/b113240a87225eba0780d91186be2ed90697be6ba25c5f4fce84f1d0005a1d50.jpg",
        "image_caption": [
            "Figure 262. Operations required to receive 0x3478AE "
        ],
        "image_footnote": [],
        "bbox": [
            205,
            332,
            887,
            477
        ],
        "page_idx": 30
    },
    {
        "type": "image",
        "img_path": "images/f1ee8f14f51cdb6c01d533b5041a5196f2e10cc41a03eaa45193fd7b61531afd.jpg",
        "image_caption": [
            "Figure 263. LSB justified 16-bit extended to 32-bit packet frame with $\\mathsf { C P O L } = \\mathsf { 0 }$ "
        ],
        "image_footnote": [],
        "bbox": [
            236,
            514,
            885,
            657
        ],
        "page_idx": 30
    },
    {
        "type": "text",
        "text": "When 16-bit data frame extended to 32-bit channel frame is selected during the I2S configuration phase, Only one access to SPI_DR is required. The 16 remaining bits are forced by hardware to $0 \\times 0 0 0 0$ to extend the data to 32-bit format. In this case it corresponds to the half-word MSB. ",
        "bbox": [
            205,
            665,
            885,
            722
        ],
        "page_idx": 30
    },
    {
        "type": "text",
        "text": "If the data to transmit or the received data are 0x76A3 (0x0000 76A3 extended to 32-bit), the operation shown in Figure 264 is required. ",
        "bbox": [
            201,
            729,
            870,
            758
        ],
        "page_idx": 30
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 30
    },
    {
        "type": "discarded",
        "text": "729/1136 ",
        "bbox": [
            823,
            882,
            887,
            894
        ],
        "page_idx": 30
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            70,
            885,
            83
        ],
        "page_idx": 30
    },
    {
        "type": "discarded",
        "text": "5 ",
        "bbox": [
            117,
            874,
            164,
            893
        ],
        "page_idx": 30
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            70,
            174,
            81
        ],
        "page_idx": 30
    },
    {
        "type": "image",
        "img_path": "images/7022dce13d3a701b3139664c5c96787bd401129a035912a9cb273058dc7156c8.jpg",
        "image_caption": [
            "Figure 264. Example of LSB justified 16-bit extended to 32-bit packet frame "
        ],
        "image_footnote": [],
        "bbox": [
            205,
            123,
            885,
            219
        ],
        "page_idx": 31
    },
    {
        "type": "text",
        "text": "In transmission mode, when TXE is asserted, the application has to write the data to be transmitted (in this case 0x76A3). The $0 \\times 0 0 0$ field is transmitted first (extension on 32-bit). TXE is asserted again as soon as the effective data (0x76A3) is sent on SD. ",
        "bbox": [
            205,
            224,
            878,
            267
        ],
        "page_idx": 31
    },
    {
        "type": "text",
        "text": "In reception mode, RXNE is asserted as soon as the significant half-word is received (and not the $0 \\times 0 0 0 0$ field). ",
        "bbox": [
            205,
            274,
            877,
            302
        ],
        "page_idx": 31
    },
    {
        "type": "text",
        "text": "In this way, more time is provided between two write or read operations to prevent underrun or overrun conditions. ",
        "bbox": [
            203,
            309,
            884,
            338
        ],
        "page_idx": 31
    },
    {
        "type": "text",
        "text": "PCM standard ",
        "text_level": 1,
        "bbox": [
            205,
            350,
            332,
            365
        ],
        "page_idx": 31
    },
    {
        "type": "text",
        "text": "For the PCM standard, there is no need to use channel-side information. The two PCM modes (short and long frame) are available and configurable using the PCMSYNC bit in SPI_I2SCFGR. ",
        "bbox": [
            205,
            374,
            862,
            416
        ],
        "page_idx": 31
    },
    {
        "type": "image",
        "img_path": "images/51760954c0db6088e6d0520736157bf8fb38c76fe0f4431b87243decf7180f41.jpg",
        "image_caption": [
            "Figure 265. PCM standard waveforms (16-bit) "
        ],
        "image_footnote": [],
        "bbox": [
            223,
            450,
            862,
            619
        ],
        "page_idx": 31
    },
    {
        "type": "text",
        "text": "",
        "bbox": [
            820,
            605,
            877,
            616
        ],
        "page_idx": 31
    },
    {
        "type": "text",
        "text": "For long frame synchronization, the WS signal assertion time is fixed 13 bits in master mode. ",
        "bbox": [
            203,
            627,
            847,
            655
        ],
        "page_idx": 31
    },
    {
        "type": "text",
        "text": "For short frame synchronization, the WS synchronization signal is only one cycle long. ",
        "bbox": [
            205,
            662,
            847,
            678
        ],
        "page_idx": 31
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 31
    },
    {
        "type": "discarded",
        "text": "730/1136 ",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 31
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            109,
            70,
            363,
            83
        ],
        "page_idx": 31
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            821,
            70,
            887,
            81
        ],
        "page_idx": 31
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            833,
            874,
            880,
            893
        ],
        "page_idx": 31
    },
    {
        "type": "image",
        "img_path": "images/61fd45812275c86f428cd6b343918c3bdb57f1fc74cc15f342c1d7126d02eaf1.jpg",
        "image_caption": [
            "Figure 266. PCM standard waveforms (16-bit extended to 32-bit packet frame) "
        ],
        "image_footnote": [],
        "bbox": [
            252,
            127,
            744,
            295
        ],
        "page_idx": 32
    },
    {
        "type": "text",
        "text": "MS30107V1 ",
        "bbox": [
            818,
            281,
            877,
            293
        ],
        "page_idx": 32
    },
    {
        "type": "text",
        "text": "Note: ",
        "bbox": [
            109,
            304,
            152,
            317
        ],
        "page_idx": 32
    },
    {
        "type": "text",
        "text": "For both modes (master and slave) and for both synchronizations (short and long), the number of bits between two consecutive pieces of data (and so two synchronization signals) needs to be specified (DATLEN and CHLEN bits in the SPI_I2SCFGR register) even in slave mode. ",
        "bbox": [
            205,
            302,
            884,
            361
        ],
        "page_idx": 32
    },
    {
        "type": "text",
        "text": "25.4.3 Clock generator ",
        "text_level": 1,
        "bbox": [
            109,
            376,
            361,
            394
        ],
        "page_idx": 32
    },
    {
        "type": "text",
        "text": "The ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ bitrate determines the dataflow on the $^ { 1 2 } \\mathsf { S }$ data line and the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ clock signal frequency. ",
        "bbox": [
            206,
            400,
            831,
            431
        ],
        "page_idx": 32
    },
    {
        "type": "text",
        "text": "$^ { 1 2 } \\mathsf { S }$ bitrate $=$ number of bits per channel $\\times$ number of channels $\\times$ sampling audio frequency ",
        "bbox": [
            203,
            437,
            880,
            452
        ],
        "page_idx": 32
    },
    {
        "type": "text",
        "text": "For a 16-bit audio, left and right channel, the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ bitrate is calculated as follows: ",
        "bbox": [
            208,
            458,
            805,
            473
        ],
        "page_idx": 32
    },
    {
        "type": "equation",
        "img_path": "images/822fe6c29aae70fcf7d4fbde83ee1eabd7c11c4adfdfca9db91a85b1a80cbd8c.jpg",
        "text": "$$\n| ^ { 2 } \\mathsf { S \\ b i t r a t e } = 1 6 \\times 2 \\times \\mathsf { F } _ { \\mathsf { S } }\n$$",
        "text_format": "latex",
        "bbox": [
            238,
            476,
            425,
            492
        ],
        "page_idx": 32
    },
    {
        "type": "text",
        "text": "It will be: ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ bitrate $= 3 2 \\times 2 \\times \\mathsf { F } _ { \\mathsf { S } }$ if the packet length is 32-bit wide. ",
        "bbox": [
            205,
            497,
            707,
            514
        ],
        "page_idx": 32
    },
    {
        "type": "image",
        "img_path": "images/e76ba5b041b4939f68decaa63501c2b46009842271fae3ed6de00c26a85e168f.jpg",
        "image_caption": [
            "Figure 267. Audio sampling frequency definition "
        ],
        "image_footnote": [],
        "bbox": [
            206,
            543,
            885,
            684
        ],
        "page_idx": 32
    },
    {
        "type": "text",
        "text": "When the master mode is configured, a specific action needs to be taken to properly program the linear divider in order to communicate with the desired audio frequency. ",
        "bbox": [
            205,
            691,
            835,
            720
        ],
        "page_idx": 32
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 32
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            70,
            887,
            83
        ],
        "page_idx": 32
    },
    {
        "type": "discarded",
        "text": "731/1136 ",
        "bbox": [
            823,
            882,
            887,
            894
        ],
        "page_idx": 32
    },
    {
        "type": "discarded",
        "text": "5 ",
        "bbox": [
            117,
            874,
            164,
            893
        ],
        "page_idx": 32
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            68,
            176,
            81
        ],
        "page_idx": 32
    },
    {
        "type": "image",
        "img_path": "images/660a0bcc46ee8b92492da3953f1cb7c0d2c8c3d1ba9c9b312a4090d030a587dd.jpg",
        "image_caption": [
            "Figure 268. I2S clock generator architecture "
        ],
        "image_footnote": [],
        "bbox": [
            208,
            124,
            878,
            356
        ],
        "page_idx": 33
    },
    {
        "type": "text",
        "text": "1. Where x could be 2 or 3. ",
        "text_level": 1,
        "bbox": [
            205,
            362,
            378,
            374
        ],
        "page_idx": 33
    },
    {
        "type": "text",
        "text": "Figure 267 presents the communication clock architecture. . The I2SxCLK source is the system clock (provided by the HSI, the HSE or the PLL, and sourcing the AHB clock). For connectivity line devices, tThe I2SxCLK source can be either SYSCLK or the PLL3 VCO $( 2 \\times \\mathsf { P L L 3 C L K } )$ clock in order to achieve the maximum accuracy. This selection is made using the I2S2SRC and I2S3SRC bits in the RCC_CFGR2 register. ",
        "bbox": [
            205,
            377,
            870,
            450
        ],
        "page_idx": 33
    },
    {
        "type": "text",
        "text": "The audio sampling frequency can be 96 kHz, 48 kHz, 44.1 kHz, 32 kHz, 22.05 kHz, $1 6 k H z$ , 11.025 kHz or $8 \\mathsf { k H z }$ (or any other value within this range). In order to reach the desired frequency, the linear divider needs to be programmed according to the formulas below: ",
        "bbox": [
            205,
            456,
            863,
            514
        ],
        "page_idx": 33
    },
    {
        "type": "text",
        "text": "When the master clock is generated (MCKOE in the SPI_I2SPR register is set): ",
        "bbox": [
            205,
            520,
            798,
            536
        ],
        "page_idx": 33
    },
    {
        "type": "text",
        "text": "$\\mathsf { F } _ { \\mathbb { S } } = \\mathsf { | 2 S x C L K / \\left[ ( 1 6 ^ { \\star } 2 ) ^ { \\star } ( ( 2 ^ { \\star } 1 2 \\mathrm { S D } \\mathsf { I V } ) + O D D ) ^ { \\star } 8 ) \\right] }$ when the channel frame is 16-bit wide $\\mathsf { F } _ { \\mathbb { S } } = \\mathsf { I 2 S x C L K } / \\left[ ( 3 2 ^ { \\star } 2 ) ^ { \\star } ( ( 2 ^ { \\star } \\mathsf { I 2 S D I V } ) + \\mathrm { O D D } ) ^ { \\star } 4 ) \\right]$ when the channel frame is 32-bit wide ",
        "bbox": [
            231,
            538,
            872,
            572
        ],
        "page_idx": 33
    },
    {
        "type": "text",
        "text": "When the master clock is disabled (MCKOE bit cleared): ",
        "bbox": [
            205,
            577,
            626,
            592
        ],
        "page_idx": 33
    },
    {
        "type": "text",
        "text": "$\\mathsf { F } _ { \\mathsf { S } } = | 2 \\mathsf { S } \\times \\mathsf { C } \\mathsf { L } \\mathsf { K } / \\left[ ( 1 6 ^ { \\star } 2 ) ^ { \\star } ( ( 2 ^ { \\star } | 2 \\mathsf { S } \\mathsf { D } | \\mathsf { V } ) + \\mathsf { O } \\mathsf { D } \\mathsf { D } ) ) \\right]$ when the channel frame is 16-bit wide $\\mathsf { F } _ { \\mathsf { S } } = | 2 \\mathsf { S } \\times \\mathsf { C } \\mathsf { L } \\mathsf { K } / [ ( 3 2 ^ { \\star } 2 ) ^ { \\star } ( ( 2 ^ { \\star } | 2 \\mathsf { S } \\mathsf { D } | \\mathsf { V } ) + \\mathsf { O } \\mathsf { D } \\mathsf { D } ) ) ]$ when the channel frame is 32-bit wide ",
        "bbox": [
            235,
            595,
            858,
            629
        ],
        "page_idx": 33
    },
    {
        "type": "text",
        "text": "Table 183, Table 184 and Table 185 provide example precision values for different clock configurations. ",
        "bbox": [
            205,
            634,
            862,
            665
        ],
        "page_idx": 33
    },
    {
        "type": "text",
        "text": "Note: ",
        "bbox": [
            109,
            671,
            152,
            685
        ],
        "page_idx": 33
    },
    {
        "type": "text",
        "text": "Other configurations are possible that allow optimum clock precision. ",
        "bbox": [
            124,
            669,
            719,
            686
        ],
        "page_idx": 33
    },
    {
        "type": "table",
        "img_path": "images/81f0b3155db7bda1fbfc084080c4f8eef6f5d08e20f1e6887bc559234928e399.jpg",
        "table_caption": [
            "Table 183. Audio-frequency precision using standard 8 MHz HSE (high- density and XL-density devices only) "
        ],
        "table_footnote": [],
        "table_body": "<table><tr><td rowspan=2 colspan=1>SYSCLK(MHz)</td><td rowspan=1 colspan=2>I2S_DIV</td><td rowspan=1 colspan=2>I2S_ODD</td><td rowspan=2 colspan=1>MCLK</td><td rowspan=2 colspan=1>Target fs(Hz)</td><td rowspan=1 colspan=2>Real fs (KHz)</td><td rowspan=1 colspan=2>Error</td></tr><tr><td rowspan=1 colspan=1>16-bit</td><td rowspan=1 colspan=1>32-bit</td><td rowspan=1 colspan=1>16-bit</td><td rowspan=1 colspan=1>32-bit</td><td rowspan=1 colspan=1>16-bit</td><td rowspan=1 colspan=1>32-bit</td><td rowspan=1 colspan=1>16-bit</td><td rowspan=1 colspan=1>32-bit</td></tr><tr><td rowspan=1 colspan=1>72</td><td rowspan=1 colspan=1>11</td><td rowspan=1 colspan=1>6</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>96000</td><td rowspan=1 colspan=1>97826.09</td><td rowspan=1 colspan=1>93750</td><td rowspan=1 colspan=1>1.90%</td><td rowspan=1 colspan=1>2.34%</td></tr><tr><td rowspan=1 colspan=1>72</td><td rowspan=1 colspan=1>23</td><td rowspan=1 colspan=1>11</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>48000</td><td rowspan=1 colspan=1>47872.34</td><td rowspan=1 colspan=1>48913.04</td><td rowspan=1 colspan=1>0.27%</td><td rowspan=1 colspan=1>1.90%</td></tr><tr><td rowspan=1 colspan=1>72</td><td rowspan=1 colspan=1>25</td><td rowspan=1 colspan=1>13</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>44100</td><td rowspan=1 colspan=1>44117.65</td><td rowspan=1 colspan=1>43269.23</td><td rowspan=1 colspan=1>0.04%</td><td rowspan=1 colspan=1>1.88%</td></tr></table>",
        "bbox": [
            110,
            729,
            887,
            842
        ],
        "page_idx": 33
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            833,
            874,
            880,
            894
        ],
        "page_idx": 33
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 33
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            109,
            70,
            363,
            81
        ],
        "page_idx": 33
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            821,
            70,
            885,
            80
        ],
        "page_idx": 33
    },
    {
        "type": "discarded",
        "text": "732/1136",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 33
    },
    {
        "type": "table",
        "img_path": "images/f6a55cb604cf9eb46e6f8f51b8420d89694eee9b4f3d6998cba0a942128c1ebc.jpg",
        "table_caption": [
            "Table 183. Audio-frequency precision using standard 8 MHz HSE (high- density and XL-density devices only) (continued) "
        ],
        "table_footnote": [],
        "table_body": "<table><tr><td rowspan=2 colspan=1>SYSCLK(MHz)</td><td rowspan=1 colspan=2>I2S_DIV</td><td rowspan=1 colspan=2>I2S_ODD</td><td rowspan=2 colspan=1>MCLK</td><td rowspan=2 colspan=1>Target fs(Hz)</td><td rowspan=1 colspan=2>Real fs (KHz)</td><td rowspan=1 colspan=2>Error</td></tr><tr><td rowspan=1 colspan=1>16-bit</td><td rowspan=1 colspan=1>32-bit</td><td rowspan=1 colspan=1>16-bit</td><td rowspan=1 colspan=1>32-bit</td><td rowspan=1 colspan=1>16-bit</td><td rowspan=1 colspan=1>32-bit</td><td rowspan=1 colspan=1>16-bit</td><td rowspan=1 colspan=1>32-bit</td></tr><tr><td rowspan=1 colspan=1>72</td><td rowspan=1 colspan=1>35</td><td rowspan=1 colspan=1>17</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>32000</td><td rowspan=1 colspan=1>32142.86</td><td rowspan=1 colspan=1>32142.86</td><td rowspan=1 colspan=1>0.44%</td><td rowspan=1 colspan=1>0.44%</td></tr><tr><td rowspan=1 colspan=1>72</td><td rowspan=1 colspan=1>51</td><td rowspan=1 colspan=1>25</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>22050</td><td rowspan=1 colspan=1>22058.82</td><td rowspan=1 colspan=1>22058.82</td><td rowspan=1 colspan=1>0.04%</td><td rowspan=1 colspan=1>0.04%</td></tr><tr><td rowspan=1 colspan=1>72</td><td rowspan=1 colspan=1>70</td><td rowspan=1 colspan=1>35</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>16000</td><td rowspan=1 colspan=1>15675.75</td><td rowspan=1 colspan=1>16071.43</td><td rowspan=1 colspan=1>0.27%</td><td rowspan=1 colspan=1>0.45%</td></tr><tr><td rowspan=1 colspan=1>72</td><td rowspan=1 colspan=1>102</td><td rowspan=1 colspan=1>51</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>11025</td><td rowspan=1 colspan=1>11029.41</td><td rowspan=1 colspan=1>11029.41</td><td rowspan=1 colspan=1>0.04%</td><td rowspan=1 colspan=1>0.04%</td></tr><tr><td rowspan=1 colspan=1>72</td><td rowspan=1 colspan=1>140</td><td rowspan=1 colspan=1>70</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>8000</td><td rowspan=1 colspan=1>8007.11</td><td rowspan=1 colspan=1>7978.72</td><td rowspan=1 colspan=1>0.09%</td><td rowspan=1 colspan=1>0.27%</td></tr><tr><td rowspan=1 colspan=1>72</td><td rowspan=1 colspan=1>2</td><td rowspan=1 colspan=1>2</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>96000</td><td rowspan=1 colspan=1>70312.15</td><td rowspan=1 colspan=1>70312.15</td><td rowspan=1 colspan=1>26.76%</td><td rowspan=1 colspan=1>26.76%</td></tr><tr><td rowspan=1 colspan=1>72</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>48000</td><td rowspan=1 colspan=1>46875</td><td rowspan=1 colspan=1>46875</td><td rowspan=1 colspan=1>2.34%</td><td rowspan=1 colspan=1>2.34%</td></tr><tr><td rowspan=1 colspan=1>72</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>44100</td><td rowspan=1 colspan=1>46875</td><td rowspan=1 colspan=1>46875</td><td rowspan=1 colspan=1>6.29%</td><td rowspan=1 colspan=1>6.29%</td></tr><tr><td rowspan=1 colspan=1>72</td><td rowspan=1 colspan=1>4</td><td rowspan=1 colspan=1>4</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>32000</td><td rowspan=1 colspan=1>31250</td><td rowspan=1 colspan=1>31250</td><td rowspan=1 colspan=1>2.34%</td><td rowspan=1 colspan=1>2.34%</td></tr><tr><td rowspan=1 colspan=1>72</td><td rowspan=1 colspan=1>6</td><td rowspan=1 colspan=1>6</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>22050</td><td rowspan=1 colspan=1>21634.61</td><td rowspan=1 colspan=1>21634.61</td><td rowspan=1 colspan=1>1.88%</td><td rowspan=1 colspan=1>1.88%</td></tr><tr><td rowspan=1 colspan=1>72</td><td rowspan=1 colspan=1>9</td><td rowspan=1 colspan=1>9</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>16000</td><td rowspan=1 colspan=1>15625</td><td rowspan=1 colspan=1>15625</td><td rowspan=1 colspan=1>2.34%</td><td rowspan=1 colspan=1>2.34%</td></tr><tr><td rowspan=1 colspan=1>72</td><td rowspan=1 colspan=1>13</td><td rowspan=1 colspan=1>13</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>11025</td><td rowspan=1 colspan=1>10817.30</td><td rowspan=1 colspan=1>10817.30</td><td rowspan=1 colspan=1>1.88%</td><td rowspan=1 colspan=1>1.88%</td></tr><tr><td rowspan=1 colspan=1>72</td><td rowspan=1 colspan=1>17</td><td rowspan=1 colspan=1>17</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>8000</td><td rowspan=1 colspan=1>8035.71</td><td rowspan=1 colspan=1>8035.71</td><td rowspan=1 colspan=1>0.45%</td><td rowspan=1 colspan=1>0.45%</td></tr></table>",
        "bbox": [
            109,
            135,
            887,
            450
        ],
        "page_idx": 34
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            70,
            887,
            83
        ],
        "page_idx": 34
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 34
    },
    {
        "type": "discarded",
        "text": "733/1136 ",
        "bbox": [
            823,
            882,
            887,
            894
        ],
        "page_idx": 34
    },
    {
        "type": "discarded",
        "text": "5 ",
        "bbox": [
            117,
            874,
            164,
            893
        ],
        "page_idx": 34
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            68,
            174,
            81
        ],
        "page_idx": 34
    },
    {
        "type": "table",
        "img_path": "images/76db69f6eabfe9ce235d1776ae88ab08b2804691ff071c3558f428796bfec56c.jpg",
        "table_caption": [
            "Table 184. Audio-frequency precision using standard 25 MHz and PLL3 (connectivity line devices only) "
        ],
        "table_footnote": [],
        "table_body": "<table><tr><td rowspan=1 colspan=9>(eonniectvny ne devees ony)</td></tr><tr><td rowspan=1 colspan=1>Datalength</td><td rowspan=1 colspan=1>PREDIV2</td><td rowspan=1 colspan=1>PLL3MUL</td><td rowspan=1 colspan=1>I2SDIV</td><td rowspan=1 colspan=1>I2SODD</td><td rowspan=1 colspan=1>MCLK</td><td rowspan=1 colspan=1>Targetfs(Hz)</td><td rowspan=1 colspan=1>Real fs(KHz)</td><td rowspan=1 colspan=1>Error</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>6</td><td rowspan=1 colspan=1>14</td><td rowspan=1 colspan=1>9</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>96000</td><td rowspan=1 colspan=1>95942.9825</td><td rowspan=1 colspan=1>0.0594%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>6</td><td rowspan=1 colspan=1>14</td><td rowspan=1 colspan=1>38</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>48000</td><td rowspan=1 colspan=1>47971.4912</td><td rowspan=1 colspan=1>0.0594%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>6</td><td rowspan=1 colspan=1>14</td><td rowspan=1 colspan=1>19</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>48000</td><td rowspan=1 colspan=1>47971.4912</td><td rowspan=1 colspan=1>0.0594%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>8</td><td rowspan=1 colspan=1>14</td><td rowspan=1 colspan=1>31</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>44100</td><td rowspan=1 colspan=1>44102.823</td><td rowspan=1 colspan=1>0.0064%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>8</td><td rowspan=1 colspan=1>14</td><td rowspan=1 colspan=1>15</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>44100</td><td rowspan=1 colspan=1>44102.823</td><td rowspan=1 colspan=1>0.0064%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>5</td><td rowspan=1 colspan=1>13</td><td rowspan=1 colspan=1>63</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>32000</td><td rowspan=1 colspan=1>31988.189</td><td rowspan=1 colspan=1>0.0369%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>8</td><td rowspan=1 colspan=1>20</td><td rowspan=1 colspan=1>30</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>32000</td><td rowspan=1 colspan=1>32018.443</td><td rowspan=1 colspan=1>0.0576%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>8</td><td rowspan=1 colspan=1>14</td><td rowspan=1 colspan=1>62</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>22050</td><td rowspan=1 colspan=1>22051.4113</td><td rowspan=1 colspan=1>0.0064%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>8</td><td rowspan=1 colspan=1>14</td><td rowspan=1 colspan=1>31</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>22050</td><td rowspan=1 colspan=1>22051.4113</td><td rowspan=1 colspan=1>0.0064%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>7</td><td rowspan=1 colspan=1>20</td><td rowspan=1 colspan=1>139</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>16000</td><td rowspan=1 colspan=1>16001.0241</td><td rowspan=1 colspan=1>0.0064%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>5</td><td rowspan=1 colspan=1>13</td><td rowspan=1 colspan=1>63</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>16000</td><td rowspan=1 colspan=1>15994.0945</td><td rowspan=1 colspan=1>0.0369%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>8</td><td rowspan=1 colspan=1>14</td><td rowspan=1 colspan=1>124</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>11025</td><td rowspan=1 colspan=1>11025.7056</td><td rowspan=1 colspan=1>0.0064%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>8</td><td rowspan=1 colspan=1>14</td><td rowspan=1 colspan=1>62</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>11025</td><td rowspan=1 colspan=1>11025.7056</td><td rowspan=1 colspan=1>0.0064%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>7</td><td rowspan=1 colspan=1>10</td><td rowspan=1 colspan=1>139</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>8000</td><td rowspan=1 colspan=1>8000.51203</td><td rowspan=1 colspan=1>0.0064%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>7</td><td rowspan=1 colspan=1>20</td><td rowspan=1 colspan=1>139</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>8000</td><td rowspan=1 colspan=1>8000.51203</td><td rowspan=1 colspan=1>0.0064%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>5</td><td rowspan=1 colspan=1>10</td><td rowspan=1 colspan=1>2</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>96000</td><td rowspan=1 colspan=1>97656.25</td><td rowspan=1 colspan=1>1.7253%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>5</td><td rowspan=1 colspan=1>10</td><td rowspan=1 colspan=1>2</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>96000</td><td rowspan=1 colspan=1>97656.25</td><td rowspan=1 colspan=1>1.7253%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>7</td><td rowspan=1 colspan=1>12</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>48000</td><td rowspan=1 colspan=1>47831.6327</td><td rowspan=1 colspan=1>0.3508%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>7</td><td rowspan=1 colspan=1>12</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>48000</td><td rowspan=1 colspan=1>47831.6327</td><td rowspan=1 colspan=1>0.3508%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>5</td><td rowspan=1 colspan=1>9</td><td rowspan=1 colspan=1>4</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>44100</td><td rowspan=1 colspan=1>43945.3125</td><td rowspan=1 colspan=1>0.3508%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>5</td><td rowspan=1 colspan=1>9</td><td rowspan=1 colspan=1>4</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>44100</td><td rowspan=1 colspan=1>43945.3125</td><td rowspan=1 colspan=1>0.3508%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>5</td><td rowspan=1 colspan=1>9</td><td rowspan=1 colspan=1>5</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>32000</td><td rowspan=1 colspan=1>31960.2273</td><td rowspan=1 colspan=1>0.1243%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>5</td><td rowspan=1 colspan=1>9</td><td rowspan=1 colspan=1>5</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>32000</td><td rowspan=1 colspan=1>31960.2273</td><td rowspan=1 colspan=1>0.1243%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>5</td><td rowspan=1 colspan=1>13</td><td rowspan=1 colspan=1>11</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>22050</td><td rowspan=1 colspan=1>22078.8043</td><td rowspan=1 colspan=1>0.1306%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>5</td><td rowspan=1 colspan=1>13</td><td rowspan=1 colspan=1>11</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>22050</td><td rowspan=1 colspan=1>22078.8043</td><td rowspan=1 colspan=1>0.1306%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>5</td><td rowspan=1 colspan=1>9</td><td rowspan=1 colspan=1>11</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>16000</td><td rowspan=1 colspan=1>15980.1136</td><td rowspan=1 colspan=1>0.1243%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>5</td><td rowspan=1 colspan=1>9</td><td rowspan=1 colspan=1>11</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>16000</td><td rowspan=1 colspan=1>15980.1136</td><td rowspan=1 colspan=1>0.1243%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>8</td><td rowspan=1 colspan=1>14</td><td rowspan=1 colspan=1>15</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>11025</td><td rowspan=1 colspan=1>11025.7056</td><td rowspan=1 colspan=1>0.0064%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>8</td><td rowspan=1 colspan=1>14</td><td rowspan=1 colspan=1>15</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>11025</td><td rowspan=1 colspan=1>11025.7056</td><td rowspan=1 colspan=1>0.0064%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>8</td><td rowspan=1 colspan=1>20</td><td rowspan=1 colspan=1>30</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>8000</td><td rowspan=1 colspan=1>8004.61066</td><td rowspan=1 colspan=1>0.0576%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>8</td><td rowspan=1 colspan=1>20</td><td rowspan=1 colspan=1>30</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>8000</td><td rowspan=1 colspan=1>8004.61066</td><td rowspan=1 colspan=1>0.0576%</td></tr></table>",
        "bbox": [
            205,
            130,
            885,
            805
        ],
        "page_idx": 35
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 35
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            109,
            70,
            363,
            83
        ],
        "page_idx": 35
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            833,
            874,
            880,
            894
        ],
        "page_idx": 35
    },
    {
        "type": "discarded",
        "text": "734/1136 ",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 35
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            821,
            70,
            885,
            81
        ],
        "page_idx": 35
    },
    {
        "type": "table",
        "img_path": "images/2e169da36740542efe204c32976f5b8a29b6bef461a7180abab62e96179d8c56.jpg",
        "table_caption": [
            "Table 185. Audio-frequency precision using standard 14.7456 MHz and PLL3 (connectivity line devices only) "
        ],
        "table_footnote": [],
        "table_body": "<table><tr><td rowspan=1 colspan=1>Datalength</td><td rowspan=1 colspan=1>PREDIV2</td><td rowspan=1 colspan=1>PLL3MUL</td><td rowspan=1 colspan=1>I2SDIV</td><td rowspan=1 colspan=1>I2SODD</td><td rowspan=1 colspan=1>MCLK</td><td rowspan=1 colspan=1>Targetfs(Hz)</td><td rowspan=1 colspan=1>Real fs(KHz)</td><td rowspan=1 colspan=1>Error</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>10</td><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>96000</td><td rowspan=1 colspan=1>96000</td><td rowspan=1 colspan=1>0.0000%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>10</td><td rowspan=1 colspan=1>8</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>96000</td><td rowspan=1 colspan=1>96000</td><td rowspan=1 colspan=1>0.0000%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>10</td><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>48000</td><td rowspan=1 colspan=1>48000</td><td rowspan=1 colspan=1>0.0000%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>10</td><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>48000</td><td rowspan=1 colspan=1>48000</td><td rowspan=1 colspan=1>0.0000%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>4</td><td rowspan=1 colspan=1>9</td><td rowspan=1 colspan=1>23</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>44100</td><td rowspan=1 colspan=1>44119.148</td><td rowspan=1 colspan=1>0.0434%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>4</td><td rowspan=1 colspan=1>13</td><td rowspan=1 colspan=1>17</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>44100</td><td rowspan=1 colspan=1>44047.059</td><td rowspan=1 colspan=1>0.1200%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>10</td><td rowspan=1 colspan=1>48</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>32000</td><td rowspan=1 colspan=1>32000</td><td rowspan=1 colspan=1>0.0000%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>10</td><td rowspan=1 colspan=1>24</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>32000</td><td rowspan=1 colspan=1>32000</td><td rowspan=1 colspan=1>0.0000%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>4</td><td rowspan=1 colspan=1>20</td><td rowspan=1 colspan=1>104</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>22050</td><td rowspan=1 colspan=1>22047.8469</td><td rowspan=1 colspan=1>0.0098%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>4</td><td rowspan=1 colspan=1>9</td><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>22050</td><td rowspan=1 colspan=1>22059.5745</td><td rowspan=1 colspan=1>0.0434%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>10</td><td rowspan=1 colspan=1>96</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>16000</td><td rowspan=1 colspan=1>16000</td><td rowspan=1 colspan=1>0.0000%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>10</td><td rowspan=1 colspan=1>48</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>16000</td><td rowspan=1 colspan=1>16000</td><td rowspan=1 colspan=1>0.0000%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>4</td><td rowspan=1 colspan=1>20</td><td rowspan=1 colspan=1>209</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>11025</td><td rowspan=1 colspan=1>11023.923</td><td rowspan=1 colspan=1>0.0098%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>4</td><td rowspan=1 colspan=1>20</td><td rowspan=1 colspan=1>104</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>11025</td><td rowspan=1 colspan=1>11023.923</td><td rowspan=1 colspan=1>0.0098%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>10</td><td rowspan=1 colspan=1>192</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>8000</td><td rowspan=1 colspan=1>8000</td><td rowspan=1 colspan=1>0.0000%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>10</td><td rowspan=1 colspan=1>96</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>No</td><td rowspan=1 colspan=1>8000</td><td rowspan=1 colspan=1>8000</td><td rowspan=1 colspan=1>0.0000%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>10</td><td rowspan=1 colspan=1>2</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>96000</td><td rowspan=1 colspan=1>96000</td><td rowspan=1 colspan=1>0.0000%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>10</td><td rowspan=1 colspan=1>2</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>96000</td><td rowspan=1 colspan=1>96000</td><td rowspan=1 colspan=1>0.0000%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>10</td><td rowspan=1 colspan=1>4</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>48000</td><td rowspan=1 colspan=1>48000</td><td rowspan=1 colspan=1>0.0000%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>10</td><td rowspan=1 colspan=1>4</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>48000</td><td rowspan=1 colspan=1>48000</td><td rowspan=1 colspan=1>0.0000%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>4</td><td rowspan=1 colspan=1>20</td><td rowspan=1 colspan=1>6</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>44100</td><td rowspan=1 colspan=1>44307.6923</td><td rowspan=1 colspan=1>0.4710%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>4</td><td rowspan=1 colspan=1>20</td><td rowspan=1 colspan=1>6</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>44100</td><td rowspan=1 colspan=1>44307.6923</td><td rowspan=1 colspan=1>0.4710%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>10</td><td rowspan=1 colspan=1>6</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>32000</td><td rowspan=1 colspan=1>32000</td><td rowspan=1 colspan=1>0.0000%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>10</td><td rowspan=1 colspan=1>6</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>32000</td><td rowspan=1 colspan=1>32000</td><td rowspan=1 colspan=1>0.0000%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>4</td><td rowspan=1 colspan=1>13</td><td rowspan=1 colspan=1>8</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>22050</td><td rowspan=1 colspan=1>22023.5294</td><td rowspan=1 colspan=1>0.1200%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>4</td><td rowspan=1 colspan=1>13</td><td rowspan=1 colspan=1>8</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>22050</td><td rowspan=1 colspan=1>22023.5294</td><td rowspan=1 colspan=1>0.1200%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>10</td><td rowspan=1 colspan=1>12</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>16000</td><td rowspan=1 colspan=1>16000</td><td rowspan=1 colspan=1>0.0000%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>10</td><td rowspan=1 colspan=1>12</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>16000</td><td rowspan=1 colspan=1>16000</td><td rowspan=1 colspan=1>0.0000%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>4</td><td rowspan=1 colspan=1>13</td><td rowspan=1 colspan=1>17</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>11025</td><td rowspan=1 colspan=1>11029.7872</td><td rowspan=1 colspan=1>0.0434%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>4</td><td rowspan=1 colspan=1>13</td><td rowspan=1 colspan=1>17</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>11025</td><td rowspan=1 colspan=1>11029.7872</td><td rowspan=1 colspan=1>0.0434%</td></tr><tr><td rowspan=1 colspan=1>16</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>10</td><td rowspan=1 colspan=1>24</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>8000</td><td rowspan=1 colspan=1>8000</td><td rowspan=1 colspan=1>0.0000%</td></tr><tr><td rowspan=1 colspan=1>32</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>10</td><td rowspan=1 colspan=1>24</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>Yes</td><td rowspan=1 colspan=1>8000</td><td rowspan=1 colspan=1>8000</td><td rowspan=1 colspan=1>0.0000%</td></tr></table>",
        "bbox": [
            205,
            130,
            887,
            827
        ],
        "page_idx": 36
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            70,
            887,
            83
        ],
        "page_idx": 36
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 36
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            70,
            174,
            81
        ],
        "page_idx": 36
    },
    {
        "type": "discarded",
        "text": "735/1136 ",
        "bbox": [
            823,
            882,
            887,
            894
        ],
        "page_idx": 36
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            117,
            874,
            164,
            893
        ],
        "page_idx": 36
    },
    {
        "type": "text",
        "text": "25.4.4 I2S master mode ",
        "text_level": 1,
        "bbox": [
            112,
            106,
            366,
            125
        ],
        "page_idx": 37
    },
    {
        "type": "text",
        "text": "The ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ can be configured in master mode for transmission and reception. This means that the serial clock is generated on the CK pin as well as the Word Select signal WS. Master clock (MCK) may be output or not, thanks to the MCKOE bit in the SPI_I2SPR register. ",
        "bbox": [
            206,
            134,
            882,
            176
        ],
        "page_idx": 37
    },
    {
        "type": "text",
        "text": "Procedure ",
        "text_level": 1,
        "bbox": [
            205,
            188,
            299,
            204
        ],
        "page_idx": 37
    },
    {
        "type": "text",
        "text": "1. Select the I2SDIV[7:0] bits in the SPI_I2SPR register to define the serial clock baud rate to reach the proper audio sample frequency. The ODD bit in the SPI_I2SPR register also has to be defined.   \n2. Select the CKPOL bit to define the steady level for the communication clock. Set the MCKOE bit in the SPI_I2SPR register if the master clock MCK needs to be provided to the external DAC/ADC audio component (the I2SDIV and ODD values should be computed depending on the state of the MCK output, for more details refer to Section 25.4.3: Clock generator).   \n3. Set the I2SMOD bit in SPI_I2SCFGR to activate the $^ { 1 2 } \\mathsf { S }$ functionalities and choose the $^ { 1 2 } \\mathsf { S }$ standard through the I2SSTD[1:0] and PCMSYNC bits, the data length through the DATLEN[1:0] bits and the number of bits per channel by configuring the CHLEN bit. Select also the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ master mode and direction (Transmitter or Receiver) through the I2SCFG[1:0] bits in the SPI_I2SCFGR register.   \n4. If needed, select all the potential interruption sources and the DMA capabilities by writing the SPI_CR2 register.   \n5. The I2SE bit in SPI_I2SCFGR register must be set. ",
        "bbox": [
            205,
            212,
            887,
            456
        ],
        "page_idx": 37
    },
    {
        "type": "text",
        "text": "WS and CK are configured in output mode. MCK is also an output, if the MCKOE bit in SPI_I2SPR is set. ",
        "bbox": [
            203,
            461,
            850,
            490
        ],
        "page_idx": 37
    },
    {
        "type": "text",
        "text": "Transmission sequence ",
        "text_level": 1,
        "bbox": [
            206,
            502,
            416,
            517
        ],
        "page_idx": 37
    },
    {
        "type": "text",
        "text": "The transmission sequence begins when a half-word is written into the Tx buffer. ",
        "bbox": [
            206,
            526,
            803,
            540
        ],
        "page_idx": 37
    },
    {
        "type": "text",
        "text": "Assumedly, the first data written into the Tx buffer correspond to the channel Left data. When data are transferred from the Tx buffer to the shift register, TXE is set and data corresponding to the channel Right have to be written into the Tx buffer. The CHSIDE flag indicates which channel is to be transmitted. It has a meaning when the TXE flag is set because the CHSIDE flag is updated when TXE goes high. ",
        "bbox": [
            205,
            547,
            873,
            619
        ],
        "page_idx": 37
    },
    {
        "type": "text",
        "text": "A full frame has to be considered as a Left channel data transmission followed by a Right channel data transmission. It is not possible to have a partial frame where only the left channel is sent. ",
        "bbox": [
            206,
            625,
            872,
            668
        ],
        "page_idx": 37
    },
    {
        "type": "text",
        "text": "The data half-word is parallel loaded into the 16-bit shift register during the first bit transmission, and then shifted out, serially, to the MOSI/SD pin, MSB first. The TXE flag is set after each transfer from the Tx buffer to the shift register and an interrupt is generated if the TXEIE bit in the SPI_CR2 register is set. ",
        "bbox": [
            205,
            675,
            884,
            732
        ],
        "page_idx": 37
    },
    {
        "type": "text",
        "text": "For more details about the write operations depending on the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ standard mode selected, refer to Section 25.4.2: Supported audio protocols). ",
        "bbox": [
            201,
            739,
            878,
            769
        ],
        "page_idx": 37
    },
    {
        "type": "text",
        "text": "To ensure a continuous audio data transmission, it is mandatory to write the SPI_DR with the next data to transmit before the end of the current transmission. ",
        "bbox": [
            205,
            776,
            868,
            804
        ],
        "page_idx": 37
    },
    {
        "type": "text",
        "text": "To switch off the $^ { 1 2 } \\mathsf { S }$ , by clearing I2SE, it is mandatory to wait for TXE $= 1$ and ${ \\mathsf { B S Y } } = 0$ ",
        "bbox": [
            205,
            809,
            852,
            826
        ],
        "page_idx": 37
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            821,
            70,
            885,
            81
        ],
        "page_idx": 37
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            110,
            70,
            361,
            83
        ],
        "page_idx": 37
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 37
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            833,
            874,
            880,
            893
        ],
        "page_idx": 37
    },
    {
        "type": "discarded",
        "text": "736/1136 ",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 37
    },
    {
        "type": "text",
        "text": "Reception sequence ",
        "text_level": 1,
        "bbox": [
            205,
            105,
            388,
            121
        ],
        "page_idx": 38
    },
    {
        "type": "text",
        "text": "The operating mode is the same as for the transmission mode except for the point 3 (refer to the procedure described in Section 25.4.4: $r o$ master mode), where the configuration should set the master reception mode through the I2SCFG[1:0] bits. ",
        "bbox": [
            206,
            129,
            885,
            172
        ],
        "page_idx": 38
    },
    {
        "type": "text",
        "text": "Whatever the data or channel length, the audio data are received by 16-bit packets. This means that each time the Rx buffer is full, the RXNE flag is set and an interrupt is generated if the RXNEIE bit is set in SPI_CR2 register. Depending on the data and channel length configuration, the audio value received for a right or left channel may result from one or two receptions into the Rx buffer. ",
        "bbox": [
            205,
            179,
            885,
            250
        ],
        "page_idx": 38
    },
    {
        "type": "text",
        "text": "Clearing the RXNE bit is performed by reading the SPI_DR register. ",
        "bbox": [
            206,
            257,
            710,
            273
        ],
        "page_idx": 38
    },
    {
        "type": "text",
        "text": "CHSIDE is updated after each reception. It is sensitive to the WS signal generated by the $^ { 1 2 } \\mathsf { S }$ cell. ",
        "bbox": [
            201,
            279,
            872,
            307
        ],
        "page_idx": 38
    },
    {
        "type": "text",
        "text": "For more details about the read operations depending on the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ standard mode selected, refer to Section 25.4.2: Supported audio protocols. ",
        "bbox": [
            203,
            313,
            877,
            343
        ],
        "page_idx": 38
    },
    {
        "type": "text",
        "text": "If data are received while the previously received data have not been read yet, an overrun is generated and the OVR flag is set. If the ERRIE bit is set in the SPI_CR2 register, an interrupt is generated to indicate the error. ",
        "bbox": [
            205,
            350,
            882,
            393
        ],
        "page_idx": 38
    },
    {
        "type": "text",
        "text": "To switch off the $^ { 1 2 } \\mathsf { S }$ , specific actions are required to ensure that the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ completes the transfer cycle properly without initiating a new data transfer. The sequence depends on the configuration of the data and channel lengths, and on the audio protocol mode selected. In the case of: ",
        "bbox": [
            205,
            399,
            882,
            457
        ],
        "page_idx": 38
    },
    {
        "type": "text",
        "text": "16-bit data length extended on 32-bit channel length (DATLEN $= 0 0$ and CHLEN $= 1$ )   \nusing the LSB justified mode $( | 2 \\mathsf { S } \\mathsf { S } \\mathsf { T } \\mathsf { D } = 1 0 )$   \na) Wait for the second to last ${ \\mathsf { R X N E } } = 1 \\ ( { \\mathsf { n } } - 1 )$   \nb) Then wait 17 ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ clock cycles (using a software loop)   \nc) Disable the $\\mathsf { I } ^ { 2 } \\mathsf { S } \\left( \\mathsf { I } 2 \\mathsf { S } \\mathsf { E } = 0 \\right)$ ) ",
        "bbox": [
            205,
            460,
            878,
            543
        ],
        "page_idx": 38
    },
    {
        "type": "text",
        "text": "16-bit data length extended on 32-bit channel length (DATLEN $= 0 0$ and $C H L E N = 1 ;$ in MSB justified, $\\mathsf { \\overline { { I } } } ^ { 2 } \\mathsf { S }$ or PCM modes ( $1 2 \\mathrm { S S T D } = 0 0$ , I2SSTD $= 0 1$ or I2SSTD $= 1 1$ , respectively) ",
        "bbox": [
            201,
            546,
            884,
            590
        ],
        "page_idx": 38
    },
    {
        "type": "text",
        "text": "a) Wait for the last RXNE   \nb) Then wait $1 1 ^ { 2 } 5$ clock cycle (using a software loop)   \nc) Disable the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ $( \\mathsf { I 2 S E } = 0 )$ ",
        "bbox": [
            238,
            592,
            655,
            643
        ],
        "page_idx": 38
    },
    {
        "type": "text",
        "text": "For all other combinations of DATLEN and CHLEN, whatever the audio mode selected through the I2SSTD bits, carry out the following sequence to switch off the $^ { 1 2 } \\mathsf { S }$ : ",
        "bbox": [
            200,
            646,
            884,
            675
        ],
        "page_idx": 38
    },
    {
        "type": "text",
        "text": "a) Wait for the second to last ${ \\mathsf { R X N E } } = 1 \\ ( { \\mathsf { n } } - 1 )$ b) Then wait one $^ { 1 2 } \\mathsf { S }$ clock cycle (using a software loop) c) Disable the $^ 2 \\mathsf { S } \\left( | 2 \\mathsf { S } \\mathsf { E } = 0 \\right)$ ) ",
        "bbox": [
            238,
            678,
            673,
            729
        ],
        "page_idx": 38
    },
    {
        "type": "text",
        "text": "Note: ",
        "bbox": [
            109,
            736,
            152,
            749
        ],
        "page_idx": 38
    },
    {
        "type": "text",
        "text": "The BSY flag is kept low during transfers. ",
        "bbox": [
            206,
            735,
            515,
            750
        ],
        "page_idx": 38
    },
    {
        "type": "text",
        "text": "25.4.5 $1 ^ { 2 } S$ slave mode ",
        "text_level": 1,
        "bbox": [
            110,
            767,
            351,
            786
        ],
        "page_idx": 38
    },
    {
        "type": "text",
        "text": "In slave mode, the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ can be configured in transmission or reception mode.The operating mode is following mainly the same rules as described for the $| ^ { 2 } \\mathsf { S }$ master configuration. In slave mode, there is no clock to be generated by the $^ { 1 2 } \\mathsf { S }$ interface. The clock and WS ",
        "bbox": [
            206,
            794,
            877,
            838
        ],
        "page_idx": 38
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            70,
            885,
            83
        ],
        "page_idx": 38
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 38
    },
    {
        "type": "discarded",
        "text": "737/1136 ",
        "bbox": [
            823,
            882,
            887,
            894
        ],
        "page_idx": 38
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            68,
            174,
            81
        ],
        "page_idx": 38
    },
    {
        "type": "discarded",
        "text": "5T ",
        "bbox": [
            117,
            874,
            164,
            894
        ],
        "page_idx": 38
    },
    {
        "type": "text",
        "text": "signals are input from the external master connected to the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ interface. There is then no need, for the user, to configure the clock. ",
        "bbox": [
            201,
            104,
            873,
            134
        ],
        "page_idx": 39
    },
    {
        "type": "text",
        "text": "The configuration steps to follow are listed below: ",
        "bbox": [
            206,
            141,
            573,
            155
        ],
        "page_idx": 39
    },
    {
        "type": "text",
        "text": "1. Set the I2SMOD bit in the SPI_I2SCFGR register to reach the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ functionalities and choose the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ standard through the I2SSTD[1:0] bits, the data length through the DATLEN[1:0] bits and the number of bits per channel for the frame configuring the CHLEN bit. Select also the mode (transmission or reception) for the slave through the I2SCFG[1:0] bits in SPI_I2SCFGR register.   \n2. If needed, select all the potential interrupt sources and the DMA capabilities by writing the SPI_CR2 register.   \n3. The I2SE bit in SPI_I2SCFGR register must be set. ",
        "bbox": [
            200,
            157,
            882,
            280
        ],
        "page_idx": 39
    },
    {
        "type": "text",
        "text": "Transmission sequence ",
        "text_level": 1,
        "bbox": [
            206,
            292,
            416,
            307
        ],
        "page_idx": 39
    },
    {
        "type": "text",
        "text": "The transmission sequence begins when the external master device sends the clock and when the NSS_WS signal requests the transfer of data. The slave has to be enabled before the external master starts the communication. The $^ { 1 2 } \\mathsf { S }$ data register has to be loaded before the master initiates the communication. ",
        "bbox": [
            206,
            315,
            884,
            372
        ],
        "page_idx": 39
    },
    {
        "type": "text",
        "text": "For the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ , MSB justified and LSB justified modes, the first data item to be written into the data register corresponds to the data for the left channel. When the communication starts, the data are transferred from the Tx buffer to the shift register. The TXE flag is then set in order to request the right channel data to be written into the $^ { 1 2 } \\mathsf { S }$ data register. ",
        "bbox": [
            206,
            380,
            877,
            437
        ],
        "page_idx": 39
    },
    {
        "type": "text",
        "text": "The CHSIDE flag indicates which channel is to be transmitted. Compared to the master transmission mode, in slave mode, CHSIDE is sensitive to the WS signal coming from the external master. This means that the slave needs to be ready to transmit the first data before the clock is generated by the master. WS assertion corresponds to left channel transmitted first. ",
        "bbox": [
            206,
            444,
            875,
            515
        ],
        "page_idx": 39
    },
    {
        "type": "text",
        "text": "Note: ",
        "text_level": 1,
        "bbox": [
            110,
            523,
            152,
            536
        ],
        "page_idx": 39
    },
    {
        "type": "text",
        "text": "The I2SE has to be written at least two PCLK cycles before the first clock of the master comes on the CK line. ",
        "bbox": [
            205,
            521,
            855,
            551
        ],
        "page_idx": 39
    },
    {
        "type": "text",
        "text": "The data half-word is parallel-loaded into the 16-bit shift register (from the internal bus) during the first bit transmission, and then shifted out serially to the MOSI/SD pin MSB first. The TXE flag is set after each transfer from the Tx buffer to the shift register and an interrupt is generated if the TXEIE bit in the SPI_CR2 register is set. ",
        "bbox": [
            205,
            558,
            885,
            615
        ],
        "page_idx": 39
    },
    {
        "type": "text",
        "text": "Note that the TXE flag should be checked to be at 1 before attempting to write the Tx buffer. ",
        "bbox": [
            203,
            622,
            884,
            636
        ],
        "page_idx": 39
    },
    {
        "type": "text",
        "text": "For more details about the write operations depending on the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ standard mode selected, refer to Section 25.4.2: Supported audio protocols. ",
        "bbox": [
            205,
            642,
            880,
            672
        ],
        "page_idx": 39
    },
    {
        "type": "text",
        "text": "To secure a continuous audio data transmission, it is mandatory to write the SPI_DR register with the next data to transmit before the end of the current transmission. An underrun flag is set and an interrupt may be generated if the data are not written into the SPI_DR register before the first clock edge of the next data communication. This indicates to the software that the transferred data are wrong. If the ERRIE bit is set into the SPI_CR2 register, an interrupt is generated when the UDR flag in the SPI_SR register goes high. In this case, it is mandatory to switch off the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ and to restart a data transfer starting from the left channel. ",
        "bbox": [
            205,
            679,
            885,
            793
        ],
        "page_idx": 39
    },
    {
        "type": "text",
        "text": "To switch off the $^ { 1 2 } \\mathsf { S }$ , by clearing the I2SE bit, it is mandatory to wait for $\\mathrm { T X E } = 1$ and ${ \\mathsf { B S Y } } = 0$ . ",
        "bbox": [
            203,
            799,
            833,
            828
        ],
        "page_idx": 39
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 39
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            109,
            70,
            361,
            83
        ],
        "page_idx": 39
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            821,
            70,
            885,
            80
        ],
        "page_idx": 39
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            833,
            874,
            880,
            893
        ],
        "page_idx": 39
    },
    {
        "type": "discarded",
        "text": "738/1136 ",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 39
    },
    {
        "type": "text",
        "text": "Reception sequence ",
        "text_level": 1,
        "bbox": [
            205,
            105,
            388,
            121
        ],
        "page_idx": 40
    },
    {
        "type": "text",
        "text": "The operating mode is the same as for the transmission mode except for the point 1 (refer to the procedure described in Section 25.4.5: $r o$ slave mode), where the configuration should set the master reception mode using the I2SCFG[1:0] bits in the SPI_I2SCFGR register. ",
        "bbox": [
            205,
            129,
            885,
            172
        ],
        "page_idx": 40
    },
    {
        "type": "text",
        "text": "Whatever the data length or the channel length, the audio data are received by 16-bit packets. This means that each time the RX buffer is full, the RXNE flag in the SPI_SR register is set and an interrupt is generated if the RXNEIE bit is set in the SPI_CR2 register. Depending on the data length and channel length configuration, the audio value received for a right or left channel may result from one or two receptions into the RX buffer. ",
        "bbox": [
            205,
            179,
            885,
            251
        ],
        "page_idx": 40
    },
    {
        "type": "text",
        "text": "The CHSIDE flag is updated each time data are received to be read from SPI_DR. It is sensitive to the external WS line managed by the external master component. ",
        "bbox": [
            206,
            257,
            852,
            286
        ],
        "page_idx": 40
    },
    {
        "type": "text",
        "text": "Clearing the RXNE bit is performed by reading the SPI_DR register. ",
        "bbox": [
            208,
            293,
            710,
            307
        ],
        "page_idx": 40
    },
    {
        "type": "text",
        "text": "For more details about the read operations depending the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ standard mode selected, refer to Section 25.4.2: Supported audio protocols. ",
        "bbox": [
            201,
            313,
            882,
            343
        ],
        "page_idx": 40
    },
    {
        "type": "text",
        "text": "If data are received while the precedent received data have not yet been read, an overrun is generated and the OVR flag is set. If the bit ERRIE is set in the SPI_CR2 register, an interrupt is generated to indicate the error. ",
        "bbox": [
            205,
            350,
            885,
            393
        ],
        "page_idx": 40
    },
    {
        "type": "text",
        "text": "To switch off the $^ { 1 2 } \\mathsf { S }$ in reception mode, I2SE has to be cleared immediately after receiving the last ${ \\mathsf { R X N E } } = 1$ . ",
        "bbox": [
            203,
            399,
            882,
            428
        ],
        "page_idx": 40
    },
    {
        "type": "text",
        "text": "The external master components should have the capability of sending/receiving data in 16- bit or 32-bit packets via an audio channel. ",
        "bbox": [
            205,
            435,
            887,
            464
        ],
        "page_idx": 40
    },
    {
        "type": "text",
        "text": "25.4.6 Status flags ",
        "text_level": 1,
        "bbox": [
            109,
            480,
            322,
            497
        ],
        "page_idx": 40
    },
    {
        "type": "text",
        "text": "Three status flags are provided for the application to fully monitor the state of the $^ { 1 ^ { 2 } \\mathsf { S } }$ bus. ",
        "bbox": [
            200,
            504,
            870,
            521
        ],
        "page_idx": 40
    },
    {
        "type": "text",
        "text": "Busy flag (BSY) ",
        "text_level": 1,
        "bbox": [
            205,
            530,
            347,
            547
        ],
        "page_idx": 40
    },
    {
        "type": "text",
        "text": "The BSY flag is set and cleared by hardware (writing to this flag has no effect). It indicates the state of the communication layer of the ${ | ^ { 2 } \\dot { \\mathsf { S } } }$ . ",
        "bbox": [
            201,
            555,
            877,
            584
        ],
        "page_idx": 40
    },
    {
        "type": "text",
        "text": "When BSY is set, it indicates that the $^ { 1 ^ { 2 } \\mathsf { S } }$ is busy communicating. There is one exception in master receive mode $( | 2 \\mathsf { S C F G } = 1 1 $ ) where the BSY flag is kept low during reception. ",
        "bbox": [
            200,
            590,
            882,
            621
        ],
        "page_idx": 40
    },
    {
        "type": "text",
        "text": "The BSY flag is useful to detect the end of a transfer if the software needs to disable the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ This avoids corrupting the last transfer. For this, the procedure described below must be strictly respected. ",
        "bbox": [
            206,
            627,
            877,
            669
        ],
        "page_idx": 40
    },
    {
        "type": "text",
        "text": "The BSY flag is set when a transfer starts, except when the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ is in master receiver mode. ",
        "bbox": [
            201,
            675,
            880,
            691
        ],
        "page_idx": 40
    },
    {
        "type": "text",
        "text": "The BSY flag is cleared: ",
        "bbox": [
            205,
            698,
            386,
            713
        ],
        "page_idx": 40
    },
    {
        "type": "text",
        "text": " when a transfer completes (except in master transmit mode, in which the communication is supposed to be continuous) when the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ is disabled ",
        "bbox": [
            205,
            716,
            786,
            762
        ],
        "page_idx": 40
    },
    {
        "type": "text",
        "text": "When communication is continuous: ",
        "bbox": [
            205,
            769,
            477,
            783
        ],
        "page_idx": 40
    },
    {
        "type": "text",
        "text": " In master transmit mode, the BSY flag is kept high during all the transfers  In slave mode, the BSY flag goes low for one $^ { 1 ^ { 2 } \\mathsf { S } }$ clock cycle between each transfer ",
        "bbox": [
            201,
            787,
            880,
            820
        ],
        "page_idx": 40
    },
    {
        "type": "text",
        "text": "Note: ",
        "bbox": [
            109,
            827,
            152,
            840
        ],
        "page_idx": 40
    },
    {
        "type": "text",
        "text": "Do not use the BSY flag to handle each data transmission or reception. It is better to use the TXE and RXNE flags instead. ",
        "bbox": [
            196,
            826,
            884,
            855
        ],
        "page_idx": 40
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            70,
            885,
            83
        ],
        "page_idx": 40
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            68,
            174,
            81
        ],
        "page_idx": 40
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 40
    },
    {
        "type": "discarded",
        "text": "739/1136 ",
        "bbox": [
            823,
            882,
            887,
            894
        ],
        "page_idx": 40
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            117,
            874,
            164,
            894
        ],
        "page_idx": 40
    },
    {
        "type": "discarded",
        "text": "Note: ",
        "bbox": [
            110,
            437,
            152,
            450
        ],
        "page_idx": 40
    },
    {
        "type": "text",
        "text": "Tx buffer empty flag (TXE) ",
        "text_level": 1,
        "bbox": [
            206,
            104,
            438,
            121
        ],
        "page_idx": 41
    },
    {
        "type": "text",
        "text": "When set, this flag indicates that the $\\mathsf { T x }$ buffer is empty and the next data to be transmitted can then be loaded into it. The TXE flag is reset when the Tx buffer already contains data to be transmitted. It is also reset when the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ is disabled (I2SE bit is reset). ",
        "bbox": [
            205,
            129,
            882,
            172
        ],
        "page_idx": 41
    },
    {
        "type": "text",
        "text": "RX buffer not empty (RXNE) ",
        "text_level": 1,
        "bbox": [
            206,
            184,
            453,
            199
        ],
        "page_idx": 41
    },
    {
        "type": "text",
        "text": "When set, this flag indicates that there are valid received data in the RX Buffer. It is reset when SPI_DR register is read. ",
        "bbox": [
            205,
            207,
            867,
            236
        ],
        "page_idx": 41
    },
    {
        "type": "text",
        "text": "Channel Side flag (CHSIDE) ",
        "text_level": 1,
        "bbox": [
            206,
            247,
            452,
            263
        ],
        "page_idx": 41
    },
    {
        "type": "text",
        "text": "In transmission mode, this flag is refreshed when TXE goes high. It indicates the channel side to which the data to transfer on SD has to belong. In case of an underrun error event in slave transmission mode, this flag is not reliable and $\\cdot 2 s$ needs to be switched off and switched on before resuming the communication. ",
        "bbox": [
            206,
            271,
            884,
            328
        ],
        "page_idx": 41
    },
    {
        "type": "text",
        "text": "In reception mode, this flag is refreshed when data are received into SPI_DR. It indicates from which channel side data have been received. Note that in case of error (like OVR) this flag becomes meaningless and the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ should be reset by disabling and then enabling it (with configuration if it needs changing). ",
        "bbox": [
            205,
            334,
            884,
            393
        ],
        "page_idx": 41
    },
    {
        "type": "text",
        "text": "This flag has no meaning in the PCM standard (for both Short and Long frame modes). ",
        "bbox": [
            201,
            399,
            852,
            414
        ],
        "page_idx": 41
    },
    {
        "type": "text",
        "text": "When the OVR or UDR flag in the SPI_SR is set and the ERRIE bit in SPI_CR2 is also set, an interrupt is generated. This interrupt can be cleared by reading the SPI_SR status register (once the interrupt source has been cleared). ",
        "bbox": [
            205,
            420,
            882,
            464
        ],
        "page_idx": 41
    },
    {
        "type": "text",
        "text": "25.4.7 Error flags ",
        "text_level": 1,
        "bbox": [
            110,
            480,
            309,
            497
        ],
        "page_idx": 41
    },
    {
        "type": "text",
        "text": "There are two error flags for the ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ cell. ",
        "bbox": [
            208,
            504,
            505,
            520
        ],
        "page_idx": 41
    },
    {
        "type": "text",
        "text": "Underrun flag (UDR) ",
        "text_level": 1,
        "bbox": [
            206,
            530,
            386,
            547
        ],
        "page_idx": 41
    },
    {
        "type": "text",
        "text": "In slave transmission mode this flag is set when the first clock for data transmission appears while the software has not yet loaded any value into SPI_DR. It is available when the I2SMOD bit in SPI_I2SCFGR is set. An interrupt may be generated if the ERRIE bit in SPI_CR2 is set. ",
        "bbox": [
            205,
            555,
            885,
            611
        ],
        "page_idx": 41
    },
    {
        "type": "text",
        "text": "The UDR bit is cleared by a read operation on the SPI_SR register. ",
        "bbox": [
            206,
            612,
            707,
            627
        ],
        "page_idx": 41
    },
    {
        "type": "text",
        "text": "Overrun flag (OVR) ",
        "text_level": 1,
        "bbox": [
            206,
            638,
            374,
            655
        ],
        "page_idx": 41
    },
    {
        "type": "text",
        "text": "This flag is set when data are received and the previous data have not yet been read from SPI_DR. As a result, the incoming data are lost. An interrupt may be generated if the ERRIE bit is set in SPI_CR2. ",
        "bbox": [
            206,
            662,
            882,
            705
        ],
        "page_idx": 41
    },
    {
        "type": "text",
        "text": "In this case, the receive buffer contents are not updated with the newly received data from the transmitter device. A read operation to the SPI_DR register returns the previous correctly received data. All other subsequently transmitted half-words are lost. ",
        "bbox": [
            206,
            712,
            880,
            755
        ],
        "page_idx": 41
    },
    {
        "type": "text",
        "text": "Clearing the OVR bit is done by a read operation on the SPI_DR register followed by a read access to the SPI_SR register. ",
        "bbox": [
            205,
            762,
            884,
            790
        ],
        "page_idx": 41
    },
    {
        "type": "text",
        "text": "25.4.8 I2S interrupts ",
        "text_level": 1,
        "bbox": [
            110,
            808,
            336,
            827
        ],
        "page_idx": 41
    },
    {
        "type": "text",
        "text": "Table 186 provides the list of $^ { 1 2 } \\mathsf { S }$ interrupts. ",
        "bbox": [
            208,
            834,
            526,
            851
        ],
        "page_idx": 41
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 41
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            821,
            70,
            885,
            81
        ],
        "page_idx": 41
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            109,
            70,
            363,
            83
        ],
        "page_idx": 41
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            833,
            874,
            880,
            893
        ],
        "page_idx": 41
    },
    {
        "type": "discarded",
        "text": "740/1136 ",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 41
    },
    {
        "type": "table",
        "img_path": "images/95708ae096e4f3502bd88f06f26795b95a066b9ed43efd18861d4a6841fb178c.jpg",
        "table_caption": [
            "Table 186. $1 ^ { 2 } \\thinspace \\thinspace \\mathsf { S }$ interrupt requests "
        ],
        "table_footnote": [],
        "table_body": "<table><tr><td rowspan=1 colspan=1>Interrupt event</td><td rowspan=1 colspan=1>Event flag</td><td rowspan=1 colspan=1>Enable Control bit</td></tr><tr><td rowspan=1 colspan=1>Transmit buffer empty flag</td><td rowspan=1 colspan=1>TXE</td><td rowspan=1 colspan=1>TXEIE</td></tr><tr><td rowspan=1 colspan=1>Receive buffer not empty flag</td><td rowspan=1 colspan=1>RXNE</td><td rowspan=1 colspan=1>RXNEIE</td></tr><tr><td rowspan=1 colspan=1>Overrun error</td><td rowspan=1 colspan=1>OVR</td><td rowspan=2 colspan=1>ERRIE</td></tr><tr><td rowspan=1 colspan=1>Underrun error</td><td rowspan=1 colspan=1>UDR</td></tr></table>",
        "bbox": [
            203,
            123,
            887,
            231
        ],
        "page_idx": 42
    },
    {
        "type": "text",
        "text": "25.4.9 DMA features ",
        "text_level": 1,
        "bbox": [
            109,
            249,
            337,
            267
        ],
        "page_idx": 42
    },
    {
        "type": "text",
        "text": "DMA is working in exactly the same way as for the SPI mode. There is no difference on the $^ { 1 2 } \\mathsf { S }$ . Only the CRC feature is not available in $^ { 1 2 } \\mathsf { S }$ mode since there is no data transfer protection system. ",
        "bbox": [
            203,
            275,
            885,
            318
        ],
        "page_idx": 42
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            68,
            887,
            83
        ],
        "page_idx": 42
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 42
    },
    {
        "type": "discarded",
        "text": "741/1136 ",
        "bbox": [
            823,
            882,
            887,
            894
        ],
        "page_idx": 42
    },
    {
        "type": "discarded",
        "text": "5 ",
        "bbox": [
            117,
            874,
            164,
            893
        ],
        "page_idx": 42
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            68,
            176,
            81
        ],
        "page_idx": 42
    },
    {
        "type": "text",
        "text": "25.5 SPI and $1 ^ { 2 } S$ registers ",
        "text_level": 1,
        "bbox": [
            109,
            102,
            440,
            124
        ],
        "page_idx": 43
    },
    {
        "type": "text",
        "text": "The peripheral registers have to be accessed by half-words (16 bits) or words (32 bits). ",
        "bbox": [
            200,
            131,
            852,
            148
        ],
        "page_idx": 43
    },
    {
        "type": "text",
        "text": "25.5.1 SPI control register 1 (SPI_CR1) (not used in I2S mode) ",
        "text_level": 1,
        "bbox": [
            117,
            166,
            734,
            185
        ],
        "page_idx": 43
    },
    {
        "type": "text",
        "text": "Address offset: 0x00 ",
        "bbox": [
            205,
            193,
            361,
            206
        ],
        "page_idx": 43
    },
    {
        "type": "text",
        "text": "Reset value: 0x0000 ",
        "bbox": [
            205,
            214,
            361,
            228
        ],
        "page_idx": 43
    },
    {
        "type": "table",
        "img_path": "images/cbb2c7eaee0260c01376e04da035b934c0dfc2f9e0558cd880c0f10e57bcfbc1.jpg",
        "table_caption": [],
        "table_footnote": [],
        "table_body": "<table><tr><td>15</td><td>14</td><td>13</td><td>12</td><td>11</td><td>10</td><td>9</td><td>8</td><td>7</td><td></td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td></tr><tr><td>BIDI MODE</td><td>BIDI OE</td><td>CRC EN</td><td>CRC NEXT</td><td>DFF</td><td>RX ONLY</td><td>SSM</td><td></td><td>SSI</td><td>LSB FIRST</td><td>SPE</td><td></td><td>BR [2:0]</td><td></td><td>MSTR</td><td>CPOL</td><td>CPHA</td></tr><tr><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td></td><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td>rw</td></tr></table>",
        "bbox": [
            109,
            232,
            887,
            288
        ],
        "page_idx": 43
    },
    {
        "type": "text",
        "text": "Bit 15 BIDIMODE: Bidirectional data mode enable ",
        "bbox": [
            208,
            305,
            549,
            319
        ],
        "page_idx": 43
    },
    {
        "type": "text",
        "text": "0: 2-line unidirectional data mode selected   \n1: 1-line bidirectional data mode selected ",
        "bbox": [
            260,
            321,
            554,
            347
        ],
        "page_idx": 43
    },
    {
        "type": "text",
        "text": "Note: This bit is not used in $I ^ { 2 } S$ mode ",
        "bbox": [
            253,
            350,
            515,
            364
        ],
        "page_idx": 43
    },
    {
        "type": "text",
        "text": "Bit 14 BIDIOE: Output enable in bidirectional mode This bit combined with the BIDImode bit selects the direction of transfer in bidirectional mode 0: Output disabled (receive-only mode) 1: Output enabled (transmit-only mode) ",
        "bbox": [
            206,
            370,
            889,
            428
        ],
        "page_idx": 43
    },
    {
        "type": "text",
        "text": "Note: This bit is not used in $I ^ { 2 } S$ mode. In master mode, the MOSI pin is used while the MISO pin is used in slave mode. ",
        "bbox": [
            250,
            429,
            843,
            459
        ],
        "page_idx": 43
    },
    {
        "type": "text",
        "text": "Bit 13 CRCEN: Hardware CRC calculation enable 0: CRC calculation disabled 1: CRC calculation enabled ",
        "bbox": [
            206,
            465,
            547,
            509
        ],
        "page_idx": 43
    },
    {
        "type": "text",
        "text": "Note: This bit should be written only when SPI is disabled $S P E = { \\mathrm { \\cdot } } O$ ) for correct operation. It is not used in $_ { I ^ { 2 } S }$ mode. ",
        "bbox": [
            253,
            510,
            867,
            540
        ],
        "page_idx": 43
    },
    {
        "type": "text",
        "text": "Bit 12 CRCNEXT: CRC transfer next ",
        "bbox": [
            206,
            546,
            458,
            559
        ],
        "page_idx": 43
    },
    {
        "type": "text",
        "text": "0: Data phase (no CRC phase)   \n1: Next transfer is CRC (CRC phase) ",
        "bbox": [
            267,
            562,
            519,
            590
        ],
        "page_idx": 43
    },
    {
        "type": "text",
        "text": "Note: When the SPI is configured in full duplex or transmitter only modes, CRCNEXT must be written as soon as the last data is written to the SPI_DR register. When the SPI is configured in receiver only mode, CRCNEXT must be set after the second last data reception. This bit should be kept cleared when the transfers are managed by DMA. It is not used in $I ^ { 2 } S$ mode. ",
        "bbox": [
            253,
            592,
            884,
            671
        ],
        "page_idx": 43
    },
    {
        "type": "text",
        "text": "Bit 11 DFF: Data frame format ",
        "bbox": [
            208,
            678,
            420,
            691
        ],
        "page_idx": 43
    },
    {
        "type": "text",
        "text": "0: 8-bit data frame format is selected for transmission/reception   \n1: 16-bit data frame format is selected for transmission/reception ",
        "bbox": [
            265,
            693,
            700,
            719
        ],
        "page_idx": 43
    },
    {
        "type": "text",
        "text": "Note: This bit should be written only when SPI is disabled $( S P E = { \\mathrm { \\Omega } } ^ { , } O$ ) for correct operation. It is not used in $I ^ { 2 } S$ mode. ",
        "bbox": [
            253,
            723,
            867,
            751
        ],
        "page_idx": 43
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 43
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            833,
            874,
            880,
            893
        ],
        "page_idx": 43
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            110,
            68,
            363,
            83
        ],
        "page_idx": 43
    },
    {
        "type": "discarded",
        "text": "742/1136 ",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 43
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            820,
            68,
            887,
            81
        ],
        "page_idx": 43
    },
    {
        "type": "text",
        "text": "Bit 10 RXONLY: Receive only ",
        "text_level": 1,
        "bbox": [
            206,
            112,
            413,
            125
        ],
        "page_idx": 44
    },
    {
        "type": "text",
        "text": "This bit combined with the BIDImode bit selects the direction of transfer in 2-line unidirectional mode. This bit is also useful in a multislave system in which this particular slave is not accessed, the output from the accessed slave is not corrupted.   \n0: Full duplex (Transmit and receive)   \n1: Output disabled (Receive-only mode) ",
        "bbox": [
            267,
            128,
            857,
            198
        ],
        "page_idx": 44
    },
    {
        "type": "text",
        "text": "Note: This bit is not used in $I ^ { 2 } S$ mode ",
        "bbox": [
            253,
            198,
            514,
            211
        ],
        "page_idx": 44
    },
    {
        "type": "text",
        "text": "Bit 9 SSM: Software slave management When the SSM bit is set, the NSS pin input is replaced with the value from the SSI bit. 0: Software slave management disabled 1: Software slave management enabled Note: This bit is not used in $I ^ { 2 } S$ mode ",
        "bbox": [
            213,
            218,
            847,
            290
        ],
        "page_idx": 44
    },
    {
        "type": "text",
        "text": "Bit 8 SSI: Internal slave select This bit has an effect only when the SSM bit is set. The value of this bit is forced onto the NSS pin and the IO value of the NSS pin is ignored. Note: This bit is not used in $I ^ { 2 } S$ mode ",
        "bbox": [
            213,
            299,
            862,
            355
        ],
        "page_idx": 44
    },
    {
        "type": "text",
        "text": "Bit 7 LSBFIRST: Frame format 0: MSB transmitted first 1: LSB transmitted first ",
        "bbox": [
            213,
            362,
            431,
            404
        ],
        "page_idx": 44
    },
    {
        "type": "text",
        "text": "Note: This bit should not be changed when communication is ongoing. It is not used in $I ^ { 2 } S$ mode ",
        "bbox": [
            253,
            407,
            732,
            435
        ],
        "page_idx": 44
    },
    {
        "type": "text",
        "text": "Bit 6 SPE: SPI enable 0: Peripheral disabled 1: Peripheral enabled ",
        "bbox": [
            213,
            442,
            418,
            485
        ],
        "page_idx": 44
    },
    {
        "type": "text",
        "text": "Note: This bit is not used in $I ^ { 2 } S$ mode. When disabling the SPI, follow the procedure described in Section 25.3.8. ",
        "bbox": [
            253,
            488,
            796,
            517
        ],
        "page_idx": 44
    },
    {
        "type": "text",
        "text": "Bits 5:3 BR[2:0]: Baud rate control ",
        "bbox": [
            194,
            523,
            435,
            536
        ],
        "page_idx": 44
    },
    {
        "type": "text",
        "text": "000: fPCLK/2   \n001: fPCLK/4   \n010: fPCLK/8   \n011: fPCLK/16   \n100: fPCLK/32   \n101: fPCLK/64   \n110: fPCLK/128   \n111: fPCLK/256 ",
        "bbox": [
            260,
            540,
            374,
            653
        ],
        "page_idx": 44
    },
    {
        "type": "text",
        "text": "Note: These bits should not be changed when communication is ongoing. They are not used in $r ^ { 2 } S$ mode. ",
        "bbox": [
            250,
            655,
            752,
            684
        ],
        "page_idx": 44
    },
    {
        "type": "text",
        "text": "Bit 2 MSTR: Master selection 0: Slave configuration 1: Master configuration ",
        "bbox": [
            213,
            690,
            425,
            733
        ],
        "page_idx": 44
    },
    {
        "type": "text",
        "text": "Note: This bit should not be changed when communication is ongoing. It is not used in $I ^ { 2 } S$ mode. ",
        "bbox": [
            253,
            736,
            732,
            764
        ],
        "page_idx": 44
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            70,
            887,
            83
        ],
        "page_idx": 44
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 44
    },
    {
        "type": "discarded",
        "text": "743/1136 ",
        "bbox": [
            823,
            882,
            887,
            894
        ],
        "page_idx": 44
    },
    {
        "type": "discarded",
        "text": "5 ",
        "bbox": [
            117,
            874,
            164,
            893
        ],
        "page_idx": 44
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            68,
            176,
            81
        ],
        "page_idx": 44
    },
    {
        "type": "text",
        "text": "Bit1 CPOL: Clock polarity 0: CK to 0 when idle 1: CK to 1 when idle ",
        "bbox": [
            216,
            112,
            408,
            155
        ],
        "page_idx": 45
    },
    {
        "type": "text",
        "text": "Note: This bit should not be changed when communication is ongoing. It is not used in $I ^ { 2 } S$ mode ",
        "bbox": [
            252,
            157,
            731,
            187
        ],
        "page_idx": 45
    },
    {
        "type": "text",
        "text": "Bit 0 CPHA: Clock phase 0: The first clock transition is the first data capture edge 1: The second clock transition is the first data capture edge Note: This bit should not be changed when communication is ongoing. It is not used in $I ^ { 2 } S$ mode ",
        "bbox": [
            213,
            193,
            732,
            268
        ],
        "page_idx": 45
    },
    {
        "type": "text",
        "text": "25.5.2 SPI control register 2 (SPI_CR2) ",
        "text_level": 1,
        "bbox": [
            109,
            289,
            515,
            307
        ],
        "page_idx": 45
    },
    {
        "type": "text",
        "text": "Address offset: 0x04 ",
        "bbox": [
            205,
            315,
            361,
            330
        ],
        "page_idx": 45
    },
    {
        "type": "text",
        "text": "Reset value: 0x0000 ",
        "bbox": [
            205,
            337,
            363,
            351
        ],
        "page_idx": 45
    },
    {
        "type": "table",
        "img_path": "images/64f9ad21db775630ffc23e7c6df31447ffed25859d0bde67f2d9686ecd270d55.jpg",
        "table_caption": [],
        "table_footnote": [],
        "table_body": "<table><tr><td>15</td><td>14</td><td>13</td><td>12</td><td>11</td><td>10</td><td>9</td><td>8</td><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td></tr><tr><td rowspan=\"3\"></td><td rowspan=\"3\"></td><td rowspan=\"3\"></td><td rowspan=\"3\">Reserved</td><td rowspan=\"3\"></td><td rowspan=\"3\"></td><td rowspan=\"3\"></td><td rowspan=\"3\"></td><td>TXEIE</td><td>RXNEIE</td><td>ERRIE</td><td>Res.</td><td>Res.</td><td>SSOE</td><td>TXDMAEN</td><td>RXDMAEN</td></tr><tr><td>rw</td><td>rw</td><td>rw</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td>rw</td><td>rw</td><td>rw</td></tr></table>",
        "bbox": [
            110,
            356,
            889,
            412
        ],
        "page_idx": 45
    },
    {
        "type": "text",
        "text": "Bits 15:8 Reserved, must be kept at reset value. ",
        "bbox": [
            186,
            428,
            515,
            442
        ],
        "page_idx": 45
    },
    {
        "type": "text",
        "text": "Bit 7 TXEIE: Tx buffer empty interrupt enable 0: TXE interrupt masked 1: TXE interrupt not masked. Used to generate an interrupt request when the TXE flag is set. ",
        "bbox": [
            215,
            448,
            887,
            492
        ],
        "page_idx": 45
    },
    {
        "type": "text",
        "text": "Bit 6 RXNEIE: RX buffer not empty interrupt enable 0: RXNE interrupt masked 1: RXNE interrupt not masked. Used to generate an interrupt request when the RXNE flag is set. ",
        "bbox": [
            216,
            498,
            882,
            555
        ],
        "page_idx": 45
    },
    {
        "type": "text",
        "text": "Bit 5 ERRIE: Error interrupt enable This bit controls the generation of an interrupt when an error condition occurs (CRCERR, OVR, MODF in SPI mode and UDR, OVR in $^ { 1 ^ { 2 } \\mathsf { S } }$ mode). 0: Error interrupt is masked 1: Error interrupt is enabled ",
        "bbox": [
            215,
            562,
            868,
            631
        ],
        "page_idx": 45
    },
    {
        "type": "text",
        "text": "Bits 4:3 Reserved, must be kept at reset value. ",
        "bbox": [
            198,
            640,
            517,
            653
        ],
        "page_idx": 45
    },
    {
        "type": "text",
        "text": "Bit 2 SSOE: SS output enable 0: SS output is disabled in master mode and the cell can work in multimaster configuration 1: SS output is enabled in master mode and when the cell is enabled. The cell cannot work in a multimaster environment. ",
        "bbox": [
            215,
            660,
            880,
            716
        ],
        "page_idx": 45
    },
    {
        "type": "text",
        "text": "Note: This bit is not used in $\\boldsymbol { I ^ { 2 } S }$ mode ",
        "bbox": [
            255,
            717,
            515,
            731
        ],
        "page_idx": 45
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 45
    },
    {
        "type": "discarded",
        "text": "744/1136 ",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 45
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            833,
            874,
            880,
            893
        ],
        "page_idx": 45
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            109,
            68,
            363,
            83
        ],
        "page_idx": 45
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            820,
            68,
            887,
            81
        ],
        "page_idx": 45
    },
    {
        "type": "text",
        "text": "Bit 1 TXDMAEN: Tx buffer DMA enable When this bit is set, the DMA request is made whenever the TXE flag is set. 0: Tx buffer DMA disabled 1: Tx buffer DMA enabled ",
        "bbox": [
            213,
            112,
            778,
            169
        ],
        "page_idx": 46
    },
    {
        "type": "text",
        "text": "Bit 0 RXDMAEN: Rx buffer DMA enable When this bit is set, the DMA request is made whenever the RXNE flag is set. 0: Rx buffer DMA disabled 1: Rx buffer DMA enabled ",
        "bbox": [
            213,
            176,
            789,
            235
        ],
        "page_idx": 46
    },
    {
        "type": "text",
        "text": "25.5.3 SPI status register (SPI_SR) ",
        "text_level": 1,
        "bbox": [
            109,
            257,
            477,
            275
        ],
        "page_idx": 46
    },
    {
        "type": "text",
        "text": "Address offset: 0x08   \nReset value: 0x0002 ",
        "bbox": [
            201,
            282,
            363,
            318
        ],
        "page_idx": 46
    },
    {
        "type": "table",
        "img_path": "images/baa82cde46c9608b5e7c768d7eb9b3e9cc27c3147c4d1367f91a8e26b4cf3d21.jpg",
        "table_caption": [],
        "table_footnote": [],
        "table_body": "<table><tr><td>15</td><td>14</td><td>13</td><td>12</td><td>11</td><td>10</td><td>9</td><td></td><td>8 7</td><td></td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td></tr><tr><td rowspan=\"2\"></td><td rowspan=\"2\"></td><td rowspan=\"2\"></td><td rowspan=\"2\"></td><td rowspan=\"2\"></td><td rowspan=\"2\"></td><td rowspan=\"2\"></td><td rowspan=\"2\"></td><td rowspan=\"2\"></td><td rowspan=\"2\">OVR</td><td rowspan=\"2\">MODF</td><td rowspan=\"2\">CRC ERR</td><td rowspan=\"2\">UDR</td><td rowspan=\"2\">CHSIDE</td><td rowspan=\"2\"></td><td rowspan=\"2\">TXE</td><td rowspan=\"2\">RXNE</td></tr><tr><td>BSY</td><td></td></tr><tr><td></td><td></td><td></td><td></td><td>Reserved</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>r</td><td></td><td>r</td><td>r</td><td>rc_w0</td><td>r</td><td>r</td><td>r</td><td>r</td></tr></table>",
        "bbox": [
            112,
            323,
            887,
            378
        ],
        "page_idx": 46
    },
    {
        "type": "text",
        "text": "Bits 15:8 Reserved, must be kept at reset value. ",
        "bbox": [
            186,
            395,
            515,
            409
        ],
        "page_idx": 46
    },
    {
        "type": "text",
        "text": "BSY: Busy flag 0: SPI (or I2S) not busy 1: SPI (or I2S) is busy in communication or Tx buffer is not empty This flag is set and cleared by hardware. ",
        "bbox": [
            257,
            418,
            707,
            471
        ],
        "page_idx": 46
    },
    {
        "type": "text",
        "text": "Note: BSY flag must be used with caution: refer to Section 25.3.7 and Section 25.3.8. ",
        "bbox": [
            248,
            472,
            833,
            486
        ],
        "page_idx": 46
    },
    {
        "type": "text",
        "text": "Bit 6 OVR: Overrun flag 0: No overrun occurred 1: Overrun occurred This flag is set by hardware and reset by a software sequence. Refer to Section 25.4.7: Error flags for the software sequence. ",
        "bbox": [
            215,
            494,
            867,
            562
        ],
        "page_idx": 46
    },
    {
        "type": "text",
        "text": "Bit 5 MODF: Mode fault 0: No mode fault occurred 1: Mode fault occurred This flag is set by hardware and reset by a software sequence. Refer to Section 25.4.7: Error flags for the software sequence. ",
        "bbox": [
            215,
            570,
            865,
            637
        ],
        "page_idx": 46
    },
    {
        "type": "text",
        "text": "Note: This bit is not used in $I ^ { 2 } S$ mode ",
        "bbox": [
            253,
            640,
            515,
            653
        ],
        "page_idx": 46
    },
    {
        "type": "text",
        "text": "Bit 4 CRCERR: CRC error flag ",
        "bbox": [
            215,
            661,
            430,
            674
        ],
        "page_idx": 46
    },
    {
        "type": "text",
        "text": "0: CRC value received matches the SPI_RXCRCR value 1: CRC value received does not match the SPI_RXCRCR value This flag is set by hardware and cleared by software writing 0. ",
        "bbox": [
            265,
            676,
            697,
            718
        ],
        "page_idx": 46
    },
    {
        "type": "text",
        "text": "Note: This bit is not used in $I ^ { 2 } S$ mode. ",
        "bbox": [
            255,
            718,
            517,
            732
        ],
        "page_idx": 46
    },
    {
        "type": "text",
        "text": "Bit 3 UDR: Underrun flag 0: No underrun occurred 1: Underrun occurred This flag is set by hardware and reset by a software sequence. Refer to Section 25.4.7: Error flags for the software sequence. ",
        "bbox": [
            215,
            739,
            867,
            809
        ],
        "page_idx": 46
    },
    {
        "type": "text",
        "text": "Note: This bit is not used in SPI mode. ",
        "bbox": [
            255,
            812,
            519,
            825
        ],
        "page_idx": 46
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            68,
            887,
            83
        ],
        "page_idx": 46
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 46
    },
    {
        "type": "discarded",
        "text": "745/1136 ",
        "bbox": [
            823,
            882,
            887,
            894
        ],
        "page_idx": 46
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            68,
            176,
            81
        ],
        "page_idx": 46
    },
    {
        "type": "discarded",
        "text": "5 ",
        "bbox": [
            117,
            874,
            164,
            893
        ],
        "page_idx": 46
    },
    {
        "type": "text",
        "text": "Bit 2 CHSIDE: Channel side ",
        "bbox": [
            215,
            112,
            411,
            125
        ],
        "page_idx": 47
    },
    {
        "type": "text",
        "text": "0: Channel Left has to be transmitted or has been received 1: Channel Right has to be transmitted or has been received Note: This bit is not used for SPI mode and is meaningless in PCM mode. ",
        "bbox": [
            253,
            128,
            757,
            171
        ],
        "page_idx": 47
    },
    {
        "type": "text",
        "text": "Bit 1 TXE: Transmit buffer empty 0: Tx buffer not empty 1: Tx buffer empty ",
        "bbox": [
            213,
            176,
            443,
            219
        ],
        "page_idx": 47
    },
    {
        "type": "text",
        "text": "Bit 0 RXNE: Receive buffer not empty 0: Rx buffer empty 1: Rx buffer not empty ",
        "bbox": [
            213,
            225,
            477,
            268
        ],
        "page_idx": 47
    },
    {
        "type": "text",
        "text": "25.5.4 SPI data register (SPI_DR) ",
        "text_level": 1,
        "bbox": [
            109,
            289,
            460,
            307
        ],
        "page_idx": 47
    },
    {
        "type": "text",
        "text": "Address offset: 0x0C ",
        "bbox": [
            205,
            315,
            364,
            330
        ],
        "page_idx": 47
    },
    {
        "type": "text",
        "text": "Reset value: 0x0000 ",
        "bbox": [
            205,
            337,
            363,
            351
        ],
        "page_idx": 47
    },
    {
        "type": "table",
        "img_path": "images/df247490080da8061f531aaea50daa603f7fc6bdf0acebba0f9a000b93db7d0a.jpg",
        "table_caption": [],
        "table_footnote": [],
        "table_body": "<table><tr><td>15</td><td>14</td><td>13</td><td>12</td><td>11</td><td>10</td><td>9</td><td>8</td><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td></tr><tr><td></td><td></td><td colspan=\"10\">DR[15:0]</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td></td><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td>rw</td></tr></table>",
        "bbox": [
            110,
            369,
            887,
            416
        ],
        "page_idx": 47
    },
    {
        "type": "text",
        "text": "Bits 15:0 DR[15:0]: Data register ",
        "text_level": 1,
        "bbox": [
            186,
            433,
            416,
            447
        ],
        "page_idx": 47
    },
    {
        "type": "text",
        "text": "Data received or to be transmitted. ",
        "bbox": [
            272,
            450,
            504,
            461
        ],
        "page_idx": 47
    },
    {
        "type": "text",
        "text": "The data register is split into 2 buffers - one for writing (Transmit Buffer) and another one for reading (Receive buffer). A write to the data register will write into the Tx buffer and a read from the data register will return the value held in the Rx buffer. ",
        "bbox": [
            267,
            464,
            880,
            502
        ],
        "page_idx": 47
    },
    {
        "type": "text",
        "text": "Note: These notes apply to SPI mode: ",
        "bbox": [
            257,
            505,
            521,
            517
        ],
        "page_idx": 47
    },
    {
        "type": "text",
        "text": "Depending on the data frame format selection bit (DFF in SPI_CR1 register), the data sent or received is either 8-bit or 16-bit. This selection has to be made before enabling the SPI to ensure correct operation. ",
        "bbox": [
            297,
            520,
            878,
            559
        ],
        "page_idx": 47
    },
    {
        "type": "text",
        "text": "For an 8-bit data frame, the buffers are 8-bit and only the LSB of the register (SPI_DR[7:0]) is used for transmission/reception. When in reception mode, the MSB of the register (SPI_DR[15:8]) is forced to 0. ",
        "bbox": [
            302,
            561,
            878,
            600
        ],
        "page_idx": 47
    },
    {
        "type": "text",
        "text": "For a 16-bit data frame, the buffers are 16-bit and the entire register, SPI_DR[15:0] is used for transmission/reception. ",
        "bbox": [
            302,
            603,
            875,
            630
        ],
        "page_idx": 47
    },
    {
        "type": "text",
        "text": "25.5.5 SPI CRC polynomial register (SPI_CRCPR) (not used in I2S mode) ",
        "text_level": 1,
        "bbox": [
            115,
            656,
            769,
            690
        ],
        "page_idx": 47
    },
    {
        "type": "text",
        "text": "Address offset: 0x10 ",
        "bbox": [
            205,
            698,
            361,
            712
        ],
        "page_idx": 47
    },
    {
        "type": "text",
        "text": "Reset value: 0x0007 ",
        "bbox": [
            205,
            719,
            361,
            733
        ],
        "page_idx": 47
    },
    {
        "type": "table",
        "img_path": "images/b49e99f3cc3f120fec6e8de5b544680ae2ca40ee0bd8dacf45260259bd1d3523.jpg",
        "table_caption": [],
        "table_footnote": [],
        "table_body": "<table><tr><td>15</td><td>14</td><td>13</td><td>12</td><td>11</td><td>10</td><td>9</td><td>8</td><td>7</td><td>6</td><td></td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td></tr><tr><td></td><td colspan=\"15\">CRCPOLY[15:0]</td></tr><tr><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td></td><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td>rw</td></tr></table>",
        "bbox": [
            109,
            738,
            887,
            786
        ],
        "page_idx": 47
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            833,
            874,
            880,
            894
        ],
        "page_idx": 47
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 47
    },
    {
        "type": "discarded",
        "text": "746/1136 ",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 47
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            820,
            68,
            887,
            81
        ],
        "page_idx": 47
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            109,
            68,
            363,
            83
        ],
        "page_idx": 47
    },
    {
        "type": "text",
        "text": "Bits 15:0 CRCPOLY[15:0]: CRC polynomial register ",
        "bbox": [
            188,
            115,
            544,
            129
        ],
        "page_idx": 48
    },
    {
        "type": "text",
        "text": "This register contains the polynomial for the CRC calculation.   \nThe CRC polynomial (0007h) is the reset value of this register. Another polynomial can be configured as required. ",
        "bbox": [
            268,
            130,
            870,
            171
        ],
        "page_idx": 48
    },
    {
        "type": "text",
        "text": "Note: These bits are not used for the $I ^ { 2 } S$ mode. ",
        "bbox": [
            255,
            173,
            581,
            187
        ],
        "page_idx": 48
    },
    {
        "type": "text",
        "text": "25.5.6 SPI RX CRC register (SPI_RXCRCR) (not used in I2S mode) ",
        "text_level": 1,
        "bbox": [
            110,
            211,
            771,
            231
        ],
        "page_idx": 48
    },
    {
        "type": "text",
        "text": "Address offset: 0x14 ",
        "bbox": [
            205,
            238,
            361,
            252
        ],
        "page_idx": 48
    },
    {
        "type": "text",
        "text": "Reset value: 0x0000 ",
        "bbox": [
            205,
            260,
            363,
            274
        ],
        "page_idx": 48
    },
    {
        "type": "table",
        "img_path": "images/2eee0d666eac9c3ac18c88894763519b6d90e58588c90508c5cfaada41a9f8a5.jpg",
        "table_caption": [],
        "table_footnote": [],
        "table_body": "<table><tr><td>15</td><td>14</td><td>13</td><td>12</td><td>11</td><td>10</td><td>9</td><td>8</td><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td></tr><tr><td></td><td colspan=\"15\">RXCRC[15:0]</td></tr><tr><td>r</td><td>r</td><td>r</td><td>r</td><td>r</td><td>r</td><td>r</td><td>r</td><td>r</td><td>r</td><td>r</td><td>r</td><td>r</td><td>r</td><td>r</td><td>r</td></tr></table>",
        "bbox": [
            110,
            279,
            887,
            325
        ],
        "page_idx": 48
    },
    {
        "type": "text",
        "text": "Bits 15:0 RXCRC[15:0]: Rx CRC register ",
        "text_level": 1,
        "bbox": [
            186,
            342,
            470,
            356
        ],
        "page_idx": 48
    },
    {
        "type": "text",
        "text": "When CRC calculation is enabled, the RxCRC[15:0] bits contain the computed CRC value of the subsequently received bytes. This register is reset when the CRCEN bit in SPI_CR1 register is written to 1. The CRC is calculated serially using the polynomial programmed in the SPI_CRCPR register. ",
        "bbox": [
            267,
            358,
            884,
            409
        ],
        "page_idx": 48
    },
    {
        "type": "text",
        "text": "Only the 8 LSB bits are considered when the data frame format is set to be 8-bit data (DFF bit of SPI_CR1 is cleared). CRC calculation is done based on any CRC8 standard. ",
        "bbox": [
            265,
            412,
            878,
            438
        ],
        "page_idx": 48
    },
    {
        "type": "text",
        "text": "The entire 16-bits of this register are considered when a 16-bit data frame format is selected (DFF bit of the SPI_CR1 register is set). CRC calculation is done based on any CRC16 standard. ",
        "bbox": [
            265,
            439,
            882,
            477
        ],
        "page_idx": 48
    },
    {
        "type": "text",
        "text": "Note: A read to this register when the BSY Flag is set could return an incorrect value. These bits are not used for $I ^ { 2 } S$ mode. ",
        "bbox": [
            253,
            480,
            830,
            507
        ],
        "page_idx": 48
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            68,
            887,
            83
        ],
        "page_idx": 48
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 48
    },
    {
        "type": "discarded",
        "text": "5 ",
        "bbox": [
            117,
            874,
            164,
            893
        ],
        "page_idx": 48
    },
    {
        "type": "discarded",
        "text": "747/1136 ",
        "bbox": [
            823,
            882,
            887,
            894
        ],
        "page_idx": 48
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            68,
            176,
            81
        ],
        "page_idx": 48
    },
    {
        "type": "text",
        "text": "25.5.7 SPI TX CRC register (SPI_TXCRCR) (not used in I2S mode) ",
        "text_level": 1,
        "bbox": [
            110,
            108,
            766,
            127
        ],
        "page_idx": 49
    },
    {
        "type": "text",
        "text": "Address offset: 0x18 ",
        "bbox": [
            205,
            135,
            361,
            148
        ],
        "page_idx": 49
    },
    {
        "type": "text",
        "text": "Reset value: 0x0000 ",
        "bbox": [
            205,
            156,
            363,
            169
        ],
        "page_idx": 49
    },
    {
        "type": "table",
        "img_path": "images/efbf154d16de7e0454fe8be194fb5f53bae7ab1809bb59f516601862b12c7ceb.jpg",
        "table_caption": [],
        "table_footnote": [],
        "table_body": "<table><tr><td>15</td><td>14</td><td>13</td><td>12</td><td>11</td><td>10</td><td>9</td><td>8</td><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td></tr><tr><td></td><td>TXCRC[15:0]</td><td colspan=\"10\"></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>r</td><td>r</td><td>r</td><td>r</td><td>r</td><td></td><td>r</td><td>r</td><td>r</td><td>r</td><td>r</td><td>r</td><td>r</td><td>r</td><td>r</td><td>r</td><td>r</td></tr></table>",
        "bbox": [
            110,
            174,
            889,
            220
        ],
        "page_idx": 49
    },
    {
        "type": "text",
        "text": "Bits 15:0 TXCRC[15:0]: Tx CRC register ",
        "text_level": 1,
        "bbox": [
            186,
            237,
            465,
            251
        ],
        "page_idx": 49
    },
    {
        "type": "text",
        "text": "When CRC calculation is enabled, the TxCRC[7:0] bits contain the computed CRC value of the subsequently transmitted bytes. This register is reset when the CRCEN bit of SPI_CR1 is written to 1. The CRC is calculated serially using the polynomial programmed in the SPI_CRCPR register. ",
        "bbox": [
            268,
            254,
            880,
            305
        ],
        "page_idx": 49
    },
    {
        "type": "text",
        "text": "Only the 8 LSB bits are considered when the data frame format is set to be 8-bit data (DFF bit of SPI_CR1 is cleared). CRC calculation is done based on any CRC8 standard. ",
        "bbox": [
            265,
            307,
            877,
            333
        ],
        "page_idx": 49
    },
    {
        "type": "text",
        "text": "The entire 16-bits of this register are considered when a 16-bit data frame format is selected (DFF bit of the SPI_CR1 register is set). CRC calculation is done based on any CRC16 standard. ",
        "bbox": [
            265,
            334,
            880,
            374
        ],
        "page_idx": 49
    },
    {
        "type": "text",
        "text": "Note: A read to this register when the BSY flag is set could return an incorrect value. These bits are not used for $_ { I ^ { 2 } S }$ mode. ",
        "bbox": [
            253,
            375,
            826,
            402
        ],
        "page_idx": 49
    },
    {
        "type": "text",
        "text": "25.5.8 SPI_I2S configuration register (SPI_I2SCFGR) ",
        "text_level": 1,
        "bbox": [
            110,
            427,
            647,
            446
        ],
        "page_idx": 49
    },
    {
        "type": "text",
        "text": "Address offset: 0x1C ",
        "bbox": [
            205,
            454,
            364,
            467
        ],
        "page_idx": 49
    },
    {
        "type": "text",
        "text": "Reset value: 0x0000 ",
        "bbox": [
            205,
            476,
            361,
            489
        ],
        "page_idx": 49
    },
    {
        "type": "table",
        "img_path": "images/b1006b2715760c0e11b66fdc044ed729994436ee09b60b6cee1f2c3ba4620aa7.jpg",
        "table_caption": [],
        "table_footnote": [],
        "table_body": "<table><tr><td>15</td><td>14</td><td>13</td><td>12</td><td>11</td><td>10</td><td></td><td>9</td><td>8</td><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td></tr><tr><td rowspan=\"3\"></td><td rowspan=\"3\">Reserved</td><td rowspan=\"3\"></td><td rowspan=\"3\"></td><td>I2SMOD</td><td>I2SE</td><td colspan=\"2\">I2SCFG</td><td>PCMSY NC</td><td rowspan=\"3\">Res.</td><td colspan=\"2\" rowspan=\"2\">I2SSTD</td><td colspan=\"2\">CKPOL</td><td colspan=\"2\">DATLEN</td><td rowspan=\"2\">CHLEN</td></tr><tr><td>rw</td><td>rw</td><td>rw</td><td>rw</td><td></td><td>rw</td><td>rw</td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td>rw</td><td></td><td></td><td></td><td>rw</td><td>rw</td><td>rw</td><td>rw</td></tr></table>",
        "bbox": [
            110,
            494,
            887,
            552
        ],
        "page_idx": 49
    },
    {
        "type": "text",
        "text": "Bits 15:12 Reserved, must be kept at reset value. ",
        "bbox": [
            132,
            568,
            472,
            583
        ],
        "page_idx": 49
    },
    {
        "type": "text",
        "text": "Bit 11 I2SMOD: I2S mode selection 0: SPI mode is selected 1: I2S mode is selected Note: This bit should be configured when the SPI or $r s$ is disabled ",
        "bbox": [
            161,
            589,
            670,
            648
        ],
        "page_idx": 49
    },
    {
        "type": "text",
        "text": "Bit 10 I2SE: I2S Enable 0: I2S peripheral is disabled 1: ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ peripheral is enabled ",
        "bbox": [
            161,
            654,
            416,
            697
        ],
        "page_idx": 49
    },
    {
        "type": "text",
        "text": "Note: This bit is not used in SPI mode. ",
        "bbox": [
            210,
            700,
            477,
            713
        ],
        "page_idx": 49
    },
    {
        "type": "text",
        "text": "Bits 9:8 I2SCFG: I2S configuration mode 00: Slave - transmit 01: Slave - receive 10: Master - transmit 11: Master - receive ",
        "bbox": [
            151,
            719,
            433,
            790
        ],
        "page_idx": 49
    },
    {
        "type": "text",
        "text": "Note: This bit should be configured when the $\\boldsymbol { I ^ { 2 } S }$ is disabled. It is not used in SPI mode. ",
        "bbox": [
            210,
            793,
            625,
            823
        ],
        "page_idx": 49
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 49
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            110,
            68,
            363,
            83
        ],
        "page_idx": 49
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            833,
            874,
            880,
            894
        ],
        "page_idx": 49
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            820,
            68,
            887,
            81
        ],
        "page_idx": 49
    },
    {
        "type": "discarded",
        "text": "748/1136 ",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 49
    },
    {
        "type": "text",
        "text": "Bit 7 PCMSYNC: PCM frame synchronization ",
        "bbox": [
            174,
            112,
            482,
            125
        ],
        "page_idx": 50
    },
    {
        "type": "text",
        "text": "0: Short frame synchronization   \n1: Long frame synchronization ",
        "bbox": [
            223,
            129,
            433,
            156
        ],
        "page_idx": 50
    },
    {
        "type": "text",
        "text": "Note: This bit has a meaning only if $I 2 S S T D = 1 1$ (PCM standard is used) It is not used in SPI mode. ",
        "bbox": [
            211,
            157,
            710,
            186
        ],
        "page_idx": 50
    },
    {
        "type": "text",
        "text": "Bit 6 Reserved: forced at 0 by hardware ",
        "bbox": [
            169,
            193,
            447,
            207
        ],
        "page_idx": 50
    },
    {
        "type": "text",
        "text": "Bits 5:4 I2SSTD: I2S standard selection 00: ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ Philips standard. 01: MSB justified standard (left justified) 10: LSB justified standard (right justified) 11: PCM standard ",
        "bbox": [
            151,
            213,
            499,
            283
        ],
        "page_idx": 50
    },
    {
        "type": "text",
        "text": "For more details on $^ { 1 ^ { 2 } \\mathsf { S } }$ standards, refer to Section 25.4.2: Supported audio protocols. Not used in SPI mode. ",
        "bbox": [
            208,
            287,
            884,
            313
        ],
        "page_idx": 50
    },
    {
        "type": "text",
        "text": "Note: For correct operation, these bits should be configured when the $I ^ { 2 } S$ is disabled. ",
        "bbox": [
            208,
            315,
            788,
            330
        ],
        "page_idx": 50
    },
    {
        "type": "text",
        "text": "Bit 3 CKPOL: Steady state clock polarity 0: ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ clock steady state is low level 1: ${ \\mathsf { I } } ^ { 2 } { \\mathsf { S } }$ clock steady state is high level ",
        "bbox": [
            169,
            336,
            473,
            378
        ],
        "page_idx": 50
    },
    {
        "type": "text",
        "text": "Note: For correct operation, this bit should be configured when the $r s$ is disabled. This bit is not used in SPI mode ",
        "bbox": [
            208,
            381,
            768,
            409
        ],
        "page_idx": 50
    },
    {
        "type": "text",
        "text": "Bits 2:1 DATLEN: Data length to be transferred ",
        "bbox": [
            152,
            416,
            473,
            429
        ],
        "page_idx": 50
    },
    {
        "type": "text",
        "text": "00: 16-bit data length   \n01: 24-bit data length   \n10: 32-bit data length   \n11: Not allowed ",
        "bbox": [
            225,
            433,
            366,
            488
        ],
        "page_idx": 50
    },
    {
        "type": "text",
        "text": "Note: For correct operation, these bits should be configured when the $I ^ { 2 } S$ is disabled. This bit is not used in SPI mode. ",
        "bbox": [
            211,
            490,
            789,
            519
        ],
        "page_idx": 50
    },
    {
        "type": "text",
        "text": "Bit 0 CHLEN: Channel length (number of bits per audio channel) 0: 16-bit wide 1: 32-bit wide The bit write operation has a meaning only if DATLEN $= 0 0$ otherwise the channel length is fixed to 32-bit by hardware whatever the value filled in. Not used in SPI mode. ",
        "bbox": [
            171,
            526,
            887,
            602
        ],
        "page_idx": 50
    },
    {
        "type": "text",
        "text": "Note: For correct operation, this bit should be configured when the $_ { I ^ { 2 } S }$ is disabled. ",
        "bbox": [
            210,
            598,
            769,
            612
        ],
        "page_idx": 50
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            68,
            887,
            83
        ],
        "page_idx": 50
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 50
    },
    {
        "type": "discarded",
        "text": "749/1136 ",
        "bbox": [
            823,
            882,
            887,
            894
        ],
        "page_idx": 50
    },
    {
        "type": "discarded",
        "text": "5 ",
        "bbox": [
            117,
            874,
            164,
            893
        ],
        "page_idx": 50
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            68,
            176,
            81
        ],
        "page_idx": 50
    },
    {
        "type": "text",
        "text": "25.5.9 SPI_I2S prescaler register (SPI_I2SPR) ",
        "text_level": 1,
        "bbox": [
            112,
            108,
            576,
            127
        ],
        "page_idx": 51
    },
    {
        "type": "text",
        "text": "Address offset: 0x20 ",
        "bbox": [
            205,
            135,
            363,
            148
        ],
        "page_idx": 51
    },
    {
        "type": "text",
        "text": "Reset value: 0000 0010 (0x0002) ",
        "bbox": [
            205,
            155,
            458,
            171
        ],
        "page_idx": 51
    },
    {
        "type": "table",
        "img_path": "images/2407ee8946f1aba6b3f655da45ccc8cfc151c4c4ddeddf606bc34eb006ef44cc.jpg",
        "table_caption": [],
        "table_footnote": [],
        "table_body": "<table><tr><td>15</td><td>14</td><td>13</td><td>12</td><td>11</td><td>10</td><td>9</td><td>8</td><td>7</td><td>6</td><td></td><td>5</td><td>4 3</td><td>2</td><td></td><td>1</td><td>0</td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>MCKOE</td><td>ODD</td><td></td><td></td><td></td><td>I2SDIV</td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td>Reserved</td><td></td><td></td><td></td><td>rw</td><td>rw</td><td></td><td></td><td></td><td></td><td>rw</td><td></td><td></td><td></td><td></td></tr></table>",
        "bbox": [
            114,
            174,
            885,
            220
        ],
        "page_idx": 51
    },
    {
        "type": "text",
        "text": "Bits 15:10 Reserved, must be kept at reset value. ",
        "bbox": [
            132,
            237,
            468,
            251
        ],
        "page_idx": 51
    },
    {
        "type": "text",
        "text": "Bit 9 MCKOE: Master clock output enable 0: Master clock output is disabled 1: Master clock output is enabled Note: This bit should be configured when the $_ { I ^ { 2 } S }$ is disabled. It is used only when the $I ^ { 2 } S$ is in master mode. This bit is not used in SPI mode. ",
        "bbox": [
            168,
            257,
            885,
            345
        ],
        "page_idx": 51
    },
    {
        "type": "text",
        "text": "Bit 8 ODD: Odd factor for the prescaler 0: real divider value is $= | 2 \\mathsf { S D } | \\mathsf { V } ^ { \\star } 2$ 1: real divider value is $= ( 1 2 \\mathsf { S D } \\mathsf { I V } ^ { \\star } 2 ) \\star 1$ ",
        "bbox": [
            168,
            351,
            485,
            395
        ],
        "page_idx": 51
    },
    {
        "type": "text",
        "text": "Refer to Section 25.4.3: Clock generator. Not used in SPI mode. ",
        "bbox": [
            208,
            397,
            643,
            409
        ],
        "page_idx": 51
    },
    {
        "type": "text",
        "text": "Note: This bit should be configured when the $_ { I ^ { 2 } S }$ is disabled. It is used only when the $I ^ { 2 } S$ is in master mode. ",
        "bbox": [
            201,
            412,
            882,
            439
        ],
        "page_idx": 51
    },
    {
        "type": "text",
        "text": "Bits 7:0 I2SDIV: I2S Linear prescaler I2SDIV $[ 7 ; 0 ] = 0$ or I2SDIV $[ 7 ; 0 ] = 1$ are forbidden values. Refer to Section 25.4.3: Clock generator. Not used in SPI mo ",
        "bbox": [
            147,
            446,
            630,
            489
        ],
        "page_idx": 51
    },
    {
        "type": "text",
        "text": "Note: These bits should be configured when the $_ { I ^ { 2 } S }$ is disabled. It is used only when the $I ^ { 2 } S$ is in master mode. ",
        "bbox": [
            208,
            490,
            862,
            517
        ],
        "page_idx": 51
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 51
    },
    {
        "type": "discarded",
        "text": "750/1136 ",
        "bbox": [
            109,
            882,
            174,
            894
        ],
        "page_idx": 51
    },
    {
        "type": "discarded",
        "text": "ST ",
        "bbox": [
            833,
            874,
            880,
            893
        ],
        "page_idx": 51
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            110,
            68,
            363,
            83
        ],
        "page_idx": 51
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            820,
            68,
            887,
            81
        ],
        "page_idx": 51
    },
    {
        "type": "text",
        "text": "25.5.10 SPI register map ",
        "text_level": 1,
        "bbox": [
            109,
            104,
            368,
            123
        ],
        "page_idx": 52
    },
    {
        "type": "text",
        "text": "The table provides shows the SPI register map and reset values. ",
        "bbox": [
            205,
            130,
            687,
            146
        ],
        "page_idx": 52
    },
    {
        "type": "text",
        "text": "Table 187. SPI register map and reset values ",
        "text_level": 1,
        "bbox": [
            319,
            159,
            673,
            173
        ],
        "page_idx": 52
    },
    {
        "type": "table",
        "img_path": "images/2ca215228d4e1e78fa7bc072f8f843ea36da5477a9af80eaa3386a4a1aad278f.jpg",
        "table_caption": [
            "Refer to Section 3.3: Memory map for the register boundary addresses. "
        ],
        "table_footnote": [],
        "table_body": "<table><tr><td rowspan=1 colspan=1>Offset</td><td rowspan=1 colspan=1>Register</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>22</td><td rowspan=1 colspan=1>2</td><td rowspan=1 colspan=1>2</td><td rowspan=1 colspan=1>20</td><td rowspan=1 colspan=1>2</td><td rowspan=1 colspan=1>2</td><td rowspan=1 colspan=1>23</td><td rowspan=1 colspan=1>2</td><td rowspan=1 colspan=1>2</td><td rowspan=1 colspan=1>2</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>18</td><td rowspan=1 colspan=1>F</td><td rowspan=1 colspan=1>6</td><td rowspan=1 colspan=1>19</td><td rowspan=1 colspan=1>X</td><td rowspan=1 colspan=1>22</td><td rowspan=1 colspan=1>2</td><td rowspan=1 colspan=1>F</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>9</td><td rowspan=1 colspan=1>∞</td><td rowspan=1 colspan=1>7</td><td rowspan=1 colspan=1>G</td><td rowspan=1 colspan=1>65</td><td rowspan=1 colspan=1>4</td><td rowspan=1 colspan=1>3</td><td rowspan=1 colspan=1>2</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>O</td></tr><tr><td rowspan=2 colspan=1>0x00</td><td rowspan=1 colspan=1>SPI_CR1</td><td rowspan=2 colspan=16>Reserved</td><td rowspan=1 colspan=1>20</td><td rowspan=1 colspan=1>RCIIE</td><td rowspan=1 colspan=1>C</td><td rowspan=1 colspan=1>2</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>20</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>S</td><td rowspan=1 colspan=1>2</td><td rowspan=1 colspan=1>E</td><td rowspan=1 colspan=3>BR [2:0]</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1></td></tr><tr><td rowspan=1 colspan=1>Reset value</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td></tr><tr><td rowspan=2 colspan=1>0x04</td><td rowspan=1 colspan=1>SPI_CR2</td><td rowspan=2 colspan=24>Reserved</td><td rowspan=1 colspan=1>A</td><td rowspan=1 colspan=1>T</td><td rowspan=1 colspan=1>B</td><td rowspan=1 colspan=2>20</td><td rowspan=1 colspan=1>S</td><td rowspan=1 colspan=1>20</td><td rowspan=1 colspan=1>20</td></tr><tr><td rowspan=1 colspan=1>Reset value</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td></tr><tr><td rowspan=2 colspan=1>0x08</td><td rowspan=2 colspan=1>SPI_SRReset value</td><td rowspan=2 colspan=24>Reserved</td><td rowspan=1 colspan=1>B</td><td rowspan=1 colspan=1>O</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>B</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>2</td><td rowspan=1 colspan=1>T</td><td rowspan=1 colspan=1>A</td></tr><tr><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>0</td></tr><tr><td rowspan=2 colspan=1>0x0C</td><td rowspan=1 colspan=1>SPI_DR</td><td rowspan=2 colspan=16>Reserved</td><td rowspan=1 colspan=8></td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=6></td><td rowspan=1 colspan=1></td></tr><tr><td rowspan=1 colspan=1>Reset value</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td></tr><tr><td rowspan=2 colspan=1>0x10</td><td rowspan=1 colspan=1>SPI_CRCPR</td><td rowspan=2 colspan=16>Reserved</td><td rowspan=1 colspan=9>CRCPOLY[15:0]</td><td rowspan=1 colspan=1>5:</td><td rowspan=1 colspan=5></td><td rowspan=1 colspan=1></td></tr><tr><td rowspan=1 colspan=1>Reset value</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>1</td></tr><tr><td rowspan=2 colspan=1>0x14</td><td rowspan=1 colspan=1>SPI_RXCRCR</td><td rowspan=2 colspan=16>Reserved</td><td rowspan=1 colspan=16>RxCRC[15:0]</td></tr><tr><td rowspan=1 colspan=1>Reset value</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td></tr><tr><td rowspan=2 colspan=1>0x18</td><td rowspan=1 colspan=1>SPI_TXCRCR</td><td rowspan=2 colspan=16>Reserved</td><td rowspan=1 colspan=3></td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=3></td><td rowspan=1 colspan=1>CR</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>:0]</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=2></td><td rowspan=1 colspan=2></td><td rowspan=1 colspan=1></td></tr><tr><td rowspan=1 colspan=1>Reset value</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td></tr><tr><td rowspan=2 colspan=1>0x1C</td><td rowspan=1 colspan=1>SPI_I2SCFGR</td><td rowspan=2 colspan=20>Reserved</td><td rowspan=1 colspan=1>M</td><td rowspan=1 colspan=1>R</td><td rowspan=1 colspan=2>0</td><td rowspan=1 colspan=1>20</td><td rowspan=1 colspan=1>20</td><td rowspan=1 colspan=2>20</td><td rowspan=1 colspan=1>B</td><td rowspan=1 colspan=2>GATEN</td><td rowspan=1 colspan=1>2</td></tr><tr><td rowspan=1 colspan=1>Reset value</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td></tr><tr><td rowspan=2 colspan=1>0x20</td><td rowspan=2 colspan=1>SPI_I2SPRReset value</td><td rowspan=2 colspan=22>Reserved</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>8</td><td rowspan=1 colspan=8>I2SDIV</td></tr><tr><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>0</td><td rowspan=1 colspan=1>1</td><td rowspan=1 colspan=1>0</td></tr></table>",
        "bbox": [
            109,
            172,
            887,
            623
        ],
        "page_idx": 52
    },
    {
        "type": "discarded",
        "text": "Serial peripheral interface (SPI) ",
        "bbox": [
            635,
            68,
            887,
            83
        ],
        "page_idx": 52
    },
    {
        "type": "discarded",
        "text": "RM0008 Rev 21 ",
        "bbox": [
            442,
            882,
            552,
            894
        ],
        "page_idx": 52
    },
    {
        "type": "discarded",
        "text": "751/1136 ",
        "bbox": [
            823,
            882,
            887,
            894
        ],
        "page_idx": 52
    },
    {
        "type": "discarded",
        "text": "5 ",
        "bbox": [
            117,
            874,
            164,
            893
        ],
        "page_idx": 52
    },
    {
        "type": "discarded",
        "text": "RM0008 ",
        "bbox": [
            109,
            68,
            176,
            81
        ],
        "page_idx": 52
    }
]